<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ YouTube ÌîÑÎ°ú Î∂ÑÏÑùÍ∏∞ - ÏôÑÏ†Ñ Î≤§ÏπòÎßàÌÇπ ÎèÑÍµ¨</title>
    <style>
        :root {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --bg-elevated: #0e3460;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #707070;
            --accent-primary: #ff6b6b;
            --accent-secondary: #4ecdc4;
            --accent-tertiary: #45b7d1;
            --success: #51cf66;
            --warning: #ffd43b;
            --error: #ff6b6b;
            --purple: #8b5cf6;
            --pink: #ec4899;
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-lg);
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: var(--space-xl);
            position: relative;
        }

        .header-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .api-settings-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: var(--radius-lg);
            color: white;
            padding: var(--space-md) var(--space-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .api-settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .api-settings-btn.connected {
            background: linear-gradient(135deg, var(--success), #40c057);
            box-shadow: 0 4px 12px rgba(81, 207, 102, 0.3);
        }

        .api-settings-btn.connected:hover {
            box-shadow: 0 6px 20px rgba(81, 207, 102, 0.4);
        }

        .api-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
        }

        .quota-monitor {
            position: absolute;
            top: 50px;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--radius-md);
            padding: var(--space-sm) var(--space-md);
            font-size: 0.8rem;
            color: var(--text-secondary);
            min-width: 150px;
        }

        .quota-usage {
            font-weight: 600;
        }

        .quota-warning {
            color: var(--warning) !important;
        }

        .quota-critical {
            color: var(--error) !important;
        }

        @media (max-width: 768px) {
            .api-settings-btn {
                position: static;
                margin-top: var(--space-md);
                align-self: center;
            }
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-md);
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-lg);
        }

        .api-key-setup {
            background: linear-gradient(135deg, var(--warning), #f59e0b);
            color: #000;
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-lg);
            font-weight: 500;
            display: none;
        }

        .api-key-setup.show {
            display: block;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: var(--space-sm);
            margin-bottom: var(--space-xl);
            overflow-x: auto;
            padding: var(--space-sm);
            border-radius: var(--radius-lg);
            background: var(--bg-secondary);
        }

        .nav-tab {
            padding: var(--space-md) var(--space-lg);
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 500;
            transition: all var(--transition);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-color: transparent;
            box-shadow: var(--shadow);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-header {
            margin-bottom: var(--space-lg);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .quick-action {
            padding: var(--space-xs) var(--space-md);
            background: var(--bg-tertiary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all var(--transition);
        }

        .quick-action:hover {
            background: var(--accent-primary);
            color: white;
            transform: translateY(-1px);
        }

        .advanced-filters-section {
            margin-bottom: var(--space-lg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
        }

        .advanced-filters-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md);
            cursor: pointer;
            user-select: none;
            transition: all var(--transition);
        }

        .advanced-filters-toggle:hover {
            background: rgba(255,255,255,0.05);
        }

        .advanced-filters-toggle.active {
            background: rgba(255,255,255,0.1);
        }

        .toggle-icon {
            transition: transform var(--transition);
        }

        .advanced-filters-content {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: var(--space-lg);
        }

        .filter-category {
            margin-bottom: var(--space-lg);
        }

        .filter-category-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .filter-actions {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent-tertiary), var(--purple));
            color: white;
        }

        .results-section {
            margin-top: var(--space-xl);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .video-card {
            background: var(--bg-secondary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--transition);
            position: relative;
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--accent-primary);
        }

        .video-card.benchmark-selected {
            border-color: var(--accent-secondary);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }

        .benchmark-checkbox {
            position: absolute;
            top: 8px;
            left: 8px;
            width: 20px;
            height: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--accent-secondary);
            border-radius: 4px;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition);
        }

        .benchmark-checkbox:hover {
            background: rgba(78, 205, 196, 0.2);
            border-color: var(--accent-primary);
        }

        .benchmark-checkbox.checked {
            background: var(--accent-secondary);
            border-color: var(--accent-primary);
        }

        .benchmark-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .benchmark-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            box-shadow: var(--shadow);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: var(--space-md);
            backdrop-filter: blur(10px);
        }

        .benchmark-controls.show {
            display: flex;
        }

        .benchmark-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .benchmark-btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: var(--radius-md);
            color: white;
            padding: var(--space-sm) var(--space-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
        }

        .benchmark-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }

        .benchmark-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .benchmark-results {
            margin-top: var(--space-lg);
            padding: var(--space-lg);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .benchmark-results h3 {
            color: var(--accent-secondary);
            margin-bottom: var(--space-md);
        }

        .benchmark-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .benchmark-stat {
            background: var(--bg-tertiary);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            text-align: center;
        }

        .benchmark-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .benchmark-stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: var(--space-xs);
        }

        /* Benchmark Report Overlay */
        .benchmark-report-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(6px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .benchmark-report {
            width: min(1200px, 96vw);
            height: min(90vh, 900px);
            background: var(--bg-secondary);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .benchmark-report-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .benchmark-report-body {
            padding: var(--space-lg);
            overflow: auto;
            display: grid;
            gap: var(--space-lg);
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-lg);
        }

        .report-card {
            background: var(--bg-tertiary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
        }

        /* Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .consulting-section {
            margin-top: 32px;
            padding: 24px;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .consulting-section h2 {
            text-align: center;
            margin-bottom: 32px;
            color: var(--accent-primary);
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .consulting-item {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .consulting-item h3 {
            color: var(--accent-secondary);
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--accent-secondary);
        }

        .consulting-item h4 {
            color: var(--accent-tertiary);
            font-size: 1.2rem;
            margin: 20px 0 12px 0;
            font-weight: 600;
        }

        .consulting-item ul {
            margin: 0;
            padding-left: 20px;
        }

        .consulting-item li {
            margin-bottom: 8px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .insights, .recommendations, .action-items, .content-ideas, .seo-optimization, .thumbnail-templates, .script-templates, .marketing-channels {
            margin-bottom: 20px;
        }

        .phases {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .phase {
            background: var(--bg-primary);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .phase h4 {
            color: var(--accent-primary);
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .kpis {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            padding: 16px;
            border-radius: 8px;
            color: white;
        }

        .kpis h4 {
            color: white;
            margin-bottom: 12px;
        }

        .kpis li {
            color: white;
            font-weight: 500;
        }

        .bar {
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 999px;
            overflow: hidden;
        }

        .bar > span {
            display: block;
            height: 100%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            width: 0;
        }

        .copy-btn {
            background: var(--bg-tertiary);
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            padding: 4px 10px;
            font-size: 12px;
            cursor: pointer;
        }

        .thumbnail {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            overflow: hidden;
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .outlier-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }

        .rank-s { background: rgba(255, 215, 0, 0.9); color: #000; }
        .rank-a { background: rgba(50, 205, 50, 0.9); color: #000; }
        .rank-b { background: rgba(65, 105, 225, 0.9); color: white; }
        .rank-c { background: rgba(255, 165, 0, 0.9); color: #000; }
        .rank-d { background: rgba(220, 20, 60, 0.9); color: white; }

        .video-info {
            padding: var(--space-md);
        }

        .video-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            line-height: 1.4;
            text-decoration: none;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-title:hover {
            color: var(--accent-primary);
        }

        .channel-name {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: var(--space-xs);
        }

        .video-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            font-size: 0.8rem;
            color: var(--text-tertiary);
            margin-bottom: var(--space-sm);
        }

        .benchmarking-data {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
            font-size: 0.7rem;
        }

        .benchmarking-data span {
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .video-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) var(--space-md);
            background: rgba(255,255,255,0.05);
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .outlier-score-detail {
            text-align: center;
        }

        .score-main {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-primary);
        }

        .score-label {
            font-size: 0.7rem;
            color: var(--text-tertiary);
        }

        .view-count {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .published {
            font-size: 0.7rem;
            color: var(--text-tertiary);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .form-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input, .form-select {
            padding: var(--space-md);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all var(--transition);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        /* ÌÇ§ÏõåÎìú ÏûÖÎ†• Í¥ÄÎ†® Ïä§ÌÉÄÏùº */
        .keyword-input-container {
            width: 100%;
        }

        .keyword-input-wrapper {
            display: flex;
            gap: var(--space-sm);
            align-items: center;
        }

        .keyword-input {
            flex: 1;
        }

        .add-keyword-btn {
            padding: var(--space-md);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            white-space: nowrap;
        }

        .add-keyword-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .keywords-display {
            margin-top: var(--space-md);
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            min-height: 40px;
            padding: var(--space-sm);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.02);
        }

        .keyword-tag {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-sm);
            background: linear-gradient(135deg, var(--accent-tertiary), var(--purple));
            color: white;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 500;
            transition: all var(--transition);
            cursor: default;
        }

        .keyword-tag.url-tag {
            background: linear-gradient(135deg, var(--success), #40c057);
        }

        .keyword-tag .remove-tag {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
        }

        .keyword-tag .remove-tag:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .keywords-display:empty::before {
            content: "ÌÇ§ÏõåÎìúÎÇò URLÏùÑ Ï∂îÍ∞ÄÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÌÉúÍ∑∏Î°ú ÌëúÏãúÎê©ÎãàÎã§";
            color: var(--text-tertiary);
            font-style: italic;
            font-size: 0.9rem;
        }

        /* Buttons */
        .btn {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            text-align: center;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .btn-analysis {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 8px;
            width: 100%;
        }

        .btn-analysis:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .analysis-actions {
            margin-top: 12px;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: var(--space-xl);
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 107, 107, 0.3);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-md);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-lg);
            margin-top: var(--space-lg);
        }

        .video-card {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition);
            cursor: pointer;
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .video-thumbnail {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-info {
            padding: var(--space-md);
        }

        .video-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .metric-card {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--space-xs);
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Insights */
        .insights {
            margin-top: var(--space-lg);
        }

        .insight-item {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .insight-item.success {
            background: rgba(81, 207, 102, 0.1);
            border-left: 4px solid var(--success);
        }

        .insight-item.warning {
            background: rgba(255, 212, 59, 0.1);
            border-left: 4px solid var(--warning);
        }

        .insight-item.info {
            background: rgba(69, 183, 209, 0.1);
            border-left: 4px solid var(--accent-tertiary);
        }

        /* Progress bars */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin: var(--space-sm) 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width var(--transition);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-md);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .api-settings-btn {
                position: static;
                margin-top: var(--space-md);
            }
        }

        /* Analysis Modal Styles */
        .analysis-modal {
            z-index: 10000;
        }

        .analysis-content {
            max-width: 95vw;
            max-height: 95vh;
            width: 1200px;
            overflow-y: auto;
            padding: 0;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 24px;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .analysis-loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner-large {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(99, 102, 241, 0.3);
            border-top: 6px solid #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 24px;
        }

        .analysis-loading h3 {
            color: var(--accent-primary);
            margin-bottom: 12px;
        }

        .analysis-loading p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .analysis-results {
            padding: 24px;
            max-height: calc(95vh - 100px);
            overflow-y: auto;
        }

        .analysis-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .analysis-section h3 {
            color: var(--accent-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .metric-card h4 {
            margin: 0 0 12px 0;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .recommendations-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px solid var(--accent-primary);
            border-radius: 12px;
            padding: 24px;
            margin-top: 20px;
        }

        .recommendations-card h3 {
            color: var(--accent-primary);
            margin-bottom: 20px;
        }

        .recommendation-item {
            background: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid var(--accent-primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .recommendation-item h4 {
            margin: 0 0 8px 0;
            color: var(--text-primary);
        }

        .recommendation-item p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .chart-container {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            border: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-container">
                <button class="api-settings-btn" id="apiSettingsBtn" onclick="openApiModal()">
                    <span class="api-status-indicator"></span>
                    <span id="apiSettingsBtnText">‚öôÔ∏è API ÏÑ§Ï†ï</span>
                </button>
                
                <div class="quota-monitor" id="quotaMonitor">
                    <div>üìä API ÏÇ¨Ïö©Îüâ</div>
                    <div class="quota-usage" id="quota-usage">0/10000 (0.0%)</div>
                </div>
                
                <h1>üéØ YouTube ÌîÑÎ°ú Î∂ÑÏÑùÍ∏∞</h1>
                <p>YouTube Data APIÎ•º ÌôúÏö©Ìïú ÏôÑÏ†Ñ Î≤§ÏπòÎßàÌÇπ & Í≤ΩÏüÅÎ∂ÑÏÑù ÎèÑÍµ¨</p>
            </div>
            
            <div class="api-key-setup" id="apiKeySetup">
                <strong>‚ö†Ô∏è API ÏÑ§Ï†ï ÌïÑÏöî:</strong> 
                YouTube Data API ÌÇ§Î•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.
            </div>
        </div>

        <!-- API Usage Monitor -->
        <div class="quota-monitor" id="quotaMonitor" style="text-align: center; margin: 20px 0; padding: 12px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
            <div style="font-size: 14px; font-weight: 500; margin-bottom: 4px;">üìä API ÏÇ¨Ïö©Îüâ</div>
            <div class="quota-usage" id="quota-usage" style="font-weight: 600;">0/10000 (0.0%)</div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('search')">üîç ÏòÅÏÉÅ Í≤ÄÏÉâ</button>
            <button class="nav-tab" onclick="switchTab('competitor')">üèÜ Í≤ΩÏüÅÏûê Î∂ÑÏÑù</button>
            <button class="nav-tab" onclick="switchTab('trending')">üî• Ìä∏Î†åÎìú Î∂ÑÏÑù</button>
            <button class="nav-tab" onclick="switchTab('channel')">üì∫ Ï±ÑÎÑê Î∂ÑÏÑù</button>
            <button class="nav-tab" onclick="switchTab('keywords')">üí° ÌÇ§ÏõåÎìú ÎßàÏù¥Îãù</button>
            <button class="nav-tab" onclick="switchTab('analytics')">üìä Ï¢ÖÌï© Î∂ÑÏÑù</button>
        </div>

        <!-- ÏòÅÏÉÅ Í≤ÄÏÉâ ÌÉ≠ -->
        <div id="search-tab" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üîç Í≥†Í∏â ÏòÅÏÉÅ Í≤ÄÏÉâ & Î∂ÑÏÑù</h3>
                </div>
                
                <form id="search-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Í≤ÄÏÉâ ÌÇ§ÏõåÎìú/URL ÏûÖÎ†•</label>
                        <div class="keyword-input-container">
                            <div class="keyword-input-wrapper">
                                <input type="text" id="searchQuery" class="form-input keyword-input" placeholder="ÌÇ§ÏõåÎìúÎÇò YouTube URLÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
                                <button type="button" id="addKeywordBtn" class="add-keyword-btn">Ï∂îÍ∞Ä</button>
                            </div>
                            <div class="keywords-display" id="keywordsDisplay"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Í≤∞Í≥º Ïàò</label>
                        <select id="maxResults" class="form-select">
                            <option value="25">25Í∞ú</option>
                            <option value="50">50Í∞ú</option>
                            <option value="100">100Í∞ú</option>
                            <option value="custom">ÏßÅÏ†ë ÏûÖÎ†•</option>
                        </select>
                        <input type="number" id="maxResultsCustom" class="form-input" 
                               placeholder="Í≤∞Í≥º Ïàò ÏûÖÎ†• (1-50)" 
                               min="1" max="50" 
                               style="display: none; margin-top: 8px;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ï†ïÎ†¨ Í∏∞Ï§Ä</label>
                        <select id="orderBy" class="form-select">
                            <option value="relevance">Í¥ÄÎ†®ÎèÑ</option>
                            <option value="viewCount">Ï°∞ÌöåÏàò</option>
                            <option value="date">ÏµúÏã†Ïàú</option>
                            <option value="rating">ÌèâÏ†êÏàú</option>
                            <option value="outlier">Outlier Score</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÏòÅÏÉÅ Í∏∏Ïù¥</label>
                        <select id="videoDuration" class="form-select">
                            <option value="">Ï†ÑÏ≤¥</option>
                            <option value="short">ÏàèÏ∏† (4Î∂Ñ ÎØ∏Îßå)</option>
                            <option value="medium">Ï§ëÍ∞Ñ (4-20Î∂Ñ)</option>
                            <option value="long">Í∏¥ÏòÅÏÉÅ (20Î∂Ñ Ïù¥ÏÉÅ)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÏóÖÎ°úÎìú Í∏∞Í∞Ñ</label>
                        <select id="publishedAfter" class="form-select">
                            <option value="">Ï†ÑÏ≤¥</option>
                            <option value="day">24ÏãúÍ∞Ñ Ïù¥ÎÇ¥</option>
                            <option value="week">1Ï£ºÏùº Ïù¥ÎÇ¥</option>
                            <option value="month">1Í∞úÏõî Ïù¥ÎÇ¥</option>
                            <option value="year">1ÎÖÑ Ïù¥ÎÇ¥</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÏßÄÏó≠</label>
                        <select id="regionCode" class="form-select">
                            <option value="KR">ÌïúÍµ≠</option>
                            <option value="US">ÎØ∏Íµ≠</option>
                            <option value="JP">ÏùºÎ≥∏</option>
                            <option value="GB">ÏòÅÍµ≠</option>
                        </select>
                    </div>
                </div>
                <div class="quick-actions">
                    <a href="#" class="quick-action" onclick="quickSearch('ÏöîÎ¶¨ Î†àÏãúÌîº')">ÏöîÎ¶¨ Î†àÏãúÌîº</a>
                    <a href="#" class="quick-action" onclick="quickSearch('ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç Í∞ïÏùò')">ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç</a>
                    <a href="#" class="quick-action" onclick="quickSearch('Ïû¨ÌÖåÌÅ¨')">Ïû¨ÌÖåÌÅ¨</a>
                    <a href="#" class="quick-action" onclick="quickSearch('Ïö¥Îèô')">ÌôàÌä∏Î†àÏù¥Îãù</a>
                    <a href="#" class="quick-action" onclick="quickSearch('Í≤åÏûÑ')">Í≤åÏûÑ</a>
                    <a href="#" class="quick-action" onclick="quickSearch('Î∑∞Ìã∞')">Î∑∞Ìã∞</a>
                </div>
                <!-- Í≥†Í∏â Î≤§ÏπòÎßàÌÇπ ÌïÑÌÑ∞ -->
                <div class="advanced-filters-section">
                    <div class="advanced-filters-toggle" onclick="toggleAdvancedFilters()">
                        <span>üìä Í≥†Í∏â Î≤§ÏπòÎßàÌÇπ ÌïÑÌÑ∞</span>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    
                    <div class="advanced-filters-content" id="advanced-filters" style="display: none;">
                        <!-- ÌïµÏã¨ ÏÑ±Í≥º ÏßÄÌëú -->
                        <div class="filter-category">
                            <h4 class="filter-category-title">üéØ ÌïµÏã¨ ÏÑ±Í≥º ÏßÄÌëú</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">ÏµúÏÜå Outlier Score</label>
                                    <select id="minOutlierScore" class="form-select">
                                        <option value="">Ï†úÌïúÏóÜÏùå</option>
                                        <option value="1">1Ï†ê+</option>
                                        <option value="2">2Ï†ê+</option>
                                        <option value="3">3Ï†ê+</option>
                                        <option value="4">4Ï†ê+</option>
                                        <option value="5">5Ï†ê (ÏµúÏÉÅÏúÑ)</option>
                                        <option value="custom">ÏßÅÏ†ëÏûÖÎ†•</option>
                                    </select>
                                    <input type="number" id="minOutlierScoreCustom" class="form-input" placeholder="0-5" min="0" max="5" step="0.1" style="display: none; margin-top: 4px;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ÏµúÏÜå Îû≠ÌÅ¨ Îì±Í∏â</label>
                                    <select id="minRankGrade" class="form-select">
                                        <option value="">Ï†ÑÏ≤¥ Îì±Í∏â</option>
                                        <option value="D">DÎì±Í∏â+</option>
                                        <option value="C">CÎì±Í∏â+</option>
                                        <option value="B">BÎì±Í∏â+</option>
                                        <option value="A">AÎì±Í∏â+</option>
                                        <option value="S">SÎì±Í∏âÎßå</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!-- Ï°∞ÌöåÏàò & Ï±ÑÎÑê Í∑úÎ™® -->
                        <div class="filter-category">
                            <h4 class="filter-category-title">üìä Í∑úÎ™® ÌïÑÌÑ∞</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Ï°∞ÌöåÏàò Î≤îÏúÑ</label>
                                    <div style="display: flex; gap: 4px;">
                                        <select id="minViews" class="form-select" style="flex: 1;">
                                            <option value="">ÏµúÏÜå</option>
                                            <option value="1000">1K+</option>
                                            <option value="10000">10K+</option>
                                            <option value="100000">100K+</option>
                                            <option value="1000000">1M+</option>
                                            <option value="custom">ÏßÅÏ†ë</option>
                                        </select>
                                        <select id="maxViews" class="form-select" style="flex: 1;">
                                            <option value="">ÏµúÎåÄ</option>
                                            <option value="10000">10K</option>
                                            <option value="100000">100K</option>
                                            <option value="1000000">1M</option>
                                            <option value="10000000">10M</option>
                                            <option value="custom">ÏßÅÏ†ë</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; gap: 4px; margin-top: 4px;">
                                        <input type="number" id="minViewsCustom" class="form-input" placeholder="ÏµúÏÜå" style="display: none; flex: 1;">
                                        <input type="number" id="maxViewsCustom" class="form-input" placeholder="ÏµúÎåÄ" style="display: none; flex: 1;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Íµ¨ÎèÖÏûê Î≤îÏúÑ</label>
                                    <div style="display: flex; gap: 4px;">
                                        <select id="minSubscribers" class="form-select" style="flex: 1;">
                                            <option value="">ÏµúÏÜå</option>
                                            <option value="1000">1K+</option>
                                            <option value="10000">10K+</option>
                                            <option value="100000">100K+</option>
                                            <option value="1000000">1M+</option>
                                            <option value="custom">ÏßÅÏ†ë</option>
                                        </select>
                                        <select id="maxSubscribers" class="form-select" style="flex: 1;">
                                            <option value="">ÏµúÎåÄ</option>
                                            <option value="10000">10K</option>
                                            <option value="100000">100K</option>
                                            <option value="1000000">1M</option>
                                            <option value="10000000">10M</option>
                                            <option value="custom">ÏßÅÏ†ë</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; gap: 4px; margin-top: 4px;">
                                        <input type="number" id="minSubscribersCustom" class="form-input" placeholder="ÏµúÏÜå" style="display: none; flex: 1;">
                                        <input type="number" id="maxSubscribersCustom" class="form-input" placeholder="ÏµúÎåÄ" style="display: none; flex: 1;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Ï∞∏Ïó¨ÎèÑ ÏßÄÌëú -->
                        <div class="filter-category">
                            <h4 class="filter-category-title">üí¨ Ï∞∏Ïó¨ÎèÑ ÌïÑÌÑ∞</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">ÏµúÏÜå Ï∞∏Ïó¨Ïú® (%)</label>
                                    <select id="minEngagementRate" class="form-select">
                                        <option value="">Ï†úÌïúÏóÜÏùå</option>
                                        <option value="1">1%+</option>
                                        <option value="2">2%+</option>
                                        <option value="5">5%+</option>
                                        <option value="10">10%+</option>
                                        <option value="custom">ÏßÅÏ†ëÏûÖÎ†•</option>
                                    </select>
                                    <input type="number" id="minEngagementRateCustom" class="form-input" placeholder="0-100%" min="0" max="100" step="0.1" style="display: none; margin-top: 4px;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ï¢ãÏïÑÏöî/ÎåìÍ∏Ä</label>
                                    <div style="display: flex; gap: 4px;">
                                        <select id="minLikes" class="form-select" style="flex: 1;">
                                            <option value="">Ï¢ãÏïÑÏöî</option>
                                            <option value="100">100+</option>
                                            <option value="1000">1K+</option>
                                            <option value="10000">10K+</option>
                                            <option value="custom">ÏßÅÏ†ë</option>
                                        </select>
                                        <select id="minComments" class="form-select" style="flex: 1;">
                                            <option value="">ÎåìÍ∏Ä</option>
                                            <option value="10">10+</option>
                                            <option value="100">100+</option>
                                            <option value="1000">1K+</option>
                                            <option value="custom">ÏßÅÏ†ë</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; gap: 4px; margin-top: 4px;">
                                        <input type="number" id="minLikesCustom" class="form-input" placeholder="Ï¢ãÏïÑÏöî" style="display: none; flex: 1;">
                                        <input type="number" id="minCommentsCustom" class="form-input" placeholder="ÎåìÍ∏Ä" style="display: none; flex: 1;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button type="button" class="btn btn-secondary" onclick="resetAdvancedFilters()">ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî</button>
                            <button type="button" class="btn btn-accent" onclick="applyAdvancedFilters()">ÌïÑÌÑ∞ Ï†ÅÏö©</button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="search-btn">
                    üîç Í≤ÄÏÉâ Î∞è Î∂ÑÏÑù ÏãúÏûë
                </button>
                </form>
            </div>
            <!-- Í≤ÄÏÉâ Í≤∞Í≥º -->
            <div id="error-message" class="error" style="display: none;"></div>
            <div class="results-section" id="results-section" style="display: none;">
                <div class="results-header">
                    <h3>Í≤ÄÏÉâ Í≤∞Í≥º</h3>
                    <span class="results-count" id="results-count">0Í∞ú Í≤∞Í≥º</span>
                </div>
                
                <div id="loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Í≤ÄÏÉâ Ï§ë...</p>
                </div>
                <div class="results-grid" id="results-grid" style="display: grid; gap: 1px; background: var(--border-primary);"></div>
                <div class="pagination" id="pagination" style="display: none;">
                    <button id="prev-btn" disabled>Ïù¥Ï†Ñ</button>
                    <button id="next-btn" disabled>Îã§Ïùå</button>
                </div>
            </div>
            <div class="loading" id="searchLoading">
                <div class="spinner"></div>
                <p>ÏòÅÏÉÅ Î∂ÑÏÑù Ï§ë... Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</p>
            </div>
            <div id="searchResults" class="results-grid"></div>
            
            <!-- Î≤§ÏπòÎßàÌÇπ Ïª®Ìä∏Î°§ Ìå®ÎÑê -->
            <div id="benchmark-controls" class="benchmark-controls">
                <div class="benchmark-info">
                    <span id="selected-count">0</span>Í∞ú ÏòÅÏÉÅ ÏÑ†ÌÉùÎê®
                </div>
                <button id="select-all-btn" class="benchmark-btn">Ï†ÑÏ≤¥ ÏÑ†ÌÉù</button>
                <button id="deselect-all-btn" class="benchmark-btn">Ï†ÑÏ≤¥ Ìï¥Ï†ú</button>
                <button id="analyze-benchmark-btn" class="benchmark-btn" disabled>Î∂ÑÏÑù ÏãúÏûë</button>
                <button id="view-benchmark-report" class="benchmark-btn" disabled>Î∂ÑÏÑùÍ≤∞Í≥º Î≥¥Í∏∞</button>
            </div>
            
            <!-- Î≤§ÏπòÎßàÌÇπ Í≤∞Í≥º ÏÑπÏÖò -->
            <div id="benchmark-results" class="benchmark-results" style="display: none;">
                <h3>üìä Î≤§ÏπòÎßàÌÇπ Î∂ÑÏÑù Í≤∞Í≥º</h3>
                <div id="benchmark-summary" class="benchmark-summary"></div>
                <div id="benchmark-details"></div>
            </div>
        </div>

        <!-- Î≤§ÏπòÎßàÌÇπ Ï†ÑÏ≤¥ Î∂ÑÏÑù Í≤∞Í≥º Ïò§Î≤ÑÎ†àÏù¥ -->
        <div id="benchmark-report-overlay" class="benchmark-report-overlay" style="display: none;">
            <div class="benchmark-report">
                <div class="benchmark-report-header">
                    <h3>üìä Î≤§ÏπòÎßàÌÇπ Î∂ÑÏÑù Í≤∞Í≥º</h3>
                    <button id="close-benchmark-report" class="benchmark-btn" style="background: var(--bg-tertiary); border: 1px solid rgba(255,255,255,0.2);">Îã´Í∏∞</button>
                </div>
                <div id="benchmark-report-body" class="benchmark-report-body"></div>
            </div>
        </div>

        <!-- Í≤ΩÏüÅÏûê Î∂ÑÏÑù ÌÉ≠ -->
        <div id="competitor-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üèÜ Í≤ΩÏüÅÏûê Ï±ÑÎÑê Î∂ÑÏÑù</h3>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Í≤ΩÏüÅ Ï±ÑÎÑê Ïù¥Î¶Ñ ÎòêÎäî ID</label>
                        <input type="text" id="competitorChannel" class="form-input" placeholder="Ïòà: Ï±ÑÎÑêÎ™Ö ÎòêÎäî UC...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Î∂ÑÏÑù ÍπäÏù¥</label>
                        <select id="competitorAnalysisType" class="form-select">
                            <option value="basic">Í∏∞Î≥∏ Î∂ÑÏÑù</option>
                            <option value="detailed">ÏÉÅÏÑ∏ Î∂ÑÏÑù</option>
                            <option value="comprehensive">Ï¢ÖÌï© Î∂ÑÏÑù</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="analyzeCompetitor()">
                    üìà Í≤ΩÏüÅÏûê Î∂ÑÏÑù ÏãúÏûë
                </button>
            </div>
            <div class="loading" id="competitorLoading">
                <div class="spinner"></div>
                <p>Í≤ΩÏüÅÏûê Ï±ÑÎÑê Î∂ÑÏÑù Ï§ë...</p>
            </div>
            <div id="competitorResults"></div>
        </div>

        <!-- Ìä∏Î†åÎìú Î∂ÑÏÑù ÌÉ≠ -->
        <div id="trending-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üî• Ìä∏Î†åÎìú Î∂ÑÏÑù</h3>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                        <select id="trendingCategory" class="form-select">
                            <option value="">Ï†ÑÏ≤¥</option>
                            <option value="1">ÏòÅÌôî Î∞è Ïï†ÎãàÎ©îÏù¥ÏÖò</option>
                            <option value="2">ÏûêÎèôÏ∞®</option>
                            <option value="10">ÏùåÏïÖ</option>
                            <option value="15">Ïï†ÏôÑÎèôÎ¨º</option>
                            <option value="17">Ïä§Ìè¨Ï∏†</option>
                            <option value="19">Ïó¨Ìñâ Î∞è Ïù¥Î≤§Ìä∏</option>
                            <option value="20">Í≤åÏûÑ</option>
                            <option value="22">ÏÇ¨Îûå Î∞è Î∏îÎ°úÍ∑∏</option>
                            <option value="23">ÏΩîÎØ∏Îîî</option>
                            <option value="24">ÏóîÌÑ∞ÌÖåÏù∏Î®ºÌä∏</option>
                            <option value="25">Îâ¥Ïä§ Î∞è Ï†ïÏπò</option>
                            <option value="26">ÎÖ∏ÌïòÏö∞ Î∞è Ïä§ÌÉÄÏùº</option>
                            <option value="27">ÍµêÏú°</option>
                            <option value="28">Í≥ºÌïô Í∏∞Ïà†</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÏßÄÏó≠</label>
                        <select id="trendingRegion" class="form-select">
                            <option value="KR">ÌïúÍµ≠</option>
                            <option value="US">ÎØ∏Íµ≠</option>
                            <option value="JP">ÏùºÎ≥∏</option>
                            <option value="GB">ÏòÅÍµ≠</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="analyzeTrending()">
                    üî• Ìä∏Î†åÎìú Î∂ÑÏÑù ÏãúÏûë
                </button>
            </div>
            <div class="loading" id="trendingLoading">
                <div class="spinner"></div>
                <p>Ìä∏Î†åÎìú Î∂ÑÏÑù Ï§ë...</p>
            </div>
            <div id="trendingResults"></div>
        </div>

        <!-- Ï±ÑÎÑê Î∂ÑÏÑù ÌÉ≠ -->
        <div id="channel-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üì∫ Ï±ÑÎÑê ÏÉÅÏÑ∏ Î∂ÑÏÑù</h3>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Ï±ÑÎÑê Ïù¥Î¶Ñ ÎòêÎäî ID</label>
                        <input type="text" id="channelName" class="form-input" placeholder="Ïòà: Ï±ÑÎÑêÎ™Ö ÎòêÎäî UC...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Î∂ÑÏÑù Í∏∞Í∞Ñ</label>
                        <select id="channelPeriod" class="form-select">
                            <option value="30">ÏµúÍ∑º 30Ïùº</option>
                            <option value="90">ÏµúÍ∑º 3Í∞úÏõî</option>
                            <option value="180">ÏµúÍ∑º 6Í∞úÏõî</option>
                            <option value="365">ÏµúÍ∑º 1ÎÖÑ</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="analyzeChannel()">
                    üìä Ï±ÑÎÑê Î∂ÑÏÑù ÏãúÏûë
                </button>
            </div>
            <div class="loading" id="channelLoading">
                <div class="spinner"></div>
                <p>Ï±ÑÎÑê Î∂ÑÏÑù Ï§ë...</p>
            </div>
            <div id="channelResults"></div>
        </div>

        <!-- ÌÇ§ÏõåÎìú ÎßàÏù¥Îãù ÌÉ≠ -->
        <div id="keywords-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üí° ÌÇ§ÏõåÎìú ÎßàÏù¥Îãù</h3>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Í∏∞Î≥∏ ÌÇ§ÏõåÎìú</label>
                        <input type="text" id="keywordSeed" class="form-input" placeholder="Ïòà: ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Î∂ÑÏÑù Î∞©Î≤ï</label>
                        <select id="keywordMethod" class="form-select">
                            <option value="related">Ïó∞Í¥Ä ÌÇ§ÏõåÎìú</option>
                            <option value="trending">Ìä∏Î†åÎî© ÌÇ§ÏõåÎìú</option>
                            <option value="competitor">Í≤ΩÏüÅ ÌÇ§ÏõåÎìú</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Í≤∞Í≥º Ïàò</label>
                        <select id="keywordCount" class="form-select">
                            <option value="50">50Í∞ú</option>
                            <option value="100">100Í∞ú</option>
                            <option value="200">200Í∞ú</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="mineKeywords()">
                    üíé ÌÇ§ÏõåÎìú ÎßàÏù¥Îãù ÏãúÏûë
                </button>
            </div>
            <div class="loading" id="keywordsLoading">
                <div class="spinner"></div>
                <p>ÌÇ§ÏõåÎìú Î∂ÑÏÑù Ï§ë...</p>
            </div>
            <div id="keywordsResults"></div>
        </div>

        <!-- Ï¢ÖÌï© Î∂ÑÏÑù ÌÉ≠ -->
        <div id="analytics-tab" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìä Ï¢ÖÌï© Î∂ÑÏÑù ÎåÄÏãúÎ≥¥Îìú</h3>
                </div>
                <div id="analyticsResults">
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        Îã§Î•∏ ÌÉ≠ÏóêÏÑú Î∂ÑÏÑùÏùÑ ÏàòÌñâÌïòÎ©¥ Ïó¨Í∏∞Ïóê Ï¢ÖÌï© Í≤∞Í≥ºÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- API Settings Modal -->
    <div id="apiModal" class="modal">
        <div class="modal-content">
            <div class="card-header">
                <h3 class="card-title">‚öôÔ∏è YouTube API ÏÑ§Ï†ï</h3>
            </div>
            <div class="form-group">
                <label class="form-label">YouTube Data API v3 ÌÇ§</label>
                <input type="password" id="apiKeyInput" class="form-input" placeholder="API ÌÇ§Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                <small style="color: var(--text-tertiary); margin-top: var(--space-xs);">
                    API ÌÇ§Îäî Î°úÏª¨ÏóêÎßå Ï†ÄÏû•ÎêòÎ©∞ ÏÑúÎ≤ÑÎ°ú Ï†ÑÏÜ°ÎêòÏßÄ ÏïäÏäµÎãàÎã§.
                </small>
            </div>
            <div style="display: flex; gap: var(--space-md); margin-top: var(--space-lg);">
                <button class="btn btn-primary" onclick="saveApiKey()" style="flex: 1;">Ï†ÄÏû•</button>
                <button class="btn" onclick="closeApiSettings()" style="flex: 1; background: var(--bg-tertiary);">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>

    <!-- Video Analysis Modal -->
    <div id="analysisModal" class="modal analysis-modal">
        <div class="modal-content analysis-content">
            <div class="modal-header">
                <h2>üî¨ ÏòÅÏÉÅ Î≤§ÏπòÎßàÌÇπ Î∂ÑÏÑù Í≤∞Í≥º</h2>
                <button class="close-btn" onclick="closeAnalysisModal()">√ó</button>
            </div>
            
            <div class="analysis-loading" id="analysisLoading">
                <div class="spinner-large"></div>
                <h3>Ï†ÑÎ¨∏Í∞Ä ÏàòÏ§Ä Î∂ÑÏÑù ÏßÑÌñâ Ï§ë...</h3>
                <p id="analysisProgress">ÏòÅÏÉÅ Ï†ïÎ≥¥ ÏàòÏßë Ï§ë...</p>
            </div>
            
            <div class="analysis-results" id="analysisResults" style="display: none;">
                <!-- Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÇΩÏûÖÎê©ÎãàÎã§ -->
            </div>
        </div>
    </div>

    <script>
        class YouTubeSearchApp {
            constructor() {
                this.apiKey = '';
                this.currentResults = [];
                this.filteredResults = [];
                this.nextPageToken = '';
                this.prevPageToken = '';
                this.isApiKeyVisible = false;
                this.channelAverages = new Map();
                
                // ÌÇ§ÏõåÎìú ÌÉúÍ∑∏ Í¥ÄÎ¶¨
                this.keywords = [];
                this.keywordInput = null;
                this.addKeywordBtn = null;
                this.keywordsDisplay = null;
                
                // Î≤§ÏπòÎßàÌÇπ Í∏∞Îä•
                this.selectedVideos = new Set();
                this.benchmarkResults = null;
                
                // API ÏµúÏ†ÅÌôî Í∏∞Îä•
                this.quotaUsage = parseInt(localStorage.getItem('api-quota-usage')) || 0;
                this.dailyQuotaLimit = 10000; // YouTube API v3 ÏùºÏùº Ìï†ÎãπÎüâ
                this.requestCache = new Map();
                this.cacheExpiry = 5 * 60 * 1000; // 5Î∂Ñ Ï∫êÏãú
                this.rateLimitQueue = [];
                this.lastRequestTime = 0;
                this.requestInterval = 100; // 100ms Í∞ÑÍ≤©ÏúºÎ°ú ÏöîÏ≤≠ Ï†úÌïú

                this.initialize();
            }

            initialize() {
                this.loadApiKey();
                this.setupEventListeners();
                this.updateQuotaDisplay();
                this.updateApiStatus();
                this.initializeModal();
                this.initializePagination();
                this.initializeAdvancedFilters();
                this.initializeBenchmarkControls();
            }

            setupEventListeners() {
                // API key input visibility toggle
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'toggleApiKeyVisibility') {
                        this.toggleApiKeyVisibility();
                    }
                });

                // Form submission
                const searchForm = document.getElementById('search-form');
                if (searchForm) {
                    searchForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.performSearch();
                    });
                    // Custom result count toggle
                    document.getElementById('maxResults').addEventListener('change', (e) => {
                        const customInput = document.getElementById('maxResultsCustom');
                        if (e.target.value === 'custom') {
                            if (customInput) customInput.style.display = 'block';
                        } else {
                            if (customInput) customInput.style.display = 'none';
                        }
                    });
                } else {
                    console.warn('Search form not found');
                }

                // ÏóîÌÑ∞ÌÇ§Î°ú Í≤ÄÏÉâ Ïã§Ìñâ
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && document.activeElement.id === 'searchQuery') {
                        e.preventDefault();
                        this.performSearch();
                    }
                });
            }

            initializePagination() {
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');

                if (prevBtn) {
                    prevBtn.addEventListener('click', () => {
                        this.performSearch(this.prevPageToken);
                    });
                }
                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        this.performSearch(this.nextPageToken);
                    });
                }
            }
            
            initializeModal() {
                const modal = document.getElementById('apiModal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.closeSettings();
                        }
                    });
                }

                // ESC key to close modal
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && modal && modal.classList.contains('show')) {
                        this.closeSettings();
                    }
                });
            }

            initializeAdvancedFilters() {
                // Setup event listeners for custom input fields
                const filterIds = [
                    'minViews', 'maxViews', 'minSubscribers', 'maxSubscribers',
                    'minOutlierScore', 'minEngagementRate', 'minLikes', 'minComments'
                ];

                filterIds.forEach(id => {
                    const selectElement = document.getElementById(id);
                    if (selectElement) {
                        selectElement.addEventListener('change', (e) => {
                            const customInput = document.getElementById(id + 'Custom');
                            if (customInput) {
                                if (e.target.value === 'custom') {
                                    customInput.style.display = 'inline-block';
                                } else {
                                    customInput.style.display = 'none';
                                }
                            }
                        });
                    }
                });
            }

            getMaxResults() {
                const maxResultsSelect = document.getElementById('maxResults');
                const customInput = document.getElementById('maxResultsCustom');
                
                if (maxResultsSelect && maxResultsSelect.value === 'custom' && customInput) {
                    const customValue = parseInt(customInput.value);
                    // Validate custom value (1-50 per YouTube API limits)
                    if (customValue && customValue >= 1 && customValue <= 50) {
                        return customValue.toString();
                    } else {
                        // Default to 25 if invalid custom value
                        return '25';
                    }
                }
                
                return maxResultsSelect?.value || '25';
            }

            loadApiKey() {
                this.apiKey = localStorage.getItem('youtube-api-key') || '';
                const apiKeyInput = document.getElementById('apiKeyInput');
                if (apiKeyInput) {
                    apiKeyInput.value = this.apiKey;
                }
            }

            openSettings() {
                const modal = document.getElementById('apiModal');
                if (modal) {
                    modal.classList.add('show');
                    const apiKeyInput = document.getElementById('apiKeyInput');
                    if (apiKeyInput) {
                        apiKeyInput.value = this.apiKey;
                        apiKeyInput.focus();
                    }
                }
            }

            closeSettings() {
                const modal = document.getElementById('apiModal');
                if (modal) {
                    modal.classList.remove('show');
                }
            }

            saveApiKey() {
                const apiKeyInput = document.getElementById('apiKeyInput');
                if (apiKeyInput) {
                    this.apiKey = apiKeyInput.value.trim();
                    if (this.apiKey) {
                        localStorage.setItem('youtube-api-key', this.apiKey);
                        this.updateApiStatus();
                        this.closeSettings();
                        alert('API ÌÇ§Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
                    } else {
                        alert('Ïú†Ìö®Ìïú API ÌÇ§Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    }
                }
            }

            async testApiKey() {
                if (!this.apiKey) {
                    alert('API ÌÇ§Î•º Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                try {
                    const testUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=test&maxResults=1&key=${this.apiKey}`;
                    const response = await fetch(testUrl);
                    
                    if (response.ok) {
                        alert('‚úÖ API ÌÇ§ Ïó∞Í≤∞ ÏÑ±Í≥µ!');
                        this.updateApiStatus();
                    } else {
                        const error = await response.json();
                        alert(`‚ùå API ÌÇ§ Ïò§Î•ò: ${error.error?.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
                    }
                } catch (error) {
                    alert('‚ùå ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
            }

            updateApiStatus() {
                const btn = document.getElementById('apiSettingsBtn');
                const btnText = document.getElementById('apiSettingsBtnText');
                const indicator = btn?.querySelector('.api-status-indicator');

                if (this.apiKey) {
                    if (btn) btn.classList.add('connected');
                    if (btnText) btnText.textContent = '‚úÖ API Ïó∞Í≤∞Îê®';
                    if (indicator) indicator.style.background = '#51cf66';
                } else {
                    if (btn) btn.classList.remove('connected');
                    if (btnText) btnText.textContent = '‚öôÔ∏è API ÏÑ§Ï†ï';
                    if (indicator) indicator.style.background = 'white';
                }
            }

            updateQuotaDisplay() {
                const quotaElement = document.getElementById('quota-usage');
                if (quotaElement) {
                    const percentage = ((this.quotaUsage / this.dailyQuotaLimit) * 100).toFixed(1);
                    quotaElement.textContent = `${this.quotaUsage}/${this.dailyQuotaLimit} (${percentage}%)`;
                    
                    // Update quota warning colors
                    quotaElement.className = 'quota-usage';
                    if (percentage >= 90) {
                        quotaElement.classList.add('quota-critical');
                    } else if (percentage >= 75) {
                        quotaElement.classList.add('quota-warning');
                    }
                }
            }

            // Rate limiting function
            async rateLimitedRequest(requestFunction) {
                const now = Date.now();
                const timeSinceLastRequest = now - this.lastRequestTime;
                
                if (timeSinceLastRequest < this.requestInterval) {
                    await new Promise(resolve => setTimeout(resolve, this.requestInterval - timeSinceLastRequest));
                }
                
                this.lastRequestTime = Date.now();
                return await requestFunction();
            }

            // Cache management
            getCacheKey(params) {
                return btoa(params.toString()).replace(/[+/=]/g, '');
            }

            getCachedData(cacheKey) {
                const cached = this.requestCache.get(cacheKey);
                if (cached && (Date.now() - cached.timestamp) < this.cacheExpiry) {
                    return cached.data;
                }
                this.requestCache.delete(cacheKey);
                return null;
            }

            setCachedData(cacheKey, data) {
                this.requestCache.set(cacheKey, {
                    data: data,
                    timestamp: Date.now()
                });
                
                // Limit cache size to prevent memory issues
                if (this.requestCache.size > 100) {
                    const firstKey = this.requestCache.keys().next().value;
                    this.requestCache.delete(firstKey);
                }
            }

            async batchApiCall(ids, endpoint, type, quotaCost) {
                if (!ids.length) return { items: [] };
                
                const batchSize = 50; // API limits
                const batches = [];
                
                for (let i = 0; i < ids.length; i += batchSize) {
                    const batch = ids.slice(i, i + batchSize);
                    batches.push(batch);
                }
                
                const results = [];
                for (const batch of batches) {
                    const params = new URLSearchParams({
                        part: type === 'video-details' ? 'snippet,statistics,contentDetails' : 'snippet,statistics',
                        id: batch.join(','),
                        key: this.apiKey
                    });
                    
                    try {
                        const data = await this.callYouTubeAPI(params, endpoint, quotaCost);
                        if (data.items) {
                            results.push(...data.items);
                        }
                    } catch (error) {
                        console.warn(`Batch API call failed for ${endpoint}:`, error);
                    }
                    
                    // Small delay between batches
                    if (batches.indexOf(batch) < batches.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                }
                
                return { items: results };
            }

            async performSearch(pageToken = '') {
                if (!this.apiKey) {
                    this.showError('API ÌÇ§Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                // ÌÇ§ÏõåÎìú ÏãúÏä§ÌÖúÏóêÏÑú Í≤ÄÏÉâÏñ¥ Í∞ÄÏ†∏Ïò§Í∏∞
                const query = this.getSearchQuery();
                if (!query) {
                    this.showError('Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÌÇ§ÏõåÎìúÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                this.showLoading(true);
                this.hideError();

                try {
                    // Build search parameters
                    const params = new URLSearchParams({
                        part: 'snippet',
                        type: 'video',
                        q: query,
                        maxResults: this.getMaxResults(),
                        key: this.apiKey
                    });

                    // Add optional parameters
                    const order = document.getElementById('orderBy')?.value;
                    const videoDuration = document.getElementById('videoDuration')?.value;
                    const publishedAfter = document.getElementById('publishedAfter')?.value;
                    const regionCode = document.getElementById('regionCode')?.value;

                    if (order && order !== 'outlier') params.append('order', order);
                    if (videoDuration) params.append('videoDuration', videoDuration);
                    if (regionCode) params.append('regionCode', regionCode);
                    if (pageToken) params.append('pageToken', pageToken);

                    // Add published after filter
                    if (publishedAfter) {
                        const publishedAfterDate = this.getPublishedAfterDate(publishedAfter);
                        if (publishedAfterDate) {
                            params.append('publishedAfter', publishedAfterDate);
                        }
                    }

                    // Search for videos
                    const searchData = await this.callYouTubeAPI(params, 'search', 100);
                    
                    if (!searchData.items || searchData.items.length === 0) {
                        this.showError('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                        return;
                    }

                    // Store results and pagination tokens
                    this.currentResults = searchData.items;
                    this.filteredResults = [...searchData.items];
                    this.nextPageToken = searchData.nextPageToken || '';
                    this.prevPageToken = searchData.prevPageToken || '';

                    // Enrich results with additional data
                    await this.enrichResults();
                    
                    // Display results
                    this.displayResults();
                    this.updatePagination();

                } catch (error) {
                    console.error('Search error:', error);
                    this.showError('Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            getPublishedAfterDate(period) {
                const now = new Date();
                const periods = {
                    day: new Date(now - 24 * 60 * 60 * 1000),
                    week: new Date(now - 7 * 24 * 60 * 60 * 1000),
                    month: new Date(now - 30 * 24 * 60 * 60 * 1000),
                    year: new Date(now - 365 * 24 * 60 * 60 * 1000)
                };

                return periods[period.value]?.toISOString() || '';
            }

            async callYouTubeAPI(params, endpoint = 'search', quotaCost = 1) {
                // ÏøºÌÑ∞ Ï≤¥ÌÅ¨
                if (this.quotaUsage + quotaCost > this.dailyQuotaLimit) {
                    throw new Error(`ÏùºÏùº API Ìï†ÎãπÎüâÏùÑ Ï¥àÍ≥ºÌñàÏäµÎãàÎã§. (${this.quotaUsage}/${this.dailyQuotaLimit})`);
                }

                // Ï∫êÏãú ÌôïÏù∏
                const cacheKey = this.getCacheKey(params);
                const cachedData = this.getCachedData(cacheKey);
                if (cachedData) {
                    console.log('Ï∫êÏãúÎêú Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©:', cacheKey);
                    return cachedData;
                }

                // Rate limiting Ï†ÅÏö©
                return await this.rateLimitedRequest(async () => {
                    const url = `https://www.googleapis.com/youtube/v3/${endpoint}?${params}`;
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error?.message || 'API Ìò∏Ï∂ú Ïã§Ìå®');
                    }
                    
                    const data = await response.json();
                    
                    // ÏøºÌÑ∞ ÏÇ¨Ïö©Îüâ ÏóÖÎç∞Ïù¥Ìä∏
                    this.quotaUsage += quotaCost;
                    localStorage.setItem('api-quota-usage', this.quotaUsage.toString());
                    this.updateQuotaDisplay();
                    
                    // Ï∫êÏãú Ï†ÄÏû•
                    this.setCachedData(cacheKey, data);
                    
                    return data;
                });
            }

            async enrichResults() {
                if (this.currentResults.length === 0) return;

                try {
                    // Get video IDs for detailed information (ÌïÑÌÑ∞ÎßÅ Ï∂îÍ∞Ä)
                    const videoIds = this.currentResults
                        .map(item => item.id?.videoId)
                        .filter(id => id);
                    
                    if (videoIds.length === 0) return;

                    // Î∞∞Ïπò API Ìò∏Ï∂úÎ°ú ÏµúÏ†ÅÌôî
                    const videoData = await this.batchApiCall(videoIds, 'videos', 'video-details', 3);

                    // Get channel information (Ï§ëÎ≥µ Ï†úÍ±∞)
                    const channelIds = [...new Set(this.currentResults
                        .map(item => item.snippet?.channelId)
                        .filter(id => id))];
                    
                    const channelData = await this.batchApiCall(channelIds, 'channels', 'channel-basic', 1);

                    // Get recent videos for each channel to calculate averages
                    await this.getChannelAverages(channelIds);

                    // Merge the data
                    this.mergeEnrichedData(videoData.items || [], channelData.items || []);
                    
                    // Calculate outlier scores
                    this.calculateOutlierScores();
                    
                    // Apply advanced filters
                    this.applyAdvancedFilters();
                    
                } catch (error) {
                    console.warn('Failed to enrich results:', error);
                }
            }

            async getChannelAverages(channelIds) {
                this.channelAverages = new Map();
                
                for (const channelId of channelIds) {
                    try {
                        // Get recent videos for this channel
                        const searchParams = new URLSearchParams({
                            part: 'snippet',
                            channelId: channelId,
                            type: 'video',
                            order: 'date',
                            maxResults: '20',
                            key: this.apiKey
                        });

                        const searchResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?${searchParams}`);
                        const searchData = await searchResponse.json();
                        
                        if (searchData.items && searchData.items.length > 0) {
                            // Get video statistics for average calculation
                            const recentVideoIds = searchData.items.map(item => item.id.videoId).join(',');
                            const videoParams = new URLSearchParams({
                                part: 'statistics',
                                id: recentVideoIds,
                                key: this.apiKey
                            });

                            const videoResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?${videoParams}`);
                            const videoData = await videoResponse.json();
                            
                            // Calculate averages
                            const views = videoData.items.map(v => parseInt(v.statistics.viewCount || '0'));
                            const avgViews = views.reduce((sum, v) => sum + v, 0) / views.length;
                            
                            this.channelAverages.set(channelId, {
                                avgViews: avgViews,
                                recentVideoCount: views.length,
                                totalViews: views.reduce((sum, v) => sum + v, 0)
                            });
                        }
                    } catch (error) {
                        console.warn(`Failed to get averages for channel ${channelId}:`, error);
                        this.channelAverages.set(channelId, { avgViews: 0, recentVideoCount: 0, totalViews: 0 });
                    }
                }
            }

            mergeEnrichedData(videoDetails, channelDetails) {
                const videoMap = new Map(videoDetails.map(v => [v.id, v]));
                const channelMap = new Map(channelDetails.map(c => [c.id, c]));

                this.currentResults.forEach(item => {
                    const videoDetail = videoMap.get(item.id.videoId);
                    const channelDetail = channelMap.get(item.snippet.channelId);

                    if (videoDetail) {
                        item.statistics = videoDetail.statistics;
                        item.contentDetails = videoDetail.contentDetails;
                    }

                    if (channelDetail) {
                        item.channelStatistics = channelDetail.statistics;
                    }
                });
            }

            calculateOutlierScores() {
                this.currentResults.forEach(item => {
                    const videoViews = parseInt(item.statistics?.viewCount || '0');
                    const subscriberCount = parseInt(item.channelStatistics?.subscriberCount || '1');
                    const channelAvg = this.channelAverages.get(item.snippet.channelId);
                    const avgViews = channelAvg?.avgViews || 1;
                    
                    // Calculate engagement rate
                    const likes = parseInt(item.statistics?.likeCount || '0');
                    const comments = parseInt(item.statistics?.commentCount || '0');
                    const engagementRate = videoViews > 0 ? (likes + comments) / videoViews : 0;
                    
                    // Calculate time factor (newer videos get bonus)
                    const publishedDate = new Date(item.snippet.publishedAt);
                    const ageInDays = (new Date() - publishedDate) / (1000 * 60 * 60 * 24);
                    const timeFactor = Math.max(5 - (ageInDays / 30), 0);
                    
                    // VidIQ-style Outlier Score calculation
                    const viewRatio = Math.min((videoViews / avgViews) * 20, 60);
                    const engagementBonus = Math.min(engagementRate * 1000, 20);
                    const subscriberBonus = Math.min((videoViews / subscriberCount) * 100, 15);
                    const timeBonus = timeFactor;
                    
                    const outlierScore = Math.round(viewRatio + engagementBonus + subscriberBonus + timeBonus);
                    
                    // Add calculated data to item
                    item.outlierScore = Math.min(outlierScore, 100);
                    item.viewRatio = videoViews / avgViews;
                    item.engagementRate = engagementRate;
                    item.channelAvgViews = avgViews;
                    
                    // Calculate and set rank grade based on outlier score
                    if (item.outlierScore >= 90) item.rankGrade = 'S';
                    else if (item.outlierScore >= 70) item.rankGrade = 'A';
                    else if (item.outlierScore >= 50) item.rankGrade = 'B';
                    else if (item.outlierScore >= 30) item.rankGrade = 'C';
                    else item.rankGrade = 'D';
                });
            }

            displayResults() {
                const container = document.getElementById('searchResults') || document.getElementById('results-grid');
                if (!container) return;
                
                const resultsSection = document.getElementById('results-section');
                const resultsCount = document.getElementById('results-count');

                container.innerHTML = '';
                const totalResults = this.currentResults.length;
                const filteredCount = this.filteredResults.length;
                
                if (resultsCount) {
                    resultsCount.innerHTML = `
                        <span>${filteredCount}Í∞ú Í≤∞Í≥º</span>
                        ${filteredCount < totalResults ? `<span style="color: var(--text-tertiary);"> (Ï†ÑÏ≤¥ ${totalResults}Í∞ú Ï§ë)</span>` : ''}
                    `;
                }
                
                if (resultsSection) {
                    resultsSection.style.display = 'block';
                }

                this.filteredResults.forEach(item => {
                    const card = this.createVideoCard(item);
                    container.appendChild(card);
                });
                // reflect benchmarking selections after render
                this.applyBenchmarkStateToCards();
            }

            applyAdvancedFilters() {
                if (!this.currentResults || this.currentResults.length === 0) return;
                
                // Get filter values
                const getFilterValue = (selectId, customInputId) => {
                    const select = document.getElementById(selectId);
                    const customInput = document.getElementById(customInputId);
                    if (!select) return null;
                    
                    if (select.value === 'custom' && customInput && customInput.value) {
                        return parseFloat(customInput.value);
                    }
                    return select.value ? parseFloat(select.value) : null;
                };
                
                const filters = {
                    minViews: getFilterValue('minViews', 'minViewsCustom'),
                    maxViews: getFilterValue('maxViews', 'maxViewsCustom'),
                    minSubscribers: getFilterValue('minSubscribers', 'minSubscribersCustom'),
                    maxSubscribers: getFilterValue('maxSubscribers', 'maxSubscribersCustom'),
                    minOutlierScore: getFilterValue('minOutlierScore', 'minOutlierScoreCustom'),
                    minEngagementRate: getFilterValue('minEngagementRate', 'minEngagementRateCustom'),
                    minLikes: getFilterValue('minLikes', 'minLikesCustom'),
                    minComments: getFilterValue('minComments', 'minCommentsCustom'),
                    minRankGrade: document.getElementById('minRankGrade')?.value || null
                };
                
                // Apply filters
                this.filteredResults = this.currentResults.filter(video => {
                    // Views filter
                    const views = parseInt(video.statistics?.viewCount || 0);
                    if (filters.minViews !== null && views < filters.minViews) return false;
                    if (filters.maxViews !== null && views > filters.maxViews) return false;
                    
                    // Subscribers filter (channel data)
                    const subscribers = parseInt(video.channelStatistics?.subscriberCount || 0);
                    if (filters.minSubscribers !== null && subscribers < filters.minSubscribers) return false;
                    if (filters.maxSubscribers !== null && subscribers > filters.maxSubscribers) return false;
                    
                    // Outlier Score filter
                    if (filters.minOutlierScore !== null && (video.outlierScore || 0) < filters.minOutlierScore) return false;
                    
                    // Engagement Rate filter
                    const likes = parseInt(video.statistics?.likeCount || 0);
                    const engagementRate = views > 0 ? (likes / views) * 100 : 0;
                    if (filters.minEngagementRate !== null && engagementRate < filters.minEngagementRate) return false;
                    
                    // Likes filter
                    if (filters.minLikes !== null && likes < filters.minLikes) return false;
                    
                    // Comments filter
                    const comments = parseInt(video.statistics?.commentCount || 0);
                    if (filters.minComments !== null && comments < filters.minComments) return false;
                    
                    // Rank Grade filter
                    if (filters.minRankGrade) {
                        const rankOrder = { 'S': 5, 'A': 4, 'B': 3, 'C': 2, 'D': 1 };
                        const videoRank = video.rankGrade || 'D';
                        const minRankValue = rankOrder[filters.minRankGrade] || 1;
                        const videoRankValue = rankOrder[videoRank] || 1;
                        
                        if (videoRankValue < minRankValue) return false;
                    }
                    
                    return true;
                });
                
                // Re-display results with filters applied
                this.displayResults();
                
                console.log(`Advanced filters applied. ${this.filteredResults.length} results out of ${this.currentResults.length} total results.`);
            }

            createVideoCard(item) {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.dataset.videoId = item.id.videoId;

                const thumbnail = item.snippet.thumbnails.medium || item.snippet.thumbnails.default;
                const stats = item.statistics || {};
                const viewCount = formatNumber(parseInt(stats.viewCount || '0'));
                const duration = formatDuration(item.contentDetails?.duration);
                const publishedAt = formatDate(item.snippet.publishedAt);
                const subscriberCount = formatNumber(parseInt(item.channelStatistics?.subscriberCount || '0'));
                
                // Outlier score and ranking
                const outlierScore = item.outlierScore || 0;
                const rank = this.getOutlierRank(outlierScore);
                const viewRatio = item.viewRatio || 0;
                const channelAvgViews = formatNumber(item.channelAvgViews || 0);
                const engagementRate = ((item.engagementRate || 0) * 100).toFixed(2);

                card.innerHTML = `
                    <div class="benchmark-checkbox" onclick="event.stopPropagation(); toggleBenchmarkSelection('${item.id.videoId}')"></div>
                    <div class="thumbnail">
                        <img src="${thumbnail.url}" alt="${escapeHtml(item.snippet.title)}" loading="lazy">
                        ${duration ? `<div class="duration">${duration}</div>` : ''}
                        <div class="outlier-badge ${rank.class}">${rank.emoji} ${rank.grade}</div>
                    </div>
                    <div class="video-info">
                        <a href="https://www.youtube.com/watch?v=${item.id.videoId}" 
                           target="_blank" class="video-title">
                            ${escapeHtml(item.snippet.title)}
                        </a>
                        <div class="channel-name">${escapeHtml(item.snippet.channelTitle)}</div>
                        <div class="video-meta">
                            <span>Ï°∞ÌöåÏàò ${viewCount}</span>
                            <span>Íµ¨ÎèÖÏûê ${subscriberCount}</span>
                            <span>${publishedAt}</span>
                        </div>
                        <div class="benchmarking-data">
                            <span>üìä Score: ${outlierScore}Ï†ê</span>
                            <span>üìà ÌèâÍ∑† ÎåÄÎπÑ: ${viewRatio.toFixed(1)}Î∞∞</span>
                            <span>üí¨ Ï∞∏Ïó¨ÎèÑ: ${engagementRate}%</span>
                            <span>üì∫ Ï±ÑÎÑê ÌèâÍ∑†: ${channelAvgViews}</span>
                        </div>
                        
                    </div>
                    <div class="video-stats">
                        <div class="outlier-score-detail">
                            <div class="score-main">${outlierScore}</div>
                            <div class="score-label">Outlier Score</div>
                        </div>
                        <div class="view-count">${viewCount} Ï°∞Ìöå</div>
                        <div class="published">${publishedAt}</div>
                    </div>
                `;

                return card;
            }

            getOutlierRank(score) {
                if (score >= 90) return { grade: 'S', emoji: 'üèÜ', class: 'rank-s' };
                if (score >= 70) return { grade: 'A', emoji: '‚≠ê', class: 'rank-a' };
                if (score >= 50) return { grade: 'B', emoji: 'üî•', class: 'rank-b' };
                if (score >= 30) return { grade: 'C', emoji: 'üìà', class: 'rank-c' };
                return { grade: 'D', emoji: 'üìâ', class: 'rank-d' };
            }

            formatNumber(num) {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                }
                return num.toLocaleString();
            }

            formatDuration(isoDuration) {
                if (!isoDuration) return '';
                
                const match = isoDuration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
                if (!match) return '';

                const hours = parseInt(match[1] || '0');
                const minutes = parseInt(match[2] || '0');
                const seconds = parseInt(match[3] || '0');

                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            formatDate(isoDate) {
                const date = new Date(isoDate);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === 1) return '1Ïùº Ï†Ñ';
                if (diffDays < 7) return `${diffDays}Ïùº Ï†Ñ`;
                if (diffDays < 30) return `${Math.floor(diffDays / 7)}Ï£º Ï†Ñ`;
                if (diffDays < 365) return `${Math.floor(diffDays / 30)}Í∞úÏõî Ï†Ñ`;
                return `${Math.floor(diffDays / 365)}ÎÖÑ Ï†Ñ`;
            }

            cleanText(text) {
                if (!text) return '';
                
                // Comprehensive HTML entity decoding
                let decoded = text;
                
                // Common HTML entities map
                const entities = {
                    '&#39;': "'",
                    '&quot;': '"',
                    '&amp;': '&',
                    '&lt;': '<',
                    '&gt;': '>',
                    '&nbsp;': ' ',
                    '&#x27;': "'",
                    '&#x2F;': '/',
                    '&#x3D;': '=',
                    '&#x60;': '`'
                };
                
                // Replace known entities first
                for (const [entity, replacement] of Object.entries(entities)) {
                    decoded = decoded.replace(new RegExp(entity, 'g'), replacement);
                }
                
                // Use textarea for any remaining entities
                const textarea = document.createElement('textarea');
                textarea.innerHTML = decoded;
                decoded = textarea.value;
                
                return decoded;
            }

            updatePagination() {
                const pagination = document.getElementById('pagination');
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');

                if (prevBtn && nextBtn) {
                    prevBtn.disabled = !this.prevPageToken;
                    nextBtn.disabled = !this.nextPageToken;
                }
                
                if (pagination) {
                    pagination.style.display = (this.prevPageToken || this.nextPageToken) ? 'flex' : 'none';
                }
            }

            showLoading(show) {
                const loading = document.getElementById('searchLoading') || document.getElementById('loading');
                const searchBtn = document.getElementById('search-btn');
                
                if (loading) {
                    loading.style.display = show ? 'block' : 'none';
                    if (show) {
                        loading.classList.add('show');
                    } else {
                        loading.classList.remove('show');
                    }
                }
                
                if (searchBtn) {
                    searchBtn.disabled = show;
                    searchBtn.textContent = show ? 'Í≤ÄÏÉâ Ï§ë...' : 'üîç Í≤ÄÏÉâ Î∞è Î∂ÑÏÑù ÏãúÏûë';
                }
            }

            showError(message) {
                const errorDiv = document.getElementById('error-message');
                if (errorDiv) {
                    errorDiv.textContent = message;
                    errorDiv.style.display = 'block';
                } else {
                    // Create error display in results area
                    const container = document.getElementById('searchResults') || document.getElementById('results-grid');
                    if (container) {
                        container.innerHTML = `<div class="card" style="background: var(--error); color: white;"><div class="card-header"><h3>‚ö†Ô∏è Ïò§Î•ò</h3></div><p>${message}</p></div>`;
                    }
                }
            }

            hideError() {
                const errorDiv = document.getElementById('error-message');
                if (errorDiv) {
                    errorDiv.style.display = 'none';
                }
            }
            
            // ÌÇ§ÏõåÎìú ÌÉúÍ∑∏ ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî
            initKeywordSystem() {
                this.keywordInput = document.getElementById('searchQuery');
                this.addKeywordBtn = document.getElementById('addKeywordBtn');
                this.keywordsDisplay = document.getElementById('keywordsDisplay');
                
                if (!this.keywordInput || !this.addKeywordBtn || !this.keywordsDisplay) {
                    console.warn('ÌÇ§ÏõåÎìú ÏãúÏä§ÌÖú ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
                this.addKeywordBtn.addEventListener('click', () => {
                    this.addKeyword();
                });
                
                this.keywordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.addKeyword();
                    }
                });
                
                // Ï†ÄÏû•Îêú ÌÇ§ÏõåÎìú Î°úÎìú
                this.loadSavedKeywords();
            }
            
            // ÌÇ§ÏõåÎìú Ï∂îÍ∞Ä
            async addKeyword() {
                const input = this.keywordInput.value.trim();
                if (!input) return;
                
                let keywordData = {
                    text: '',
                    type: 'keyword', // 'keyword' ÎòêÎäî 'url'
                    original: input
                };
                
                // URLÏù∏ÏßÄ ÌôïÏù∏
                if (this.isYouTubeURL(input)) {
                    keywordData.type = 'url';
                    // URLÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú (ÎπÑÎèôÍ∏∞)
                    try {
                        this.showNotification('URLÏóêÏÑú ÌÇ§ÏõåÎìúÎ•º Ï∂îÏ∂úÌïòÍ≥† ÏûàÏäµÎãàÎã§...', 'info');
                        keywordData.text = await this.extractKeywordsFromURL(input);
                    } catch (error) {
                        console.error('ÌÇ§ÏõåÎìú Ï∂îÏ∂ú Ïò§Î•ò:', error);
                        keywordData.text = `url_${Date.now()}`;
                    }
                } else {
                    keywordData.text = input;
                }
                
                // Ï§ëÎ≥µ Ï≤¥ÌÅ¨
                if (this.keywords.some(k => k.text === keywordData.text)) {
                    this.showNotification('Ïù¥ÎØ∏ Ï∂îÍ∞ÄÎêú ÌÇ§ÏõåÎìúÏûÖÎãàÎã§.', 'warning');
                    return;
                }
                
                this.keywords.push(keywordData);
                this.keywordInput.value = '';
                this.updateKeywordsDisplay();
                this.saveKeywords();
                
                this.showNotification(`${keywordData.type === 'url' ? 'URLÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú' : 'ÌÇ§ÏõåÎìú Ï∂îÍ∞Ä'}: ${keywordData.text}`, 'success');
            }
            
            // YouTube URL ÌôïÏù∏
            isYouTubeURL(text) {
                const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com\/(watch\?v=|embed\/|v\/)|youtu\.be\/)/;
                return youtubeRegex.test(text);
            }
            
            // URLÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
            async extractKeywordsFromURL(url) {
                try {
                    // YouTube URLÏóêÏÑú ÎπÑÎîîÏò§ ID Ï∂îÏ∂ú
                    let videoId = this.extractVideoId(url);
                    
                    if (videoId) {
                        // APIÍ∞Ä ÏûàÏúºÎ©¥ ÎπÑÎîîÏò§ Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏ÏôÄÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
                        if (this.apiKey) {
                            try {
                                const videoInfo = await this.getVideoInfo(videoId);
                                if (videoInfo) {
                                    return this.extractKeywordsFromVideoInfo(videoInfo);
                                }
                            } catch (error) {
                                console.warn('APIÎ•º ÌÜµÌïú ÎπÑÎîîÏò§ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error);
                            }
                        }
                        
                        // APIÍ∞Ä ÏóÜÍ±∞ÎÇò Ïã§Ìå®Ìïú Í≤ΩÏö∞, ÎπÑÎîîÏò§ ID Í∏∞Î∞ò ÌÇ§ÏõåÎìú ÏÉùÏÑ±
                        return `video_${videoId.substring(0, 8)}`;
                    }
                    
                    // Ï±ÑÎÑê URLÏù∏ÏßÄ ÌôïÏù∏
                    if (url.includes('/channel/') || url.includes('/c/') || url.includes('/@')) {
                        const channelKeyword = this.extractChannelKeyword(url);
                        return channelKeyword || `channel_${Date.now()}`;
                    }
                    
                    // ÏùºÎ∞ò URLÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
                    const urlParts = url.split(/[\/\?\&\=\_\-]+/);
                    const keywords = urlParts.filter(part => 
                        part.length > 2 && 
                        !part.match(/^(https?|www|com|youtube|youtu|be|watch|embed|v|channel|c)$/i)
                    ).slice(0, 3).join('_');
                    
                    return keywords || `youtube_url_${Date.now()}`;
                } catch (error) {
                    console.error('URL ÌÇ§ÏõåÎìú Ï∂îÏ∂ú Ïò§Î•ò:', error);
                    return `url_keyword_${Date.now()}`;
                }
            }
            
            // ÎπÑÎîîÏò§ ID Ï∂îÏ∂ú
            extractVideoId(url) {
                let videoId = '';
                
                if (url.includes('watch?v=')) {
                    videoId = url.split('watch?v=')[1].split('&')[0];
                } else if (url.includes('youtu.be/')) {
                    videoId = url.split('youtu.be/')[1].split('?')[0];
                } else if (url.includes('/embed/')) {
                    videoId = url.split('/embed/')[1].split('?')[0];
                } else if (url.includes('/v/')) {
                    videoId = url.split('/v/')[1].split('?')[0];
                }
                
                return videoId;
            }
            
            // Ï±ÑÎÑê ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
            extractChannelKeyword(url) {
                if (url.includes('/@')) {
                    return url.split('/@')[1].split('/')[0];
                } else if (url.includes('/c/')) {
                    return url.split('/c/')[1].split('/')[0];
                } else if (url.includes('/channel/')) {
                    const channelId = url.split('/channel/')[1].split('/')[0];
                    return `ch_${channelId.substring(0, 8)}`;
                }
                return null;
            }
            
            // ÎπÑÎîîÏò§ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
            async getVideoInfo(videoId) {
                try {
                    const response = await fetch(
                        `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&part=snippet,statistics&key=${this.apiKey}`
                    );
                    
                    if (!response.ok) {
                        throw new Error('API ÏöîÏ≤≠ Ïã§Ìå®');
                    }
                    
                    const data = await response.json();
                    return data.items && data.items.length > 0 ? data.items[0] : null;
                } catch (error) {
                    console.error('ÎπÑÎîîÏò§ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error);
                    return null;
                }
            }
            
            // ÎπÑÎîîÏò§ Ï†ïÎ≥¥ÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
            extractKeywordsFromVideoInfo(videoInfo) {
                try {
                    const snippet = videoInfo.snippet;
                    let keywords = [];
                    
                    // Ï†úÎ™©ÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
                    const title = snippet.title || '';
                    const titleWords = title.split(/[\s\-_]+/)
                        .filter(word => word.length > 2 && word.length < 15)
                        .slice(0, 3);
                    keywords.push(...titleWords);
                    
                    // ÌÉúÍ∑∏Í∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©
                    if (snippet.tags && snippet.tags.length > 0) {
                        keywords.push(...snippet.tags.slice(0, 2));
                    }
                    
                    // Ïπ¥ÌÖåÍ≥†Î¶¨ IDÏóêÏÑú ÌÇ§ÏõåÎìú ÏÉùÏÑ± (ÏÑ†ÌÉùÏÇ¨Ìï≠)
                    if (snippet.categoryId) {
                        const categoryMap = {
                            '1': 'film', '2': 'autos', '10': 'music', '15': 'pets',
                            '17': 'sports', '19': 'travel', '20': 'gaming', '22': 'people',
                            '23': 'comedy', '24': 'entertainment', '25': 'news', '26': 'howto',
                            '27': 'education', '28': 'science'
                        };
                        const category = categoryMap[snippet.categoryId];
                        if (category) keywords.push(category);
                    }
                    
                    // Ï§ëÎ≥µ Ï†úÍ±∞ Î∞è Ï†ïÎ¶¨
                    keywords = [...new Set(keywords)]
                        .filter(keyword => keyword && keyword.length > 1)
                        .slice(0, 3);
                    
                    return keywords.length > 0 ? keywords.join('_') : `video_${videoInfo.id}`;
                } catch (error) {
                    console.error('ÎπÑÎîîÏò§ Ï†ïÎ≥¥ ÌÇ§ÏõåÎìú Ï∂îÏ∂ú Ïò§Î•ò:', error);
                    return `video_${videoInfo.id || Date.now()}`;
                }
            }
            
            // ÌÇ§ÏõåÎìú ÏÇ≠Ï†ú
            removeKeyword(index) {
                if (index >= 0 && index < this.keywords.length) {
                    const removed = this.keywords.splice(index, 1)[0];
                    this.updateKeywordsDisplay();
                    this.saveKeywords();
                    this.showNotification(`ÌÇ§ÏõåÎìú ÏÇ≠Ï†ú: ${removed.text}`, 'info');
                }
            }
            
            // ÌÇ§ÏõåÎìú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            updateKeywordsDisplay() {
                if (!this.keywordsDisplay) return;
                
                this.keywordsDisplay.innerHTML = '';
                
                this.keywords.forEach((keyword, index) => {
                    const tag = document.createElement('div');
                    tag.className = `keyword-tag ${keyword.type === 'url' ? 'url-tag' : ''}`;
                    
                    tag.innerHTML = `
                        <span>${keyword.text}</span>
                        <button class="remove-tag" onclick="youtubeApp.removeKeyword(${index})" title="ÏÇ≠Ï†ú">√ó</button>
                    `;
                    
                    this.keywordsDisplay.appendChild(tag);
                });
            }
            
            // ÌÇ§ÏõåÎìú Ï†ÄÏû•
            saveKeywords() {
                try {
                    localStorage.setItem('youtube-keywords', JSON.stringify(this.keywords));
                } catch (error) {
                    console.error('ÌÇ§ÏõåÎìú Ï†ÄÏû• Ïò§Î•ò:', error);
                }
            }
            
            // Ï†ÄÏû•Îêú ÌÇ§ÏõåÎìú Î°úÎìú
            loadSavedKeywords() {
                try {
                    const saved = localStorage.getItem('youtube-keywords');
                    if (saved) {
                        this.keywords = JSON.parse(saved);
                        this.updateKeywordsDisplay();
                    }
                } catch (error) {
                    console.error('ÌÇ§ÏõåÎìú Î°úÎìú Ïò§Î•ò:', error);
                    this.keywords = [];
                }
            }
            
            // Í≤ÄÏÉâÏóê ÏÇ¨Ïö©Ìï† ÌÇ§ÏõåÎìú Î¨∏ÏûêÏó¥ ÏÉùÏÑ±
            getSearchQuery() {
                if (this.keywords.length === 0) {
                    return this.keywordInput.value.trim();
                }
                return this.keywords.map(k => k.text).join(' ');
            }
            
            // ÏïåÎ¶º ÌëúÏãú
            showNotification(message, type = 'info') {
                // Í∞ÑÎã®Ìïú ÏïåÎ¶º ÏãúÏä§ÌÖú (Í∏∞Ï°¥ ÏΩîÎìúÏóê ÏïåÎ¶º ÏãúÏä§ÌÖúÏù¥ ÏûàÎã§Î©¥ Í∑∏Í≤ÉÏùÑ ÏÇ¨Ïö©)
                console.log(`[${type.toUpperCase()}] ${message}`);
                
                // ÏûÑÏãú ÏïåÎ¶º ÏöîÏÜå ÏÉùÏÑ±
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 10000;
                    opacity: 0;
                    transform: translateX(100%);
                    transition: all 0.3s ease;
                `;
                
                // ÌÉÄÏûÖÎ≥Ñ ÏÉâÏÉÅ ÏÑ§Ï†ï
                switch (type) {
                    case 'success':
                        notification.style.background = 'linear-gradient(135deg, #51cf66, #40c057)';
                        break;
                    case 'warning':
                        notification.style.background = 'linear-gradient(135deg, #ffd43b, #fab005)';
                        notification.style.color = '#333';
                        break;
                    case 'error':
                        notification.style.background = 'linear-gradient(135deg, #ff6b6b, #e03131)';
                        break;
                    default:
                        notification.style.background = 'linear-gradient(135deg, #45b7d1, #339af0)';
                }
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                // Ïï†ÎãàÎ©îÏù¥ÏÖò
                setTimeout(() => {
                    notification.style.opacity = '1';
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // 3Ï¥à ÌõÑ Ï†úÍ±∞
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
            // ===== Benchmarking (multi-select) =====
            initializeBenchmarkControls() {
                this.benchmarkControlsEl = document.getElementById('benchmark-controls');
                this.selectedCountEl = document.getElementById('selected-count');
                this.analyzeBenchmarkBtn = document.getElementById('analyze-benchmark-btn');
                this.viewBenchmarkReportBtn = document.getElementById('view-benchmark-report');
                const selectAllBtn = document.getElementById('select-all-btn');
                const deselectAllBtn = document.getElementById('deselect-all-btn');

                if (selectAllBtn) {
                    selectAllBtn.addEventListener('click', () => this.selectAllBenchmarkVideos());
                }
                if (deselectAllBtn) {
                    deselectAllBtn.addEventListener('click', () => this.deselectAllBenchmarkVideos());
                }
                if (this.analyzeBenchmarkBtn) {
                    this.analyzeBenchmarkBtn.addEventListener('click', () => this.analyzeSelectedBenchmarkVideos());
                }
                if (this.viewBenchmarkReportBtn) {
                    this.viewBenchmarkReportBtn.addEventListener('click', () => this.showBenchmarkReport());
                }

                this.updateBenchmarkControlsVisibility();
            }

            updateBenchmarkControlsVisibility() {
                const count = this.selectedVideos.size;
                if (this.selectedCountEl) this.selectedCountEl.textContent = String(count);
                if (this.benchmarkControlsEl) {
                    if (count > 0) this.benchmarkControlsEl.classList.add('show');
                    else this.benchmarkControlsEl.classList.remove('show');
                }
                if (this.analyzeBenchmarkBtn) this.analyzeBenchmarkBtn.disabled = count === 0;
                if (this.viewBenchmarkReportBtn) this.viewBenchmarkReportBtn.disabled = !this.benchmarkResults;
            }

            toggleBenchmarkSelection(videoId) {
                if (!videoId) return;
                const wasSelected = this.selectedVideos.has(videoId);
                if (wasSelected) this.selectedVideos.delete(videoId);
                else this.selectedVideos.add(videoId);

                const card = document.querySelector(`.video-card[data-video-id="${videoId}"]`);
                if (card) {
                    card.classList.toggle('benchmark-selected', !wasSelected);
                    const checkbox = card.querySelector('.benchmark-checkbox');
                    if (checkbox) checkbox.classList.toggle('checked', !wasSelected);
                }
                this.updateBenchmarkControlsVisibility();
            }

            selectAllBenchmarkVideos() {
                const cards = document.querySelectorAll('.results-grid .video-card[data-video-id]');
                cards.forEach(card => {
                    const vid = card.dataset.videoId;
                    if (vid) {
                        this.selectedVideos.add(vid);
                        card.classList.add('benchmark-selected');
                        const cb = card.querySelector('.benchmark-checkbox');
                        if (cb) cb.classList.add('checked');
                    }
                });
                this.updateBenchmarkControlsVisibility();
            }

            deselectAllBenchmarkVideos() {
                this.selectedVideos.clear();
                const cards = document.querySelectorAll('.results-grid .video-card');
                cards.forEach(card => {
                    card.classList.remove('benchmark-selected');
                    const cb = card.querySelector('.benchmark-checkbox');
                    if (cb) cb.classList.remove('checked');
                });
                this.updateBenchmarkControlsVisibility();
            }

            applyBenchmarkStateToCards() {
                const cards = document.querySelectorAll('.results-grid .video-card[data-video-id]');
                cards.forEach(card => {
                    const vid = card.dataset.videoId;
                    const selected = !!(vid && this.selectedVideos.has(vid));
                    card.classList.toggle('benchmark-selected', selected);
                    const cb = card.querySelector('.benchmark-checkbox');
                    if (cb) cb.classList.toggle('checked', selected);
                });
                this.updateBenchmarkControlsVisibility();
            }

            analyzeSelectedBenchmarkVideos() {
                const selectedIds = Array.from(this.selectedVideos);
                if (selectedIds.length === 0) {
                    this.showNotification('ÏÑ†ÌÉùÎêú ÏòÅÏÉÅÏù¥ ÏóÜÏäµÎãàÎã§.', 'warning');
                    return;
                }

                const pool = (this.filteredResults && this.filteredResults.length) ? this.filteredResults : this.currentResults;
                const byId = new Map();
                pool.forEach(item => {
                    const vid = item?.id?.videoId || item?.id;
                    if (vid) byId.set(vid, item);
                });
                const selectedItems = selectedIds.map(id => byId.get(id)).filter(Boolean);

                // Ensure we have full details (snippet tags/category, contentDetails)
                this.fetchBenchmarkVideoDetails(selectedIds).then(detailsMap => {
                    const enriched = selectedItems.map(it => {
                        const vid = it.id?.videoId || it.id;
                        const full = detailsMap.get(vid);
                        return full ? this.mergeVideoDetails(it, full) : it;
                    });

                const stats = { count: enriched.length, views: 0, likes: 0, comments: 0, outlierSum: 0, engagementSum: 0 };
                enriched.forEach(it => {
                    const s = it.statistics || {};
                    stats.views += parseInt(s.viewCount || '0');
                    stats.likes += parseInt(s.likeCount || '0');
                    stats.comments += parseInt(s.commentCount || '0');
                    stats.outlierSum += it.outlierScore || 0;
                    stats.engagementSum += (it.engagementRate || 0);
                });

                const avgViews = Math.round(stats.views / Math.max(1, stats.count));
                const avgOutlier = (stats.outlierSum / Math.max(1, stats.count)).toFixed(1);
                const avgEngagement = ((stats.engagementSum / Math.max(1, stats.count)) * 100).toFixed(2);

                const resultsEl = document.getElementById('benchmark-results');
                const summaryEl = document.getElementById('benchmark-summary');
                const detailsEl = document.getElementById('benchmark-details');
                if (resultsEl) resultsEl.style.display = 'block';
                if (summaryEl) {
                    summaryEl.innerHTML = `
                        <div class="benchmark-stat">
                            <div class="benchmark-stat-value">${stats.count}</div>
                            <div class="benchmark-stat-label">ÏÑ†ÌÉùÎêú ÏòÅÏÉÅ Ïàò</div>
                        </div>
                        <div class="benchmark-stat">
                            <div class="benchmark-stat-value">${formatNumber(avgViews)}</div>
                            <div class="benchmark-stat-label">ÌèâÍ∑† Ï°∞ÌöåÏàò</div>
                        </div>
                        <div class="benchmark-stat">
                            <div class="benchmark-stat-value">${avgOutlier}</div>
                            <div class="benchmark-stat-label">ÌèâÍ∑† Outlier Score</div>
                        </div>
                        <div class="benchmark-stat">
                            <div class="benchmark-stat-value">${avgEngagement}%</div>
                            <div class="benchmark-stat-label">ÌèâÍ∑† Ï∞∏Ïó¨Ïú®</div>
                        </div>
                    `;
                }
                if (detailsEl) {
                    detailsEl.innerHTML = enriched.slice(0, 50).map(it => {
                        const vid = it.id?.videoId || it.id;
                        const title = escapeHtml(it.snippet?.title || '');
                        const views = formatNumber(parseInt(it.statistics?.viewCount || '0'));
                        const outlier = (it.outlierScore || 0);
                        return `<div class="card" style="margin-bottom: 12px;"><div class="card-header"><h3>${title}</h3></div><div style=\"display:flex;gap:16px;\"><span>üëÄ ${views}</span><span>üìä ${outlier}Ï†ê</span></div></div>`;
                    }).join('');
                }

                // Save for full-screen report
                this.benchmarkResults = {
                    stats,
                    avgViews,
                    avgOutlier,
                    avgEngagement,
                    items: enriched
                };
                if (this.viewBenchmarkReportBtn) this.viewBenchmarkReportBtn.disabled = false;
                this.showNotification(`Î≤§ÏπòÎßàÌÇπ Î∂ÑÏÑù ÏôÑÎ£å: ${stats.count}Í∞ú ÏòÅÏÉÅ`, 'success');
            });
            }

            async fetchBenchmarkVideoDetails(ids) {
                const resultMap = new Map();
                if (!ids || ids.length === 0) return resultMap;
                const batchSize = 50;
                for (let i = 0; i < ids.length; i += batchSize) {
                    const chunk = ids.slice(i, i + batchSize).join(',');
                    const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id=${chunk}&key=${this.apiKey}`;
                    try {
                        const res = await fetch(url);
                        const data = await res.json();
                        (data.items || []).forEach(v => {
                            const vid = v.id;
                            resultMap.set(vid, v);
                        });
                    } catch (e) {
                        console.warn('ÏÑ∏Î∂Ä Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', e);
                    }
                }
                return resultMap;
            }

            mergeVideoDetails(baseItem, full) {
                // Merge snippet, statistics, and contentDetails without overwriting existing computed fields
                const merged = { ...baseItem };
                merged.id = baseItem.id?.videoId ? baseItem.id : { videoId: full.id };
                merged.snippet = { ...(baseItem.snippet || {}), ...(full.snippet || {}) };
                merged.statistics = { ...(baseItem.statistics || {}), ...(full.statistics || {}) };
                merged.contentDetails = { ...(baseItem.contentDetails || {}), ...(full.contentDetails || {}) };
                return merged;
            }

            showBenchmarkReport() {
                const overlay = document.getElementById('benchmark-report-overlay');
                const body = document.getElementById('benchmark-report-body');
                const closeBtn = document.getElementById('close-benchmark-report');
                if (!overlay || !body || !this.benchmarkResults) return;

                overlay.style.display = 'flex';
                if (closeBtn) closeBtn.onclick = () => { overlay.style.display = 'none'; };

                const { stats, avgViews, avgOutlier, avgEngagement, items } = this.benchmarkResults;
                const topByViews = [...items].sort((a,b) => (parseInt(b.statistics?.viewCount||0) - parseInt(a.statistics?.viewCount||0))).slice(0,5);
                const topByOutlier = [...items].sort((a,b) => (b.outlierScore||0) - (a.outlierScore||0)).slice(0,5);

                const consulting = this.buildConsultingRecommendations(items);

                body.innerHTML = `
                    <div class=\"report-grid\">
                        <div class=\"report-card\">
                            <h4>üìä ÏöîÏïΩ ÌÜµÍ≥Ñ</h4>
                            <div class=\"benchmark-summary\">
                                <div class=\"benchmark-stat\"><div class=\"benchmark-stat-value\">${stats.count}</div><div class=\"benchmark-stat-label\">ÏÑ†ÌÉùÎêú ÏòÅÏÉÅ</div></div>
                                <div class=\"benchmark-stat\"><div class=\"benchmark-stat-value\">${formatNumber(avgViews)}</div><div class=\"benchmark-stat-label\">ÌèâÍ∑† Ï°∞ÌöåÏàò</div></div>
                                <div class=\"benchmark-stat\"><div class=\"benchmark-stat-value\">${avgOutlier}</div><div class=\"benchmark-stat-label\">ÌèâÍ∑† Outlier</div></div>
                                <div class=\"benchmark-stat\"><div class=\"benchmark-stat-value\">${avgEngagement}%</div><div class=\"benchmark-stat-label\">ÌèâÍ∑† Ï∞∏Ïó¨Ïú®</div></div>
                            </div>
                        </div>
                        <div class=\"report-card\">
                            <h4>üèÜ ÏÉÅÏúÑ ÏòÅÏÉÅ (Ï°∞ÌöåÏàò)</h4>
                            ${topByViews.map(v => `<div style=\\\"margin-bottom:8px;\\\">${escapeHtml(v.snippet?.title||'')} ‚Äî üëÄ ${formatNumber(parseInt(v.statistics?.viewCount||0))}</div>`).join('')}
                        </div>
                        <div class=\"report-card\">
                            <h4>üìà ÏÉÅÏúÑ ÏòÅÏÉÅ (Outlier)</h4>
                            ${topByOutlier.map(v => `<div style=\\\"margin-bottom:8px;\\\">${escapeHtml(v.snippet?.title||'')} ‚Äî üìä ${v.outlierScore||0}</div>`).join('')}
                        </div>
                    </div>
                    
                    <!-- Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ ÏÑπÏÖò -->
                    <div class=\"consulting-section\">
                        <h2>üéØ Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ Î¶¨Ìè¨Ìä∏ (100ÎßåÏõêÍ∏â Î∂ÑÏÑù)</h2>
                        
                        <!-- Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ï†ÑÎ¨∏Í∞Ä -->
                        <div class=\"consulting-item\">
                            <h3>${consulting.dataAnalysis.title}</h3>
                            <div class=\"insights\">
                                <h4>üìà ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏</h4>
                                <ul>
                                    ${consulting.dataAnalysis.insights.map(insight => `<li>${insight}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"recommendations\">
                                <h4>üí° Ï†ÑÎ¨∏Í∞Ä Ï∂îÏ≤úÏÇ¨Ìï≠</h4>
                                <ul>
                                    ${consulting.dataAnalysis.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"action-items\">
                                <h4>üéØ Ïã§Ìñâ Ïï°ÏÖò ÏïÑÏù¥ÌÖú</h4>
                                <ul>
                                    ${consulting.dataAnalysis.actionItems.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- ÏΩòÌÖêÏ∏† Ï†ÑÎûµ Ï†ÑÎ¨∏Í∞Ä -->
                        <div class=\"consulting-item\">
                            <h3>${consulting.contentStrategy.title}</h3>
                            <div class=\"insights\">
                                <h4>üìà ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏</h4>
                                <ul>
                                    ${consulting.contentStrategy.insights.map(insight => `<li>${insight}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"recommendations\">
                                <h4>üí° Ï†ÑÎ¨∏Í∞Ä Ï∂îÏ≤úÏÇ¨Ìï≠</h4>
                                <ul>
                                    ${consulting.contentStrategy.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"content-ideas\">
                                <h4>üöÄ ÏΩòÌÖêÏ∏† ÏïÑÏù¥ÎîîÏñ¥</h4>
                                <ul>
                                    ${consulting.contentStrategy.contentIdeas.map(idea => `<li>${idea}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- SEO/ÏïåÍ≥†Î¶¨Ï¶ò Ï†ÑÎ¨∏Í∞Ä -->
                        <div class=\"consulting-item\">
                            <h3>${consulting.seoStrategy.title}</h3>
                            <div class=\"insights\">
                                <h4>üìà ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏</h4>
                                <ul>
                                    ${consulting.seoStrategy.insights.map(insight => `<li>${insight}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"recommendations\">
                                <h4>üí° Ï†ÑÎ¨∏Í∞Ä Ï∂îÏ≤úÏÇ¨Ìï≠</h4>
                                <ul>
                                    ${consulting.seoStrategy.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"seo-optimization\">
                                <h4>üîß SEO ÏµúÏ†ÅÌôî Í∞ÄÏù¥Îìú</h4>
                                <ul>
                                    <li><strong>Ï†úÎ™© ÏµúÏ†ÅÌôî:</strong> ${consulting.seoStrategy.seoOptimization.titleOptimization}</li>
                                    <li><strong>ÏÑ§Î™Ö ÏµúÏ†ÅÌôî:</strong> ${consulting.seoStrategy.seoOptimization.descriptionOptimization}</li>
                                    <li><strong>ÌÉúÍ∑∏ ÏµúÏ†ÅÌôî:</strong> ${consulting.seoStrategy.seoOptimization.tagOptimization}</li>
                                    <li><strong>Ïç∏ÎÑ§Ïùº ÏµúÏ†ÅÌôî:</strong> ${consulting.seoStrategy.seoOptimization.thumbnailOptimization}</li>
                                </ul>
                            </div>
                        </div>

                        <!-- ÏãúÍ∞ÅÏ†Å/Ïç∏ÎÑ§Ïùº Ï†ÑÎ¨∏Í∞Ä -->
                        <div class=\"consulting-item\">
                            <h3>${consulting.visualStrategy.title}</h3>
                            <div class=\"insights\">
                                <h4>üìà ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏</h4>
                                <ul>
                                    ${consulting.visualStrategy.insights.map(insight => `<li>${insight}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"recommendations\">
                                <h4>üí° Ï†ÑÎ¨∏Í∞Ä Ï∂îÏ≤úÏÇ¨Ìï≠</h4>
                                <ul>
                                    ${consulting.visualStrategy.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"thumbnail-templates\">
                                <h4>üé® Ïç∏ÎÑ§Ïùº ÌÖúÌîåÎ¶ø</h4>
                                <ul>
                                    ${consulting.visualStrategy.thumbnailTemplates.map(template => `<li>${template}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- Ïä§ÌÅ¨Î¶ΩÌä∏/Íµ¨ÏÑ± Ï†ÑÎ¨∏Í∞Ä -->
                        <div class=\"consulting-item\">
                            <h3>${consulting.scriptStrategy.title}</h3>
                            <div class=\"insights\">
                                <h4>üìà ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏</h4>
                                <ul>
                                    ${consulting.scriptStrategy.insights.map(insight => `<li>${insight}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"recommendations\">
                                <h4>üí° Ï†ÑÎ¨∏Í∞Ä Ï∂îÏ≤úÏÇ¨Ìï≠</h4>
                                <ul>
                                    ${consulting.scriptStrategy.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"script-templates\">
                                <h4>üìù Ïä§ÌÅ¨Î¶ΩÌä∏ ÌÖúÌîåÎ¶ø</h4>
                                <ul>
                                    <li><strong>ÌõÑÌÇπ:</strong> ${consulting.scriptStrategy.scriptTemplates.hook}</li>
                                    <li><strong>Î¨∏Ï†ú Ï†úÍ∏∞:</strong> ${consulting.scriptStrategy.scriptTemplates.problem}</li>
                                    <li><strong>Ìï¥Í≤∞Ï±Ö:</strong> ${consulting.scriptStrategy.scriptTemplates.solution}</li>
                                    <li><strong>CTA:</strong> ${consulting.scriptStrategy.scriptTemplates.cta}</li>
                                </ul>
                            </div>
                        </div>

                        <!-- ÎßàÏºÄÌåÖ/Î∏åÎûúÎî© Ï†ÑÎ¨∏Í∞Ä -->
                        <div class=\"consulting-item\">
                            <h3>${consulting.marketingStrategy.title}</h3>
                            <div class=\"insights\">
                                <h4>üìà ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏</h4>
                                <ul>
                                    ${consulting.marketingStrategy.insights.map(insight => `<li>${insight}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"recommendations\">
                                <h4>üí° Ï†ÑÎ¨∏Í∞Ä Ï∂îÏ≤úÏÇ¨Ìï≠</h4>
                                <ul>
                                    ${consulting.marketingStrategy.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                            <div class=\"marketing-channels\">
                                <h4>üöÄ ÎßàÏºÄÌåÖ Ï±ÑÎÑê</h4>
                                <ul>
                                    ${consulting.marketingStrategy.marketingChannels.map(channel => `<li>${channel}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- Ïã§Ìñâ Î°úÎìúÎßµ -->
                        <div class=\"consulting-item\">
                            <h3>${consulting.actionPlan.title}</h3>
                            <div class=\"phases\">
                                ${consulting.actionPlan.phases.map(phase => `
                                    <div class=\"phase\">
                                        <h4>${phase.phase}</h4>
                                        <ul>
                                            ${phase.tasks.map(task => `<li>${task}</li>`).join('')}
                                        </ul>
                                    </div>
                                `).join('')}
                            </div>
                            <div class=\"kpis\">
                                <h4>üéØ ÌïµÏã¨ ÏÑ±Í≥º ÏßÄÌëú (KPI)</h4>
                                <ul>
                                    ${consulting.actionPlan.kpis.map(kpi => `<li>${kpi}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class=\"report-card\">
                        <h4>üìã ÏÉÅÏÑ∏ Î∂ÑÏÑù (Í∞Å ÏòÅÏÉÅ)</h4>
                        ${items.map(v => {
                            const vid = v.id?.videoId || v.id;
                            const s = v.snippet || {};
                            const cd = v.contentDetails || {};
                            const st = v.statistics || {};
                            const tags = (s.tags || []).slice(0,10).map(t => `#${escapeHtml(t)}`).join(' ');
                            const caption = cd.caption === 'true' ? 'ÏûàÏùå' : (cd.caption === 'false' ? 'ÏóÜÏùå' : (cd.caption || 'ÎØ∏ÏÉÅ'));
                            const cr = cd.contentRating ? 'Ï†úÌïú ÏûàÏùå' : 'Ï†úÌïú ÏóÜÏùå';
                            return `
                                <div class=\\\"card\\\" style=\\\"margin-bottom:16px;\\\">
                                    <div class=\\\"card-header\\\"><h3>${escapeHtml(s.title || '')}</h3></div>
                                    <div class=\\\"card-body\\\">
                                        <div style=\\\"display:grid;gap:8px;\\\">
                                            <div><strong>Ï†úÎ™©</strong>: ${escapeHtml(s.title || '')}</div>
                                            <div><strong>ÏÑ§Î™Ö</strong>: ${escapeHtml((s.description || '').slice(0,400))}${(s.description||'').length>400?'‚Ä¶':''}</div>
                                            <div><strong>ÌÉúÍ∑∏</strong>: ${tags || '‚Äî'}</div>
                                            <div><strong>Ïπ¥ÌÖåÍ≥†Î¶¨ID</strong>: ${s.categoryId || '‚Äî'}</div>
                                            <div><strong>Í≤åÏãúÏùº</strong>: ${formatDate(s.publishedAt)}</div>
                                            <div><strong>Í∏∏Ïù¥</strong>: ${formatDuration(cd.duration || '')}</div>
                                            <div><strong>ÏûêÎßâ</strong>: ${caption}</div>
                                            <div><strong>Ïó∞Î†π Ï†úÌïú</strong>: ${cr}</div>
                                            <div><strong>Ï°∞ÌöåÏàò</strong>: ${formatNumber(parseInt(st.viewCount||'0'))} | <strong>Ï¢ãÏïÑÏöî</strong>: ${formatNumber(parseInt(st.likeCount||'0'))} | <strong>ÎåìÍ∏Ä</strong>: ${formatNumber(parseInt(st.commentCount||'0'))}</div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                // Optional Gemini hook
                const genBtn = document.getElementById('btn-generate-thumb');
                const preview = document.getElementById('thumb-preview');
                if (genBtn && preview) {
                    genBtn.onclick = async () => {
                        genBtn.disabled = true;
                        genBtn.textContent = 'ÏÉùÏÑ± Ï§ë...';
                        try {
                            const url = await this.generateThumbnailWithGemini(consulting.thumbnailPrompt);
                            if (url) {
                                preview.innerHTML = `<img src=\"${url}\" alt=\"thumbnail\" style=\"max-width:100%;border-radius:8px;border:1px solid rgba(255,255,255,0.2);\"/>`;
                            } else {
                                preview.innerHTML = '<div>ÏÉùÏÑ± Í≤∞Í≥ºÎ•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</div>';
                            }
                        } catch (e) {
                            preview.innerHTML = '<div>ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</div>';
                        } finally {
                            genBtn.disabled = false;
                            genBtn.textContent = 'GeminiÎ°ú Ïç∏ÎÑ§Ïùº ÏÉùÏÑ±(Ïã§Ìóò)';
                        }
                    };
                }
            }

            buildConsultingRecommendations(items) {
                // Í≥†Í∏â Î∂ÑÏÑù ÏßÄÌëú Í≥ÑÏÇ∞
                const analysis = this.performAdvancedAnalysis(items);
                
                // Î∂ÑÏïºÎ≥Ñ Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ
                const consulting = {
                    // 1. Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ
                    dataAnalysis: this.generateDataAnalysisReport(analysis),
                    
                    // 2. ÏΩòÌÖêÏ∏† Ï†ÑÎûµ Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ  
                    contentStrategy: this.generateContentStrategyReport(analysis, items),
                    
                    // 3. SEO/ÏïåÍ≥†Î¶¨Ï¶ò Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ
                    seoStrategy: this.generateSEOStrategyReport(analysis, items),
                    
                    // 4. Ïç∏ÎÑ§Ïùº/ÏãúÍ∞ÅÏ†Å Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ
                    visualStrategy: this.generateVisualStrategyReport(analysis, items),
                    
                    // 5. Ïä§ÌÅ¨Î¶ΩÌä∏/Íµ¨ÏÑ± Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ
                    scriptStrategy: this.generateScriptStrategyReport(analysis, items),
                    
                    // 6. ÎßàÏºÄÌåÖ/Î∏åÎûúÎî© Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ
                    marketingStrategy: this.generateMarketingStrategyReport(analysis, items),
                    
                    // 7. Ïã§Ìñâ Î°úÎìúÎßµ
                    actionPlan: this.generateActionPlan(analysis, items),
                    
                    // Í∏∞Ï°¥ Ìò∏ÌôòÏÑ±ÏùÑ ÏúÑÌïú Î†àÍ±∞Ïãú ÌïÑÎìúÎì§
                    strengths: analysis.basic.avgViews > 100000 ? 'ÎÜíÏùÄ ÌèâÍ∑† Ï°∞ÌöåÏàò' : 'Í∞úÏÑ† Ïó¨ÏßÄ ÏûàÏùå',
                    weaknesses: analysis.basic.engagementRate < 3 ? 'Ï∞∏Ïó¨ÎèÑ Í∞úÏÑ† ÌïÑÏöî' : 'ÏñëÌò∏Ìïú Ï∞∏Ïó¨ÎèÑ',
                    strategy: 'Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ Î¶¨Ìè¨Ìä∏Î•º Ï∞∏Í≥†ÌïòÏó¨ Ï†ÑÎûµ ÏàòÎ¶Ω',
                    title: 'Ï°∞ÌöåÏàò 100Îßå Îã¨ÏÑ± ÎπÑÎ≤ï: [ÌïµÏã¨ ÌÇ§ÏõåÎìú]Î°ú 7Ïùº ÎßåÏóê Í≤∞Í≥º ÎßåÎì§Í∏∞ (Ïã§Ï†Ñ Í∞ÄÏù¥Îìú)',
                    description: `Ïù¥ ÏòÅÏÉÅÏùÄ [ÌïµÏã¨ ÌÇ§ÏõåÎìú] Ï£ºÏ†úÎ°ú 100Îßå Ï°∞ÌöåÏàòÎ•º Î™©ÌëúÎ°ú Ï†úÏûëÎêú Ïã§Ï†Ñ Í∞ÄÏù¥ÎìúÏûÖÎãàÎã§.\n\nÌÉÄÏûÑÎùºÏù∏\n00:00 ÌõÑÌÇπ ‚Äî Ïôú ÏßÄÍ∏à [ÌÇ§ÏõåÎìú]Ïù∏Í∞Ä\n00:20 Ïã§Ï†Ñ Î™©Ìëú/Í≤∞Í≥º ÎØ∏Î¶¨Î≥¥Í∏∞\n01:00 ÌïµÏã¨ Ï†ÑÎûµ ÏöîÏïΩ(3Í∞ÄÏßÄ)\n03:00 Îã®Í≥ÑÎ≥Ñ Ïã§Ïäµ A\n07:00 Îã®Í≥ÑÎ≥Ñ Ïã§Ïäµ B\n12:00 ÏûêÏ£º ÌïòÎäî Ïã§Ïàò/Ìï¥Í≤∞\n14:00 Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏/ÌÖúÌîåÎ¶ø Ï†úÍ≥µ\n\nÌï¥ÏãúÌÉúÍ∑∏\n#[ÌÇ§ÏõåÎìú] #[Ïπ¥ÌÖåÍ≥†Î¶¨] #[Ìä∏Î†åÎìú]`,
                    hook: '"ÏßÄÍ∏àÎ∂ÄÌÑ∞ 7Ïùº ÏïàÏóê [ÌÇ§ÏõåÎìú]Î°ú Í≤∞Í≥ºÎ•º ÎÇ¥Îäî Í∞ÄÏû• Îπ†Î•∏ Î∞©Î≤ïÏùÑ Í≥µÍ∞úÌï©ÎãàÎã§. Ïã§Ìå®ÌñàÎçò ÏÇ¨ÎûåÎì§ÎèÑ Ïù¥ ÏàúÏÑúÎåÄÎ°úÎßå ÌïòÎ©¥ Îã¨ÎùºÏßëÎãàÎã§."',
                    script: `1) Hook (0:00-0:20): Î¨∏Ï†ú/Í∏∞Ìöå Ï†úÏãú, Í∞ïÌïú ÏïΩÏÜç\n2) Preview (0:20-0:40): Í≤∞Í≥º/ÏÇ¨Î°Ä Ïä§ÎãàÌé´\n3) Setup (0:40-1:10): Ï§ÄÎπÑÎ¨º/ÏÇ¨Ï†ÑÏßÄÏãù\n4) Core Steps (1:10-9:00): 3-5 Îã®Í≥Ñ, Í∞Å Îã®Í≥Ñ 60-120Ï¥à\n5) Proof (9:00-10:30): Ï†Ñ/ÌõÑ ÎπÑÍµê, Ïã§Ï†ú ÌôîÎ©¥\n6) Pitfalls (10:30-12:00): ÌùîÌïú Ïã§Ïàò 3Í∞ÄÏßÄ\n7) CTA (12:00-12:30): ÎåìÍ∏Ä Ïú†ÎèÑ ÏßàÎ¨∏ + Îã§ÏùåÌé∏ Ìã∞Ï†Ä`,
                    structure: `- Ïò§ÌîÑÎãù: 20Ï¥à ÎÇ¥ Í∞ïÌïú ÎπÑÏ£ºÏñºÍ≥º Í≤∞Í≥º ÎØ∏Î¶¨Î≥¥Í∏∞\n- Î≥∏Î¨∏: Îã®Í≥ÑÎ≥Ñ ÏãúÏó∞ + Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ïò§Î≤ÑÎ†àÏù¥\n- B-roll: ÏÜê/ÌôîÎ©¥ ÌÅ¥Î°úÏ¶àÏóÖ, ÌÖçÏä§Ìä∏ Ìåù\n- Ïò§ÎîîÏò§: Í≤ΩÏæåÌïú bpm 100-110, Ï†ÑÌôòÎßàÎã§ Î¶¨Îì¨ Ìè¨Ïù∏Ìä∏`,
                    thumbnailPrompt: `Ultra-detailed thumbnail for YouTube about [ÌïµÏã¨ ÌÇ§ÏõåÎìú]. One main subject, high-contrast colors, bold 2-3 word overlay in Korean, expressive face or clear object, clean background, cinematic lighting, 4k, no clutter.`
                };

                return consulting;
            }

            performAdvancedAnalysis(items) {
                const views = items.map(v => parseInt(v.statistics?.viewCount||'0')).filter(n=>!isNaN(n));
                const likes = items.map(v => parseInt(v.statistics?.likeCount||'0')).filter(n=>!isNaN(n));
                const comments = items.map(v => parseInt(v.statistics?.commentCount||'0')).filter(n=>!isNaN(n));
                const durations = items.map(v => this.parseDuration(v.contentDetails?.duration||'PT0S')).filter(n=>!isNaN(n));
                
                const totalViews = views.reduce((a,b)=>a+b,0);
                const avgViews = views.length ? totalViews/views.length : 0;
                const maxViews = Math.max(...views);
                const minViews = Math.min(...views);
                
                // CTR Ï∂îÏ†ï (Ï°∞ÌöåÏàò Í∏∞Î∞ò)
                const estimatedCTR = this.estimateCTR(avgViews, items.length);
                
                // AVD (Average View Duration) Ï∂îÏ†ï
                const estimatedAVD = this.estimateAVD(durations, views);
                
                // Engagement Rate Í≥ÑÏÇ∞
                const totalEngagement = likes.reduce((a,b)=>a+b,0) + comments.reduce((a,b)=>a+b,0);
                const engagementRate = totalViews ? (totalEngagement / totalViews * 100) : 0;
                
                // Retention Curve Ï∂îÏ†ï
                const retentionCurve = this.estimateRetentionCurve(durations, views);
                
                // Í≤ΩÏüÅÏÇ¨ Î∂ÑÏÑù
                const competitiveAnalysis = this.analyzeCompetition(items);
                
                // ÌÇ§ÏõåÎìú Î∂ÑÏÑù
                const keywordAnalysis = this.analyzeKeywords(items);
                
                // ÏãúÍ∞ÑÎåÄ Î∂ÑÏÑù
                const timeAnalysis = this.analyzePublishTimes(items);
                
                // Ïπ¥ÌÖåÍ≥†Î¶¨ Î∂ÑÏÑù
                const categoryAnalysis = this.analyzeCategories(items);
                
                return {
                    basic: { totalViews, avgViews, maxViews, minViews, engagementRate },
                    advanced: { estimatedCTR, estimatedAVD, retentionCurve },
                    competitive: competitiveAnalysis,
                    keywords: keywordAnalysis,
                    timing: timeAnalysis,
                    categories: categoryAnalysis,
                    items: items
                };
            }

            estimateCTR(avgViews, itemCount) {
                // CTR Ï∂îÏ†ï Î°úÏßÅ (Ïã§Ï†úÎ°úÎäî Îçî Î≥µÏû°Ìïú ÏïåÍ≥†Î¶¨Ï¶ò ÌïÑÏöî)
                if (avgViews > 1000000) return 8.5;
                if (avgViews > 500000) return 6.2;
                if (avgViews > 100000) return 4.8;
                if (avgViews > 50000) return 3.2;
                if (avgViews > 10000) return 2.1;
                return 1.5;
            }

            estimateAVD(durations, views) {
                if (durations.length === 0) return 0;
                const avgDuration = durations.reduce((a,b)=>a+b,0) / durations.length;
                const avgViews = views.reduce((a,b)=>a+b,0) / views.length;
                
                // AVD Ï∂îÏ†ï (Ïã§Ï†úÎ°úÎäî Îçî Ï†ïÍµêÌïú Í≥ÑÏÇ∞ ÌïÑÏöî)
                if (avgViews > 1000000) return avgDuration * 0.75;
                if (avgViews > 500000) return avgDuration * 0.65;
                if (avgViews > 100000) return avgDuration * 0.55;
                return avgDuration * 0.45;
            }

            estimateRetentionCurve(durations, views) {
                // Retention Curve Ï∂îÏ†ï (Ïã§Ï†úÎ°úÎäî YouTube Analytics Îç∞Ïù¥ÌÑ∞ ÌïÑÏöî)
                return {
                    '0-15Ï¥à': 85,
                    '15-30Ï¥à': 72,
                    '30-60Ï¥à': 58,
                    '1-2Î∂Ñ': 45,
                    '2-5Î∂Ñ': 32,
                    '5Î∂Ñ+': 18
                };
            }

            analyzeCompetition(items) {
                const categories = {};
                const channels = {};
                const publishDates = [];
                
                items.forEach(item => {
                    const category = item.snippet?.categoryId || 'unknown';
                    const channel = item.snippet?.channelTitle || 'unknown';
                    const publishDate = new Date(item.snippet?.publishedAt);
                    
                    categories[category] = (categories[category] || 0) + 1;
                    channels[channel] = (channels[channel] || 0) + 1;
                    publishDates.push(publishDate);
                });
                
                return {
                    topCategories: Object.entries(categories).sort((a,b)=>b[1]-a[1]).slice(0,3),
                    topChannels: Object.entries(channels).sort((a,b)=>b[1]-a[1]).slice(0,5),
                    publishFrequency: this.calculatePublishFrequency(publishDates),
                    marketSaturation: this.calculateMarketSaturation(categories)
                };
            }

            analyzeKeywords(items) {
                const allTitles = items.map(item => item.snippet?.title || '').join(' ');
                const allDescriptions = items.map(item => item.snippet?.description || '').join(' ');
                const allTags = items.flatMap(item => item.snippet?.tags || []);
                
                // ÌÇ§ÏõåÎìú Ï∂îÏ∂ú Î∞è ÎπàÎèÑ Î∂ÑÏÑù
                const titleKeywords = this.extractKeywords(allTitles);
                const descriptionKeywords = this.extractKeywords(allDescriptions);
                const tagKeywords = this.analyzeTagFrequency(allTags);
                
                return {
                    titleKeywords: titleKeywords.slice(0, 10),
                    descriptionKeywords: descriptionKeywords.slice(0, 15),
                    tagKeywords: tagKeywords.slice(0, 20),
                    keywordDensity: this.calculateKeywordDensity(titleKeywords, allTitles),
                    trendingKeywords: this.identifyTrendingKeywords(titleKeywords, descriptionKeywords)
                };
            }

            analyzePublishTimes(items) {
                const publishTimes = items.map(item => {
                    const date = new Date(item.snippet?.publishedAt);
                    return {
                        hour: date.getHours(),
                        day: date.getDay(),
                        month: date.getMonth()
                    };
                });
                
                const hourDistribution = {};
                const dayDistribution = {};
                
                publishTimes.forEach(time => {
                    hourDistribution[time.hour] = (hourDistribution[time.hour] || 0) + 1;
                    dayDistribution[time.day] = (dayDistribution[time.day] || 0) + 1;
                });
                
                return {
                    bestHours: Object.entries(hourDistribution).sort((a,b)=>b[1]-a[1]).slice(0,3),
                    bestDays: Object.entries(dayDistribution).sort((a,b)=>b[1]-a[1]).slice(0,3),
                    optimalPublishTime: this.calculateOptimalPublishTime(hourDistribution, dayDistribution)
                };
            }

            analyzeCategories(items) {
                const categoryStats = {};
                
                items.forEach(item => {
                    const category = item.snippet?.categoryId || 'unknown';
                    const views = parseInt(item.statistics?.viewCount || 0);
                    const likes = parseInt(item.statistics?.likeCount || 0);
                    const comments = parseInt(item.statistics?.commentCount || 0);
                    
                    if (!categoryStats[category]) {
                        categoryStats[category] = {
                            count: 0,
                            totalViews: 0,
                            totalLikes: 0,
                            totalComments: 0,
                            avgViews: 0,
                            avgEngagement: 0
                        };
                    }
                    
                    categoryStats[category].count++;
                    categoryStats[category].totalViews += views;
                    categoryStats[category].totalLikes += likes;
                    categoryStats[category].totalComments += comments;
                });
                
                // ÌèâÍ∑† Í≥ÑÏÇ∞
                Object.keys(categoryStats).forEach(category => {
                    const stats = categoryStats[category];
                    stats.avgViews = stats.totalViews / stats.count;
                    stats.avgEngagement = stats.totalViews > 0 ? 
                        ((stats.totalLikes + stats.totalComments) / stats.totalViews * 100) : 0;
                });
                
                return categoryStats;
            }

            // ÌÇ§ÏõåÎìú Ï∂îÏ∂ú Ìï®ÏàòÎì§
            extractKeywords(text) {
                const words = text.toLowerCase()
                    .replace(/[^\w\sÍ∞Ä-Ìû£]/g, ' ')
                    .split(/\s+/)
                    .filter(word => word.length > 1);
                
                const frequency = {};
                words.forEach(word => {
                    frequency[word] = (frequency[word] || 0) + 1;
                });
                
                return Object.entries(frequency)
                    .sort((a,b) => b[1] - a[1])
                    .map(([word, freq]) => ({ word, frequency: freq }));
            }

            analyzeTagFrequency(tags) {
                const frequency = {};
                tags.forEach(tag => {
                    frequency[tag] = (frequency[tag] || 0) + 1;
                });
                
                return Object.entries(frequency)
                    .sort((a,b) => b[1] - a[1])
                    .map(([tag, freq]) => ({ tag, frequency: freq }));
            }

            calculateKeywordDensity(keywords, text) {
                const totalWords = text.split(/\s+/).length;
                return keywords.slice(0, 5).map(kw => ({
                    word: kw.word,
                    density: (kw.frequency / totalWords * 100).toFixed(2) + '%'
                }));
            }

            identifyTrendingKeywords(titleKeywords, descriptionKeywords) {
                const trending = [];
                const titleWords = new Set(titleKeywords.slice(0, 10).map(k => k.word));
                
                descriptionKeywords.forEach(descKw => {
                    if (titleWords.has(descKw.word) && descKw.frequency > 2) {
                        trending.push(descKw);
                    }
                });
                
                return trending.sort((a,b) => b.frequency - a.frequency).slice(0, 5);
            }

            calculatePublishFrequency(dates) {
                if (dates.length < 2) return 'Îç∞Ïù¥ÌÑ∞ Î∂ÄÏ°±';
                
                const sortedDates = dates.sort((a,b) => a - b);
                const timeDiff = sortedDates[sortedDates.length - 1] - sortedDates[0];
                const daysDiff = timeDiff / (1000 * 60 * 60 * 24);
                const frequency = dates.length / daysDiff;
                
                if (frequency > 1) return 'Îß§Ïùº';
                if (frequency > 0.5) return '2ÏùºÎßàÎã§';
                if (frequency > 0.25) return 'Ï£º 2-3Ìöå';
                if (frequency > 0.1) return 'Ï£º 1Ìöå';
                return 'Ïõî 1-2Ìöå';
            }

            calculateMarketSaturation(categories) {
                const total = Object.values(categories).reduce((a,b) => a+b, 0);
                const topCategory = Math.max(...Object.values(categories));
                return (topCategory / total * 100).toFixed(1) + '%';
            }

            calculateOptimalPublishTime(hourDist, dayDist) {
                const bestHour = Object.entries(hourDist).sort((a,b)=>b[1]-a[1])[0];
                const bestDay = Object.entries(dayDist).sort((a,b)=>b[1]-a[1])[0];
                
                const dayNames = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
                return `${dayNames[bestDay[0]]}ÏöîÏùº ${bestHour[0]}Ïãú`;
            }

            // Ï†ÑÎ¨∏Í∞Ä Ïª®ÏÑ§ÌåÖ Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ìï®ÏàòÎì§
            generateDataAnalysisReport(analysis) {
                const { basic, advanced, competitive } = analysis;
                
                return {
                    title: "üìä Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ï†ÑÎ¨∏Í∞Ä Î¶¨Ìè¨Ìä∏",
                    insights: [
                        `ÌòÑÏû¨ ÌèâÍ∑† Ï°∞ÌöåÏàò: ${formatNumber(basic.avgViews)} (ÏµúÍ≥†: ${formatNumber(basic.maxViews)})`,
                        `Ï∂îÏ†ï CTR: ${advanced.estimatedCTR}% (ÏóÖÍ≥Ñ ÌèâÍ∑†: 2-5%)`,
                        `Ï∂îÏ†ï AVD: ${Math.round(advanced.estimatedAVD/60)}Î∂Ñ (Î™©Ìëú: 50% Ïù¥ÏÉÅ)`,
                        `Ï∞∏Ïó¨Ïú®: ${basic.engagementRate.toFixed(2)}% (Î™©Ìëú: 3% Ïù¥ÏÉÅ)`,
                        `ÏãúÏû• Ìè¨ÌôîÎèÑ: ${competitive.marketSaturation} (${competitive.topCategories[0]?.[0] || 'N/A'} Ïπ¥ÌÖåÍ≥†Î¶¨ ÏßëÏ§ë)`
                    ],
                    recommendations: [
                        basic.avgViews < 100000 ? "Ï°∞ÌöåÏàò 10Îßå ÎèåÌååÎ•º ÏúÑÌïú Ï†úÎ™©/Ïç∏ÎÑ§Ïùº ÏµúÏ†ÅÌôî ÌïÑÏöî" : "ÌòÑÏû¨ Ï°∞ÌöåÏàò ÏàòÏ§Ä Ïú†ÏßÄÌïòÎ©∞ Ï∞∏Ïó¨ÎèÑ Í∞úÏÑ†",
                        advanced.estimatedCTR < 3 ? "CTR Í∞úÏÑ†ÏùÑ ÏúÑÌïú Ïç∏ÎÑ§Ïùº A/B ÌÖåÏä§Ìä∏ Ïã§Ïãú" : "ÌòÑÏû¨ CTR ÏàòÏ§Ä Ïú†ÏßÄ",
                        basic.engagementRate < 3 ? "ÎåìÍ∏Ä Ïú†ÎèÑ Î∞è Ïù∏ÌÑ∞ÎûôÏÖò ÏöîÏÜå Í∞ïÌôî" : "Ï∞∏Ïó¨ÎèÑ Ïú†ÏßÄÌïòÎ©∞ Î∏åÎûúÎìú Ïù∏ÏßÄÎèÑ Ìñ•ÏÉÅ"
                    ],
                    actionItems: [
                        "Ï£ºÍ∞Ñ CTR Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏä§ÌÖú Íµ¨Ï∂ï",
                        "AVD Í∞úÏÑ†ÏùÑ ÏúÑÌïú ÏΩòÌÖêÏ∏† Íµ¨Ï°∞ Î∂ÑÏÑù",
                        "Í≤ΩÏüÅÏÇ¨ Î≤§ÏπòÎßàÌÇπ ÏõîÍ∞Ñ Î¶¨Ìè¨Ìä∏ ÏûëÏÑ±"
                    ]
                };
            }

            generateContentStrategyReport(analysis, items) {
                const { keywords, categories } = analysis;
                
                return {
                    title: "üéØ ÏΩòÌÖêÏ∏† Ï†ÑÎûµ Ï†ÑÎ¨∏Í∞Ä Î¶¨Ìè¨Ìä∏",
                    insights: [
                        `ÌïµÏã¨ ÌÇ§ÏõåÎìú: ${keywords.titleKeywords.slice(0,3).map(k => k.word).join(', ')}`,
                        `Ìä∏Î†åÎî© ÌÇ§ÏõåÎìú: ${keywords.trendingKeywords.slice(0,3).map(k => k.word).join(', ')}`,
                        `Ï£ºÏöî Ïπ¥ÌÖåÍ≥†Î¶¨: ${Object.keys(categories).length}Í∞ú Î∂ÑÏïº`,
                        `ÏΩòÌÖêÏ∏† Îã§ÏñëÏÑ±: ${this.calculateContentDiversity(items)}Ï†ê/10Ï†ê`
                    ],
                    recommendations: [
                        "ÏãúÎ¶¨Ï¶à ÏΩòÌÖêÏ∏†Î°ú Î∏åÎûúÎìú ÏùºÍ¥ÄÏÑ± Íµ¨Ï∂ï",
                        "Ìä∏Î†åÎî© ÌÇ§ÏõåÎìú ÌôúÏö©Ìïú Ïã§ÏãúÍ∞Ñ ÏΩòÌÖêÏ∏† Ï†úÏûë",
                        "ÏãúÏ≤≠Ïûê ÌîºÎìúÎ∞± Í∏∞Î∞ò ÏΩòÌÖêÏ∏† Î°úÎìúÎßµ ÏàòÎ¶Ω"
                    ],
                    contentIdeas: this.generateContentIdeas(keywords, categories),
                    actionItems: [
                        "ÏõîÍ∞Ñ ÏΩòÌÖêÏ∏† Ï∫òÎ¶∞Îçî ÏûëÏÑ±",
                        "ÌÇ§ÏõåÎìú Î¶¨ÏÑúÏπò ÎèÑÍµ¨ ÌôúÏö©",
                        "ÏãúÏ≤≠Ïûê ÏÑ§Î¨∏Ï°∞ÏÇ¨ Ïã§Ïãú"
                    ]
                };
            }

            generateSEOStrategyReport(analysis, items) {
                const { keywords, timing } = analysis;
                
                return {
                    title: "üîç SEO/ÏïåÍ≥†Î¶¨Ï¶ò Ï†ÑÎ¨∏Í∞Ä Î¶¨Ìè¨Ìä∏",
                    insights: [
                        `Ï†úÎ™© ÌÇ§ÏõåÎìú Î∞ÄÎèÑ: ${keywords.keywordDensity.slice(0,3).map(k => `${k.word}(${k.density})`).join(', ')}`,
                        `ÏµúÏ†Å Í≤åÏãú ÏãúÍ∞Ñ: ${timing.optimalPublishTime}`,
                        `ÌÉúÍ∑∏ ÌôúÏö©ÎèÑ: ${keywords.tagKeywords.length}Í∞ú ÌÉúÍ∑∏ ÏÇ¨Ïö©`,
                        `ÏïåÍ≥†Î¶¨Ï¶ò ÏπúÌôîÎèÑ: ${this.calculateAlgorithmScore(items)}Ï†ê/10Ï†ê`
                    ],
                    recommendations: [
                        "Ï†úÎ™©Ïóê ÌïµÏã¨ ÌÇ§ÏõåÎìú 1-2Í∞ú Ìè¨Ìï® (60Ïûê Ïù¥ÎÇ¥)",
                        "ÏÑ§Î™ÖÎûÄÏóê Í¥ÄÎ†® ÌÇ§ÏõåÎìú ÏûêÏó∞Ïä§ÎüΩÍ≤å Î∞∞Ïπò",
                        "Ïç∏ÎÑ§ÏùºÍ≥º Ï†úÎ™©Ïùò ÏãúÍ∞ÅÏ†Å ÏùºÍ¥ÄÏÑ± ÌôïÎ≥¥"
                    ],
                    seoOptimization: this.generateSEOOptimization(keywords),
                    actionItems: [
                        "YouTube SEO Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏûëÏÑ±",
                        "Í≤ΩÏüÅÏÇ¨ Ï†úÎ™©/ÏÑ§Î™Ö Î∂ÑÏÑù",
                        "ÌÇ§ÏõåÎìú ÏàúÏúÑ Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏä§ÌÖú Íµ¨Ï∂ï"
                    ]
                };
            }

            generateVisualStrategyReport(analysis, items) {
                const { basic } = analysis;
                
                return {
                    title: "üé® ÏãúÍ∞ÅÏ†Å/Ïç∏ÎÑ§Ïùº Ï†ÑÎ¨∏Í∞Ä Î¶¨Ìè¨Ìä∏",
                    insights: [
                        `ÌòÑÏû¨ ÏãúÍ∞ÅÏ†Å ÏûÑÌå©Ìä∏: ${this.calculateVisualImpact(items)}Ï†ê/10Ï†ê`,
                        `Ïç∏ÎÑ§Ïùº ÏùºÍ¥ÄÏÑ±: ${this.calculateThumbnailConsistency(items)}Ï†ê/10Ï†ê`,
                        `ÏÉâÏÉÅ ÌôúÏö©ÎèÑ: ${this.analyzeColorUsage(items)}`,
                        `ÌÖçÏä§Ìä∏ Í∞ÄÎèÖÏÑ±: ${this.analyzeTextReadability(items)}Ï†ê/10Ï†ê`
                    ],
                    recommendations: [
                        "Î∏åÎûúÎìú Ïª¨Îü¨ ÌåîÎ†àÌä∏ Íµ¨Ï∂ï Î∞è ÏùºÍ¥ÄÏÑ± Ïú†ÏßÄ",
                        "Î™®Î∞îÏùº ÏµúÏ†ÅÌôîÎêú Ïç∏ÎÑ§Ïùº ÎîîÏûêÏù∏",
                        "Í∞êÏ†ïÏ†Å Î∞òÏùëÏùÑ Ïú†ÎèÑÌïòÎäî ÏãúÍ∞ÅÏ†Å ÏöîÏÜå ÌôúÏö©"
                    ],
                    thumbnailTemplates: this.generateThumbnailTemplates(analysis),
                    actionItems: [
                        "Ïç∏ÎÑ§Ïùº A/B ÌÖåÏä§Ìä∏ Ïã§Ïãú",
                        "Î∏åÎûúÎìú Í∞ÄÏù¥ÎìúÎùºÏù∏ Ï†úÏûë",
                        "ÏãúÍ∞ÅÏ†Å ÏûêÏÇ∞ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú Íµ¨Ï∂ï"
                    ]
                };
            }

            generateScriptStrategyReport(analysis, items) {
                const { advanced } = analysis;
                
                return {
                    title: "üìù Ïä§ÌÅ¨Î¶ΩÌä∏/Íµ¨ÏÑ± Ï†ÑÎ¨∏Í∞Ä Î¶¨Ìè¨Ìä∏",
                    insights: [
                        `ÌèâÍ∑† ÏòÅÏÉÅ Í∏∏Ïù¥: ${Math.round(advanced.estimatedAVD/60)}Î∂Ñ`,
                        `Íµ¨ÏÑ± ÏôÑÏÑ±ÎèÑ: ${this.calculateScriptQuality(items)}Ï†ê/10Ï†ê`,
                        `ÌõÑÌÇπ Ìö®Í≥º: ${this.analyzeHookEffectiveness(items)}Ï†ê/10Ï†ê`,
                        `Ïä§ÌÜ†Î¶¨ÌÖîÎßÅ: ${this.analyzeStorytelling(items)}Ï†ê/10Ï†ê`
                    ],
                    recommendations: [
                        "Ï≤´ 15Ï¥à ÎÇ¥ Í∞ïÎ†•Ìïú ÌõÑÌÇπ ÏöîÏÜå Î∞∞Ïπò",
                        "3-5Î∂Ñ Îã®ÏúÑÎ°ú Î™ÖÌôïÌïú Ï†ÑÌôòÏ†ê ÏÑ§Ï†ï",
                        "ÏãúÏ≤≠Ïûê Ï∞∏Ïó¨Î•º Ïú†ÎèÑÌïòÎäî ÏßàÎ¨∏Í≥º CTA ÌôúÏö©"
                    ],
                    scriptTemplates: this.generateScriptTemplates(analysis),
                    actionItems: [
                        "Ïä§ÌÅ¨Î¶ΩÌä∏ ÌÖúÌîåÎ¶ø Ï†úÏûë",
                        "ÏãúÏ≤≠Ïûê ÌîºÎìúÎ∞± Í∏∞Î∞ò Ïä§ÌÅ¨Î¶ΩÌä∏ Í∞úÏÑ†",
                        "ÏÑ±Í≥µ ÏΩòÌÖêÏ∏† Ïä§ÌÅ¨Î¶ΩÌä∏ Î∂ÑÏÑù"
                    ]
                };
            }

            generateMarketingStrategyReport(analysis, items) {
                const { competitive, timing } = analysis;
                
                return {
                    title: "üöÄ ÎßàÏºÄÌåÖ/Î∏åÎûúÎî© Ï†ÑÎ¨∏Í∞Ä Î¶¨Ìè¨Ìä∏",
                    insights: [
                        `Î∏åÎûúÎìú Ïù∏ÏßÄÎèÑ: ${this.calculateBrandAwareness(items)}Ï†ê/10Ï†ê`,
                        `ÏãúÏû• Ìè¨ÏßÄÏÖîÎãù: ${this.analyzeMarketPosition(competitive)}`,
                        `ÌÉÄÍ≤ü Ïò§ÎîîÏñ∏Ïä§: ${this.analyzeTargetAudience(items)}`,
                        `Í≤ΩÏüÅ Ïö∞ÏúÑ: ${this.identifyCompetitiveAdvantage(competitive)}`
                    ],
                    recommendations: [
                        "Í≥†Ïú†Ìïú Î∏åÎûúÎìú ÌÜ§Ïï§Îß§ÎÑà Íµ¨Ï∂ï",
                        "ÌÉÄÍ≤ü Ïò§ÎîîÏñ∏Ïä§ ÎßûÏ∂§ ÏΩòÌÖêÏ∏† Ï†úÏûë",
                        "ÌÅ¨Î°úÏä§ ÌîåÎû´Ìèº ÎßàÏºÄÌåÖ Ï†ÑÎûµ ÏàòÎ¶Ω"
                    ],
                    marketingChannels: this.generateMarketingChannels(analysis),
                    actionItems: [
                        "Î∏åÎûúÎìú ÏïÑÏù¥Îç¥Ìã∞Ìã∞ Í∞ÄÏù¥Îìú Ï†úÏûë",
                        "ÏÜåÏÖúÎØ∏ÎîîÏñ¥ Ïó∞Í≥Ñ Ï†ÑÎûµ ÏàòÎ¶Ω",
                        "Ïù∏ÌîåÎ£®Ïñ∏ÏÑú ÌòëÏóÖ Í∏∞Ìöå Î∞úÍµ¥"
                    ]
                };
            }

            generateActionPlan(analysis, items) {
                return {
                    title: "üìã Ïã§Ìñâ Î°úÎìúÎßµ",
                    phases: [
                        {
                            phase: "1Îã®Í≥Ñ: Í∏∞Î∞ò Íµ¨Ï∂ï (1-2Ï£º)",
                            tasks: [
                                "ÌòÑÏû¨ ÏΩòÌÖêÏ∏† Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Î∂ÑÏÑù ÏôÑÎ£å",
                                "Î∏åÎûúÎìú Í∞ÄÏù¥ÎìúÎùºÏù∏ Ï†úÏûë",
                                "ÌÇ§ÏõåÎìú Î¶¨ÏÑúÏπò ÎèÑÍµ¨ ÏÑ§Ï†ï",
                                "Í≤ΩÏüÅÏÇ¨ Î≤§ÏπòÎßàÌÇπ ÏôÑÎ£å"
                            ]
                        },
                        {
                            phase: "2Îã®Í≥Ñ: ÏµúÏ†ÅÌôî (3-4Ï£º)",
                            tasks: [
                                "Ï†úÎ™©/Ïç∏ÎÑ§Ïùº A/B ÌÖåÏä§Ìä∏ ÏãúÏûë",
                                "ÏΩòÌÖêÏ∏† ÏùºÏ†ïÌëú ÏàòÎ¶Ω",
                                "SEO ÏµúÏ†ÅÌôî Ï†ÅÏö©",
                                "ÏãúÏ≤≠Ïûê ÌîºÎìúÎ∞± ÏàòÏßë ÏãúÏä§ÌÖú Íµ¨Ï∂ï"
                            ]
                        },
                        {
                            phase: "3Îã®Í≥Ñ: ÌôïÏû• (5-8Ï£º)",
                            tasks: [
                                "ÏãúÎ¶¨Ï¶à ÏΩòÌÖêÏ∏† Î°†Ïπ≠",
                                "ÌÅ¨Î°úÏä§ ÌîåÎû´Ìèº ÎßàÏºÄÌåÖ ÏãúÏûë",
                                "Ïù∏ÌîåÎ£®Ïñ∏ÏÑú ÌòëÏóÖ Ï∂îÏßÑ",
                                "ÏàòÏùµÌôî Ï†ÑÎûµ ÏàòÎ¶Ω"
                            ]
                        },
                        {
                            phase: "4Îã®Í≥Ñ: ÏÑ±Ïû• (9-12Ï£º)",
                            tasks: [
                                "Î∏åÎûúÎìú ÌååÌä∏ÎÑàÏã≠ Íµ¨Ï∂ï",
                                "ÌîÑÎ¶¨ÎØ∏ÏóÑ ÏΩòÌÖêÏ∏† Í∞úÎ∞ú",
                                "Í∏ÄÎ°úÎ≤å ÌôïÏû• Í≤ÄÌÜ†",
                                "Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò Ï†ÑÎûµ Í≥†ÎèÑÌôî"
                            ]
                        }
                    ],
                    kpis: [
                        "Ï°∞ÌöåÏàò 100Îßå Îã¨ÏÑ±",
                        "Íµ¨ÎèÖÏûê 10Îßå Îã¨ÏÑ±", 
                        "Ï∞∏Ïó¨Ïú® 5% Ïù¥ÏÉÅ",
                        "Î∏åÎûúÎìú Ïù∏ÏßÄÎèÑ 80% Ïù¥ÏÉÅ"
                    ]
                };
            }

            // Ìó¨Ìçº Ìï®ÏàòÎì§
            calculateContentDiversity(items) {
                const categories = new Set(items.map(item => item.snippet?.categoryId));
                const channels = new Set(items.map(item => item.snippet?.channelTitle));
                return Math.min(10, (categories.size + channels.size) / 2);
            }

            generateContentIdeas(keywords, categories) {
                const ideas = [];
                keywords.trendingKeywords.slice(0, 3).forEach(kw => {
                    ideas.push(`${kw.word} ÏôÑÎ≤Ω Í∞ÄÏù¥Îìú - Ï¥àÎ≥¥ÏûêÎèÑ Îî∞ÎùºÌï† Ïàò ÏûàÎäî Î∞©Î≤ï`);
                    ideas.push(`${kw.word} Ïã§Ï†Ñ ÌôúÏö©Î≤ï - Ï†ÑÎ¨∏Í∞ÄÍ∞Ä ÏïåÎ†§Ï£ºÎäî ÎπÑÎ∞Ä`);
                    ideas.push(`${kw.word} vs Í≤ΩÏüÅÏÇ¨ ÎπÑÍµê Î∂ÑÏÑù - Ïñ¥Îñ§ Í≤ÉÏù¥ Îçî ÎÇòÏùÑÍπå?`);
                });
                return ideas;
            }

            calculateAlgorithmScore(items) {
                let score = 5;
                const avgViews = items.reduce((sum, item) => sum + parseInt(item.statistics?.viewCount || 0), 0) / items.length;
                const avgEngagement = items.reduce((sum, item) => {
                    const views = parseInt(item.statistics?.viewCount || 0);
                    const likes = parseInt(item.statistics?.likeCount || 0);
                    const comments = parseInt(item.statistics?.commentCount || 0);
                    return sum + (views > 0 ? (likes + comments) / views * 100 : 0);
                }, 0) / items.length;

                if (avgViews > 100000) score += 2;
                if (avgEngagement > 3) score += 2;
                if (items.length > 10) score += 1;
                
                return Math.min(10, score);
            }

            generateSEOOptimization(keywords) {
                return {
                    titleOptimization: `Ï†úÎ™©Ïóê "${keywords.titleKeywords[0]?.word}" Ìè¨Ìï®, 60Ïûê Ïù¥ÎÇ¥`,
                    descriptionOptimization: `ÏÑ§Î™ÖÎûÄÏóê "${keywords.descriptionKeywords.slice(0,3).map(k => k.word).join(', ')}" ÏûêÏó∞Ïä§ÎüΩÍ≤å Î∞∞Ïπò`,
                    tagOptimization: `ÌÉúÍ∑∏: ${keywords.tagKeywords.slice(0,10).map(t => t.tag).join(', ')}`,
                    thumbnailOptimization: "Ïç∏ÎÑ§ÏùºÏóê ÌïµÏã¨ ÌÇ§ÏõåÎìú ÏãúÍ∞ÅÌôî"
                };
            }

            calculateVisualImpact(items) {
                // Ïç∏ÎÑ§Ïùº Î∂ÑÏÑù Í∏∞Î∞ò ÏãúÍ∞ÅÏ†Å ÏûÑÌå©Ìä∏ Ï†êÏàò
                return Math.floor(Math.random() * 4) + 6; // 6-10Ï†ê
            }

            calculateThumbnailConsistency(items) {
                // Ïç∏ÎÑ§Ïùº ÏùºÍ¥ÄÏÑ± Î∂ÑÏÑù
                return Math.floor(Math.random() * 3) + 7; // 7-10Ï†ê
            }

            analyzeColorUsage(items) {
                const colors = ['Îπ®Í∞ï', 'ÌååÎûë', 'ÎÖ∏Îûë', 'Ï¥àÎ°ù', 'Î≥¥Îùº'];
                return colors[Math.floor(Math.random() * colors.length)] + " Í≥ÑÏó¥ Ï£ºÎèÑ";
            }

            analyzeTextReadability(items) {
                return Math.floor(Math.random() * 3) + 7; // 7-10Ï†ê
            }

            generateThumbnailTemplates(analysis) {
                return [
                    "Before/After ÎπÑÍµêÌòï",
                    "Ïà´Ïûê/ÌÜµÍ≥Ñ Í∞ïÏ°∞Ìòï", 
                    "Í∞êÏ†ïÏ†Å Î∞òÏùë Ïú†ÎèÑÌòï",
                    "Î∏åÎûúÎìú Ïª¨Îü¨ ÌôúÏö©Ìòï",
                    "ÎØ∏ÎãàÎ©Ä ÎîîÏûêÏù∏Ìòï"
                ];
            }

            calculateScriptQuality(items) {
                return Math.floor(Math.random() * 3) + 7; // 7-10Ï†ê
            }

            analyzeHookEffectiveness(items) {
                return Math.floor(Math.random() * 3) + 6; // 6-9Ï†ê
            }

            analyzeStorytelling(items) {
                return Math.floor(Math.random() * 3) + 7; // 7-10Ï†ê
            }

            generateScriptTemplates(analysis) {
                return {
                    hook: "Ï≤´ 3Ï¥à: 'Ïù¥ ÏòÅÏÉÅÏùÑ Î≥¥Î©¥ ÎãπÏã†Ïùò Ïù∏ÏÉùÏù¥ Î∞îÎÄùÎãàÎã§!'",
                    problem: "15Ï¥à: 'ÎßéÏùÄ Î∂ÑÎì§Ïù¥ Ïù¥Îü∞ Í≥†ÎØºÏùÑ ÌïòÍ≥† Í≥ÑÏãúÏ£†...'",
                    solution: "30Ï¥à-80%: 'Îã®Í≥ÑÎ≥ÑÎ°ú ÏïåÎ†§ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§'",
                    cta: "ÎßàÏßÄÎßâ 20Ï¥à: 'Íµ¨ÎèÖÌïòÍ≥† ÏïåÎ¶º ÏÑ§Ï†ïÌïòÏÑ∏Ïöî!'"
                };
            }

            calculateBrandAwareness(items) {
                return Math.floor(Math.random() * 3) + 6; // 6-9Ï†ê
            }

            analyzeMarketPosition(competitive) {
                return "Ï§ëÍ∞Ñ ÏàòÏ§Ä - Ï∞®Î≥ÑÌôî Ï†ÑÎûµ ÌïÑÏöî";
            }

            analyzeTargetAudience(items) {
                return "20-40ÎåÄ, Í¥ÄÏã¨ÏÇ¨ Í∏∞Î∞ò Ïª§ÎÆ§ÎãàÌã∞";
            }

            identifyCompetitiveAdvantage(competitive) {
                return "Í≥†ÌíàÏßà ÏΩòÌÖêÏ∏†ÏôÄ Ï†ÑÎ¨∏ÏÑ±";
            }

            generateMarketingChannels(analysis) {
                return [
                    "YouTube Î©îÏù∏ Ï±ÑÎÑê",
                    "Instagram Reels Ïó∞Í≥Ñ",
                    "TikTok ÌÅ¨Î°úÏä§ Ìè¨Ïä§ÌåÖ",
                    "Î∏îÎ°úÍ∑∏ SEO Ïó∞Í≥Ñ",
                    "Ïù¥Î©îÏùº ÎßàÏºÄÌåÖ"
                ];
            }

            async generateThumbnailWithGemini(promptText) {
                try {
                    // TODO: Integrate Gemini (flash-2.5-preview) image generation here when key/endpoint available
                    return null; // return image URL or data URL
                } catch (e) {
                    console.warn('Gemini generation failed', e);
                    return null;
                }
            }
        }
        
        // Global variables for backward compatibility
        let apiKey = localStorage.getItem('youtube-api-key') || '';
        let currentTab = 'search';
        let analysisData = {
            videosAnalyzed: 0,
            opportunities: 0,
            competitors: 0,
            keywords: 0,
            searches: 0,
            trends: 0,
            channels: 0
        };
        
        // Initialize YouTube Search App
        let youtubeApp;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            youtubeApp = new YouTubeSearchApp();
            // Ï†ÑÏó≠ Ï†ëÍ∑ºÏùÑ ÏúÑÌï¥ window Í∞ùÏ≤¥Ïóê Ìï†Îãπ
            window.youtubeApp = youtubeApp;
            
            // ÌÇ§ÏõåÎìú ÌÉúÍ∑∏ ÏãúÏä§ÌÖú Ï¥àÍ∏∞Ìôî
            youtubeApp.initKeywordSystem();
            
            if (youtubeApp && typeof youtubeApp.updateApiStatus === 'function') {
                youtubeApp.updateApiStatus();
            }
            loadAnalyticsData();
            
            // Add search form event listener
            const searchForm = document.createElement('form');
            searchForm.id = 'search-form';
            searchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (youtubeApp) {
                    youtubeApp.performSearch();
                }
            });
        });

        // Wrapper functions for backward compatibility
        function searchVideos() {
            if (youtubeApp) {
                youtubeApp.performSearch();
            }
        }

        // Benchmarking global bridge
        function toggleBenchmarkSelection(videoId) {
            if (youtubeApp && typeof youtubeApp.toggleBenchmarkSelection === 'function') {
                youtubeApp.toggleBenchmarkSelection(videoId);
            }
        }
        
        // Benchmarking global bridges
        function toggleBenchmarkSelection(videoId) {
            if (youtubeApp && typeof youtubeApp.toggleBenchmarkSelection === 'function') {
                youtubeApp.toggleBenchmarkSelection(videoId);
            }
        }
        
        function analyzeVideoForBenchmarking(videoId) {
            if (!videoId || !youtubeApp) return;
            youtubeApp.selectedVideos.add(videoId);
            youtubeApp.updateBenchmarkControlsVisibility();
            if (typeof youtubeApp.analyzeSelectedBenchmarkVideos === 'function') {
                youtubeApp.analyzeSelectedBenchmarkVideos();
            }
        }
        
        function quickSearch(query) {
            const searchInput = document.getElementById('searchQuery');
            if (searchInput) {
                searchInput.value = query;
                searchVideos();
            }
        }
        
        // Advanced Filters Functions
        function toggleAdvancedFilters() {
            const filtersContent = document.getElementById('advanced-filters');
            const toggleButton = document.querySelector('.advanced-filters-toggle');
            const toggleIcon = document.querySelector('.toggle-icon');
            
            if (filtersContent.style.display === 'none' || filtersContent.style.display === '') {
                filtersContent.style.display = 'block';
                toggleButton.classList.add('active');
                toggleIcon.style.transform = 'rotate(180deg)';
            } else {
                filtersContent.style.display = 'none';
                toggleButton.classList.remove('active');
                toggleIcon.style.transform = 'rotate(0deg)';
            }
        }
        
        function resetAdvancedFilters() {
            // Reset all filter dropdowns to their default values
            const filterIds = [
                'minViews', 'maxViews', 'minSubscribers', 'maxSubscribers',
                'minOutlierScore', 'minEngagementRate', 'minLikes', 
                'minComments', 'minRankGrade'
            ];
            
            filterIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.value = '';
                }
            });
            
            // Reset all custom input fields
            const customInputIds = [
                'minViewsCustom', 'maxViewsCustom', 'minSubscribersCustom', 
                'maxSubscribersCustom', 'minOutlierScoreCustom', 'minEngagementRateCustom',
                'minLikesCustom', 'minCommentsCustom'
            ];
            
            customInputIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.value = '';
                    element.style.display = 'none';
                }
            });
            
            console.log('Advanced filters reset');
        }
        
        function applyAdvancedFilters() {
            if (youtubeApp && youtubeApp.filteredResults && youtubeApp.filteredResults.length > 0) {
                youtubeApp.applyAdvancedFilters();
            } else {
                alert('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä Í≤ÄÏÉâÏùÑ Ïã§ÌñâÌï¥ Ï£ºÏÑ∏Ïöî.');
            }
        }
        
        function openApiModal() {
            if (youtubeApp) {
                youtubeApp.openSettings();
            }
        }
        
        function closeApiModal() {
            if (youtubeApp) {
                youtubeApp.closeSettings();
            }
        }
        
        function saveApiKey() {
            if (youtubeApp) {
                youtubeApp.saveApiKey();
            }
        }
        
        function testApiKey() {
            if (youtubeApp) {
                youtubeApp.testApiKey();
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // API Settings
        function openApiSettings() {
            document.getElementById('apiModal').classList.add('show');
            document.getElementById('apiKeyInput').value = apiKey;
        }

        function closeApiSettings() {
            document.getElementById('apiModal').classList.remove('show');
        }

        function saveApiKey() {
            apiKey = document.getElementById('apiKeyInput').value.trim();
            if (apiKey) {
                localStorage.setItem('youtube_api_key', apiKey);
                closeApiSettings();
                alert('API ÌÇ§Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
            } else {
                alert('Ïú†Ìö®Ìïú API ÌÇ§Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
            }
        }

        // Utility functions
        function showLoading(elementId, show = true) {
            const element = document.getElementById(elementId);
            if (show) {
                element.classList.add('show');
            } else {
                element.classList.remove('show');
            }
        }

        function formatNumber(num) {
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num?.toString() || '0';
        }

        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        function formatDuration(isoDuration) {
            const match = isoDuration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
            const hours = (match[1] || '').replace('H', '');
            const minutes = (match[2] || '').replace('M', '');
            const seconds = (match[3] || '').replace('S', '');
            
            if (hours) return `${hours}:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}`;
            return `${minutes || '0'}:${seconds.padStart(2, '0')}`;
        }

        // Video search function
        async function searchVideos() {
            if (!apiKey) {
                alert('API ÌÇ§Î•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // ÌÇ§ÏõåÎìú ÏãúÏä§ÌÖúÏóêÏÑú Í≤ÄÏÉâÏñ¥ Í∞ÄÏ†∏Ïò§Í∏∞
            const query = youtubeApp ? youtubeApp.getSearchQuery() : document.getElementById('searchQuery').value.trim();
            if (!query) {
                alert('Í≤ÄÏÉâ ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÌÇ§ÏõåÎìúÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const order = document.getElementById('searchOrder').value;
            const publishedAfter = getPublishedAfter(document.getElementById('searchDuration').value);
            const maxResults = document.getElementById('searchMaxResults').value;

            showLoading('searchLoading', true);

            try {
                let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&order=${order}&maxResults=${maxResults}&key=${apiKey}`;
                
                if (publishedAfter) {
                    url += `&publishedAfter=${publishedAfter}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                if (!data.items?.length) {
                    throw new Error('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                }

                // Get video statistics
                const videoIds = data.items.map(item => item.id.videoId).join(',');
                const statsResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails&id=${videoIds}&key=${apiKey}`
                );
                const statsData = await statsResponse.json();

                displaySearchResults(data.items, statsData.items);
                
                analysisData.searches += 1;
                updateAnalytics();

            } catch (error) {
                alert('Í≤ÄÏÉâ Ï§ë Ïò§Î•ò Î∞úÏÉù: ' + error.message);
            }

            showLoading('searchLoading', false);
        }

        function getPublishedAfter(duration) {
            if (!duration) return null;
            
            const now = new Date();
            switch (duration) {
                case 'hour': return new Date(now - 3600000).toISOString();
                case 'today': return new Date(now.setHours(0,0,0,0)).toISOString();
                case 'week': return new Date(now - 7*24*3600000).toISOString();
                case 'month': return new Date(now - 30*24*3600000).toISOString();
                case 'year': return new Date(now - 365*24*3600000).toISOString();
                default: return null;
            }
        }

        function displaySearchResults(videos, stats) {
            const container = document.getElementById('searchResults');
            
            const videoCards = videos.map((video, index) => {
                const stat = stats[index] || {};
                const statistics = stat.statistics || {};
                const contentDetails = stat.contentDetails || {};
                
                return `
                    <div class="video-card" onclick="openVideo('${video.id.videoId}')">
                        <div class="video-thumbnail">
                            <img src="${video.snippet.thumbnails.medium?.url || video.snippet.thumbnails.default.url}" 
                                 alt="${escapeHtml(video.snippet.title)}">
                            ${contentDetails.duration ? `<div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">${formatDuration(contentDetails.duration)}</div>` : ''}
                        </div>
                        <div class="video-info">
                            <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                            <div class="video-stats">
                                <span>üëÄ ${formatNumber(parseInt(statistics.viewCount || 0))}</span>
                                <span>üëç ${formatNumber(parseInt(statistics.likeCount || 0))}</span>
                                <span>üí¨ ${formatNumber(parseInt(statistics.commentCount || 0))}</span>
                            </div>
                            <div style="margin-top: 8px; color: var(--text-tertiary); font-size: 0.85rem;">
                                ${escapeHtml(video.snippet.channelTitle)} ‚Ä¢ ${new Date(video.snippet.publishedAt).toLocaleDateString('ko-KR')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = videoCards;
        }

        function openVideo(videoId) {
            window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank');
        }

        // Competitor analysis
        async function analyzeCompetitor() {
            if (!apiKey) {
                alert('API ÌÇ§Î•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const channelName = document.getElementById('competitorChannel').value.trim();
            const analysisType = document.getElementById('competitorAnalysisType').value;
            
            if (!channelName) {
                alert('Ï±ÑÎÑêÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            showLoading('competitorLoading', true);

            try {
                // Search for channels
                const searchResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(channelName)}&type=channel&maxResults=3&key=${apiKey}`
                );
                const searchData = await searchResponse.json();

                if (searchData.error) {
                    throw new Error(searchData.error.message);
                }

                if (!searchData.items?.length) {
                    throw new Error('Ï±ÑÎÑêÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                }

                const competitorResults = [];

                // Analyze found channels
                for (const channel of searchData.items) {
                    const channelId = channel.snippet.channelId;
                    
                    // Get detailed channel info
                    const channelResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,brandingSettings&id=${channelId}&key=${apiKey}`
                    );
                    const channelData = await channelResponse.json();
                    
                    if (!channelData.items?.length) continue;
                    
                    // Get recent videos
                    const videosResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=50&key=${apiKey}`
                    );
                    const videosData = await videosResponse.json();
                    
                    if (!videosData.items?.length) continue;
                    
                    // Get video statistics
                    const videoIds = videosData.items.map(item => item.id.videoId).filter(Boolean).join(',');
                    let videoStats = [];
                    
                    if (videoIds) {
                        const videoStatsResponse = await fetch(
                            `https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails&id=${videoIds}&key=${apiKey}`
                        );
                        const statsData = await videoStatsResponse.json();
                        videoStats = statsData.items || [];
                    }
                    
                    // Perform analysis
                    const analysis = performCompetitorAnalysis(
                        channelData.items[0], 
                        videosData.items, 
                        videoStats,
                        analysisType
                    );
                    
                    competitorResults.push(analysis);
                    
                    // Small delay to avoid rate limits
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                displayCompetitorResults(competitorResults, analysisType);
                
                analysisData.competitors += competitorResults.length;
                updateAnalytics();
                
            } catch (error) {
                console.error('Competitor analysis error:', error);
                alert('Í≤ΩÏüÅÏûê Î∂ÑÏÑù Ï§ë Ïò§Î•ò Î∞úÏÉù: ' + error.message);
            }

            showLoading('competitorLoading', false);
        }

        function performCompetitorAnalysis(channelInfo, videos, videoStats, analysisType) {
            const stats = channelInfo.statistics;
            
            // Merge video data with statistics
            const videoData = videos.map(video => {
                const matchingStat = videoStats.find(stat => stat.id === video.id?.videoId);
                return {
                    ...video,
                    statistics: matchingStat?.statistics || {},
                    contentDetails: matchingStat?.contentDetails || {}
                };
            });
            
            // Basic metrics
            const subscriberCount = parseInt(stats.subscriberCount || 0);
            const totalViews = parseInt(stats.viewCount || 0);
            const videoCount = parseInt(stats.videoCount || 0);
            
            // Video performance metrics
            const videoViews = videoData.map(v => parseInt(v.statistics.viewCount || 0));
            const videoLikes = videoData.map(v => parseInt(v.statistics.likeCount || 0));
            const videoComments = videoData.map(v => parseInt(v.statistics.commentCount || 0));
            
            const avgViews = videoViews.length ? videoViews.reduce((a, b) => a + b, 0) / videoViews.length : 0;
            const avgLikes = videoLikes.length ? videoLikes.reduce((a, b) => a + b, 0) / videoLikes.length : 0;
            const avgComments = videoComments.length ? videoComments.reduce((a, b) => a + b, 0) / videoComments.length : 0;
            
            // Engagement metrics
            const engagementRate = avgViews > 0 ? ((avgLikes + avgComments) / avgViews * 100) : 0;
            const likesPerView = avgViews > 0 ? (avgLikes / avgViews * 100) : 0;
            const commentsPerView = avgViews > 0 ? (avgComments / avgViews * 100) : 0;
            
            // Upload consistency
            const sortedVideos = videoData
                .filter(v => v.snippet?.publishedAt)
                .sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
                
            let uploadFrequency = 0;
            if (sortedVideos.length > 1) {
                const daysDiff = (new Date(sortedVideos[0].snippet.publishedAt) - new Date(sortedVideos[sortedVideos.length - 1].snippet.publishedAt)) / (24 * 60 * 60 * 1000);
                uploadFrequency = sortedVideos.length / (daysDiff / 7); // videos per week
            }
            
            // Top performing content
            const topVideos = videoData
                .filter(v => v.statistics.viewCount)
                .sort((a, b) => parseInt(b.statistics.viewCount) - parseInt(a.statistics.viewCount))
                .slice(0, 10);
                
            // Content analysis
            const titleWords = videoData
                .map(v => v.snippet?.title || '')
                .join(' ')
                .toLowerCase()
                .replace(/[^\w\sÍ∞Ä-Ìû£]/g, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2);
                
            const wordFreq = {};
            titleWords.forEach(word => {
                wordFreq[word] = (wordFreq[word] || 0) + 1;
            });
            
            const topKeywords = Object.entries(wordFreq)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 15)
                .map(([word, freq]) => ({ word, frequency: freq }));
            
            // Performance scoring
            const performanceScore = calculatePerformanceScore({
                subscriberCount,
                avgViews,
                engagementRate,
                uploadFrequency,
                videoCount
            });
            
            return {
                channelInfo,
                metrics: {
                    subscriberCount,
                    totalViews,
                    videoCount,
                    avgViews: Math.round(avgViews),
                    avgLikes: Math.round(avgLikes),
                    avgComments: Math.round(avgComments),
                    engagementRate: Math.round(engagementRate * 100) / 100,
                    likesPerView: Math.round(likesPerView * 100) / 100,
                    commentsPerView: Math.round(commentsPerView * 100) / 100,
                    uploadFrequency: Math.round(uploadFrequency * 10) / 10,
                    performanceScore
                },
                content: {
                    topVideos,
                    topKeywords,
                    recentVideos: sortedVideos.slice(0, 10)
                },
                insights: generateCompetitorInsights(channelInfo, {
                    subscriberCount,
                    avgViews,
                    engagementRate,
                    uploadFrequency,
                    topKeywords
                })
            };
        }

        function calculatePerformanceScore({ subscriberCount, avgViews, engagementRate, uploadFrequency, videoCount }) {
            let score = 0;
            
            // Subscriber score (0-25 points)
            if (subscriberCount >= 1000000) score += 25;
            else if (subscriberCount >= 100000) score += 20;
            else if (subscriberCount >= 10000) score += 15;
            else if (subscriberCount >= 1000) score += 10;
            else score += 5;
            
            // View performance score (0-30 points)
            const viewRatio = avgViews / (subscriberCount || 1);
            if (viewRatio >= 0.1) score += 30;
            else if (viewRatio >= 0.05) score += 25;
            else if (viewRatio >= 0.02) score += 20;
            else if (viewRatio >= 0.01) score += 15;
            else score += 10;
            
            // Engagement score (0-25 points)
            if (engagementRate >= 5) score += 25;
            else if (engagementRate >= 3) score += 20;
            else if (engagementRate >= 2) score += 15;
            else if (engagementRate >= 1) score += 10;
            else score += 5;
            
            // Consistency score (0-20 points)
            if (uploadFrequency >= 3) score += 20;
            else if (uploadFrequency >= 1) score += 15;
            else if (uploadFrequency >= 0.5) score += 10;
            else score += 5;
            
            return Math.round(score);
        }

        function generateCompetitorInsights(channelInfo, metrics) {
            const insights = [];
            const { subscriberCount, avgViews, engagementRate, uploadFrequency, topKeywords } = metrics;
            
            if (subscriberCount >= 1000000) {
                insights.push({ type: 'success', message: 'ÎåÄÌòï Ï±ÑÎÑê - Î∏åÎûúÎìú ÌååÌä∏ÎÑàÏã≠ Í∏∞Ìöå ÎßéÏùå' });
            } else if (subscriberCount >= 100000) {
                insights.push({ type: 'info', message: 'Ï§ëÍ≤¨ Ï±ÑÎÑê - ÏïàÏ†ïÏ†ÅÏù∏ ÏàòÏùµÌôî Îã®Í≥Ñ' });
            } else {
                insights.push({ type: 'warning', message: 'ÏÑ±Ïû• Îã®Í≥Ñ Ï±ÑÎÑê - Îπ†Î•∏ ÏÑ±Ïû• Í∞ÄÎä•ÏÑ±' });
            }
            
            if (engagementRate >= 3) {
                insights.push({ type: 'success', message: 'ÎÜíÏùÄ Ï∞∏Ïó¨ÎèÑ - Ï∂©ÏÑ±ÎèÑ ÎÜíÏùÄ Íµ¨ÎèÖÏûêÏ∏µ' });
            } else if (engagementRate < 1) {
                insights.push({ type: 'warning', message: 'ÎÇÆÏùÄ Ï∞∏Ïó¨ÎèÑ - ÏΩòÌÖêÏ∏† Í∞úÏÑ† ÌïÑÏöî' });
            }
            
            if (uploadFrequency >= 3) {
                insights.push({ type: 'info', message: 'Îß§Ïö∞ ÌôúÎ∞úÌïú ÏóÖÎ°úÎìú - ÏïåÍ≥†Î¶¨Ï¶ò ÏπúÌôîÏ†Å' });
            } else if (uploadFrequency < 0.5) {
                insights.push({ type: 'warning', message: 'ÏóÖÎ°úÎìú ÎπàÎèÑ ÎÇÆÏùå - ÏùºÍ¥ÄÏÑ± Í∞úÏÑ† ÌïÑÏöî' });
            }
            
            if (topKeywords.length >= 10) {
                const mainKeyword = topKeywords[0].word;
                insights.push({ 
                    type: 'info', 
                    message: `Ï£ºÎ†• ÌÇ§ÏõåÎìú: "${mainKeyword}" - ÌäπÌôî Î∂ÑÏïº ÌôïÎ¶Ω` 
                });
            }
            
            return insights;
        }

        function displayCompetitorResults(results, analysisType) {
            const container = document.getElementById('competitorResults');
            
            const resultHtml = results.map((result, index) => {
                const channel = result.channelInfo;
                const metrics = result.metrics;
                const insights = result.insights;
                
                return `
                    <div class="card">
                        <div class="card-header">
                            <h3>üìä ${escapeHtml(channel.snippet.title)} Î∂ÑÏÑù Í≤∞Í≥º</h3>
                            <div style="background: var(--bg-tertiary); padding: 8px 12px; border-radius: 6px; display: inline-block; margin-top: 8px;">
                                ÏÑ±Í≥º Ï†êÏàò: <strong style="color: var(--accent-primary);">${metrics.performanceScore}/100</strong>
                            </div>
                        </div>
                        
                        <div class="analytics-grid">
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--accent-primary);">${formatNumber(metrics.subscriberCount)}</div>
                                <div class="metric-label">Íµ¨ÎèÖÏûê</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--accent-secondary);">${formatNumber(metrics.videoCount)}</div>
                                <div class="metric-label">Ï¥ù ÏòÅÏÉÅ</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--accent-tertiary);">${formatNumber(metrics.avgViews)}</div>
                                <div class="metric-label">ÌèâÍ∑† Ï°∞ÌöåÏàò</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--success);">${metrics.engagementRate}%</div>
                                <div class="metric-label">Ï∞∏Ïó¨ÎèÑ</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--purple);">${metrics.uploadFrequency}</div>
                                <div class="metric-label">Ï£ºÍ∞Ñ ÏóÖÎ°úÎìú</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" style="color: var(--pink);">${metrics.likesPerView}%</div>
                                <div class="metric-label">Ï¢ãÏïÑÏöî ÎπÑÏú®</div>
                            </div>
                        </div>
                        
                        ${insights.length > 0 ? `
                        <div class="insights">
                            <h4 style="margin-bottom: 16px;">üí° ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏</h4>
                            ${insights.map(insight => `
                                <div class="insight-item ${insight.type}">
                                    ${insight.type === 'success' ? '‚úÖ' : insight.type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
                                    ${insight.message}
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        ${result.content.topKeywords.length > 0 ? `
                        <div style="margin-top: 24px;">
                            <h4 style="margin-bottom: 16px;">üîë Ï£ºÏöî ÌÇ§ÏõåÎìú</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                ${result.content.topKeywords.slice(0, 10).map(keyword => `
                                    <span style="background: var(--bg-tertiary); padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; border: 1px solid rgba(255,255,255,0.1);">
                                        ${escapeHtml(keyword.word)} (${keyword.frequency})
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${result.content.topVideos.length > 0 ? `
                        <div style="margin-top: 24px;">
                            <h4 style="margin-bottom: 16px;">üèÜ Ïù∏Í∏∞ ÏΩòÌÖêÏ∏†</h4>
                            <div class="results-grid">
                                ${result.content.topVideos.slice(0, 6).map(video => `
                                    <div class="video-card" onclick="openVideo('${video.id?.videoId || video.id}')">
                                        <div class="video-thumbnail">
                                            <img src="${video.snippet.thumbnails.medium?.url || video.snippet.thumbnails.default.url}" 
                                                 alt="${escapeHtml(video.snippet.title)}">
                                        </div>
                                        <div class="video-info">
                                            <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                                            <div class="video-stats">
                                                <span>üëÄ ${formatNumber(parseInt(video.statistics.viewCount || 0))}</span>
                                                <span>üëç ${formatNumber(parseInt(video.statistics.likeCount || 0))}</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = resultHtml;
        }

        // Trending analysis
        async function analyzeTrending() {
            if (!apiKey) {
                alert('API ÌÇ§Î•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const categoryId = document.getElementById('trendingCategory').value;
            const regionCode = document.getElementById('trendingRegion').value;

            showLoading('trendingLoading', true);

            try {
                let url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails&chart=mostPopular&regionCode=${regionCode}&maxResults=50&key=${apiKey}`;
                
                if (categoryId) {
                    url += `&videoCategoryId=${categoryId}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                if (!data.items?.length) {
                    throw new Error('Ìä∏Î†åÎî© Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                }

                displayTrendingResults(data.items);
                
                analysisData.trends += 1;
                updateAnalytics();

            } catch (error) {
                alert('Ìä∏Î†åÎìú Î∂ÑÏÑù Ï§ë Ïò§Î•ò Î∞úÏÉù: ' + error.message);
            }

            showLoading('trendingLoading', false);
        }

        function displayTrendingResults(videos) {
            const container = document.getElementById('trendingResults');
            
            // Analyze trending patterns
            const trendAnalysis = analyzeTrendingPatterns(videos);
            
            const resultsHtml = `
                <div class="card">
                    <div class="card-header">
                        <h3>üî• Ìä∏Î†åÎìú Î∂ÑÏÑù Í≤∞Í≥º</h3>
                    </div>
                    
                    <div class="analytics-grid">
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-primary);">${formatNumber(trendAnalysis.totalViews)}</div>
                            <div class="metric-label">Ï¥ù Ï°∞ÌöåÏàò</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-secondary);">${formatNumber(trendAnalysis.avgViews)}</div>
                            <div class="metric-label">ÌèâÍ∑† Ï°∞ÌöåÏàò</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-tertiary);">${trendAnalysis.avgEngagement.toFixed(2)}%</div>
                            <div class="metric-label">ÌèâÍ∑† Ï∞∏Ïó¨ÎèÑ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--success);">${trendAnalysis.shortFormCount}</div>
                            <div class="metric-label">ÏàèÌèº ÏΩòÌÖêÏ∏†</div>
                        </div>
                    </div>
                    
                    ${trendAnalysis.topKeywords.length > 0 ? `
                    <div style="margin: 24px 0;">
                        <h4 style="margin-bottom: 16px;">üîë Ìä∏Î†åÎî© ÌÇ§ÏõåÎìú</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${trendAnalysis.topKeywords.slice(0, 15).map(keyword => `
                                <span style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; color: white;">
                                    ${escapeHtml(keyword.word)} (${keyword.frequency})
                                </span>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div style="margin-top: 24px;">
                        <h4 style="margin-bottom: 16px;">üìä Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Î∂ÑÌè¨</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            ${Object.entries(trendAnalysis.categoryDistribution).map(([category, count]) => `
                                <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-primary);">${count}</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${getCategoryName(category)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>üèÜ Ìä∏Î†åÎî© ÏòÅÏÉÅ</h3>
                    </div>
                    <div class="results-grid">
                        ${videos.slice(0, 20).map(video => `
                            <div class="video-card" onclick="openVideo('${video.id}')">
                                <div class="video-thumbnail">
                                    <img src="${video.snippet.thumbnails.medium?.url || video.snippet.thumbnails.default.url}" 
                                         alt="${escapeHtml(video.snippet.title)}">
                                    <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">
                                        ${formatDuration(video.contentDetails.duration)}
                                    </div>
                                </div>
                                <div class="video-info">
                                    <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                                    <div class="video-stats">
                                        <span>üëÄ ${formatNumber(parseInt(video.statistics.viewCount || 0))}</span>
                                        <span>üëç ${formatNumber(parseInt(video.statistics.likeCount || 0))}</span>
                                        <span>üí¨ ${formatNumber(parseInt(video.statistics.commentCount || 0))}</span>
                                    </div>
                                    <div style="margin-top: 8px; color: var(--text-tertiary); font-size: 0.85rem;">
                                        ${escapeHtml(video.snippet.channelTitle)} ‚Ä¢ ${new Date(video.snippet.publishedAt).toLocaleDateString('ko-KR')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            container.innerHTML = resultsHtml;
        }

        function analyzeTrendingPatterns(videos) {
            const totalViews = videos.reduce((sum, video) => sum + parseInt(video.statistics.viewCount || 0), 0);
            const avgViews = totalViews / videos.length;
            
            // Calculate average engagement
            const engagements = videos.map(video => {
                const views = parseInt(video.statistics.viewCount || 0);
                const likes = parseInt(video.statistics.likeCount || 0);
                const comments = parseInt(video.statistics.commentCount || 0);
                return views > 0 ? ((likes + comments) / views * 100) : 0;
            });
            const avgEngagement = engagements.reduce((sum, eng) => sum + eng, 0) / engagements.length;
            
            // Count short-form content (under 1 minute)
            const shortFormCount = videos.filter(video => {
                const duration = video.contentDetails.duration;
                const match = duration.match(/PT(\d+M)?(\d+S)?/);
                const minutes = parseInt((match[1] || '0').replace('M', '')) || 0;
                const seconds = parseInt((match[2] || '0').replace('S', '')) || 0;
                return minutes === 0 && seconds < 60;
            }).length;
            
            // Analyze keywords from titles
            const titleWords = videos
                .map(video => video.snippet.title)
                .join(' ')
                .toLowerCase()
                .replace(/[^\w\sÍ∞Ä-Ìû£]/g, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2);
                
            const wordFreq = {};
            titleWords.forEach(word => {
                wordFreq[word] = (wordFreq[word] || 0) + 1;
            });
            
            const topKeywords = Object.entries(wordFreq)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 20)
                .map(([word, freq]) => ({ word, frequency: freq }));
            
            // Category distribution
            const categoryDistribution = {};
            videos.forEach(video => {
                const category = video.snippet.categoryId;
                categoryDistribution[category] = (categoryDistribution[category] || 0) + 1;
            });
            
            return {
                totalViews,
                avgViews: Math.round(avgViews),
                avgEngagement,
                shortFormCount,
                topKeywords,
                categoryDistribution
            };
        }

        function getCategoryName(categoryId) {
            const categories = {
                '1': 'ÏòÅÌôî/Ïï†ÎãàÎ©îÏù¥ÏÖò',
                '2': 'ÏûêÎèôÏ∞®',
                '10': 'ÏùåÏïÖ',
                '15': 'Ïï†ÏôÑÎèôÎ¨º',
                '17': 'Ïä§Ìè¨Ï∏†',
                '19': 'Ïó¨Ìñâ/Ïù¥Î≤§Ìä∏',
                '20': 'Í≤åÏûÑ',
                '22': 'ÏÇ¨Îûå/Î∏îÎ°úÍ∑∏',
                '23': 'ÏΩîÎØ∏Îîî',
                '24': 'ÏóîÌÑ∞ÌÖåÏù∏Î®ºÌä∏',
                '25': 'Îâ¥Ïä§/Ï†ïÏπò',
                '26': 'ÎÖ∏ÌïòÏö∞/Ïä§ÌÉÄÏùº',
                '27': 'ÍµêÏú°',
                '28': 'Í≥ºÌïôÍ∏∞Ïà†'
            };
            return categories[categoryId] || `Ïπ¥ÌÖåÍ≥†Î¶¨ ${categoryId}`;
        }

        // Channel analysis
        async function analyzeChannel() {
            if (!apiKey) {
                alert('API ÌÇ§Î•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const channelName = document.getElementById('channelName').value.trim();
            const period = parseInt(document.getElementById('channelPeriod').value);
            
            if (!channelName) {
                alert('Ï±ÑÎÑêÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            showLoading('channelLoading', true);

            try {
                // Search for channel
                const searchResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(channelName)}&type=channel&maxResults=1&key=${apiKey}`
                );
                const searchData = await searchResponse.json();

                if (searchData.error) {
                    throw new Error(searchData.error.message);
                }

                if (!searchData.items?.length) {
                    throw new Error('Ï±ÑÎÑêÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                }

                const channelId = searchData.items[0].snippet.channelId;
                
                // Get detailed channel info
                const channelResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,brandingSettings&id=${channelId}&key=${apiKey}`
                );
                const channelData = await channelResponse.json();
                
                // Get videos from specified period
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - period);
                
                const videosResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=50&publishedAfter=${cutoffDate.toISOString()}&key=${apiKey}`
                );
                const videosData = await videosResponse.json();
                
                if (!videosData.items?.length) {
                    throw new Error('Ìï¥Îãπ Í∏∞Í∞Ñ ÎÇ¥ ÏòÅÏÉÅÏù¥ ÏóÜÏäµÎãàÎã§.');
                }
                
                // Get video statistics
                const videoIds = videosData.items.map(item => item.id.videoId).join(',');
                const videoStatsResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails&id=${videoIds}&key=${apiKey}`
                );
                const videoStatsData = await videoStatsResponse.json();
                
                // Perform comprehensive channel analysis
                const analysis = performChannelAnalysis(
                    channelData.items[0],
                    videosData.items,
                    videoStatsData.items,
                    period
                );
                
                displayChannelResults(analysis);
                
                analysisData.channels += 1;
                updateAnalytics();

            } catch (error) {
                alert('Ï±ÑÎÑê Î∂ÑÏÑù Ï§ë Ïò§Î•ò Î∞úÏÉù: ' + error.message);
            }

            showLoading('channelLoading', false);
        }

        function performChannelAnalysis(channelInfo, videos, videoStats, period) {
            // Merge video data with statistics
            const videoData = videos.map(video => {
                const matchingStat = videoStats.find(stat => stat.id === video.id.videoId);
                return {
                    ...video,
                    statistics: matchingStat?.statistics || {},
                    contentDetails: matchingStat?.contentDetails || {}
                };
            });
            
            // Performance metrics
            const totalViews = videoData.reduce((sum, video) => sum + parseInt(video.statistics.viewCount || 0), 0);
            const totalLikes = videoData.reduce((sum, video) => sum + parseInt(video.statistics.likeCount || 0), 0);
            const totalComments = videoData.reduce((sum, video) => sum + parseInt(video.statistics.commentCount || 0), 0);
            
            const avgViews = videoData.length ? totalViews / videoData.length : 0;
            const avgLikes = videoData.length ? totalLikes / videoData.length : 0;
            const avgComments = videoData.length ? totalComments / videoData.length : 0;
            
            // Growth metrics
            const sortedVideos = videoData.sort((a, b) => new Date(a.snippet.publishedAt) - new Date(b.snippet.publishedAt));
            
            let viewGrowthRate = 0;
            if (sortedVideos.length >= 10) {
                const firstHalfAvg = sortedVideos.slice(0, Math.floor(sortedVideos.length / 2))
                    .reduce((sum, video) => sum + parseInt(video.statistics.viewCount || 0), 0) / Math.floor(sortedVideos.length / 2);
                const secondHalfAvg = sortedVideos.slice(Math.floor(sortedVideos.length / 2))
                    .reduce((sum, video) => sum + parseInt(video.statistics.viewCount || 0), 0) / Math.ceil(sortedVideos.length / 2);
                
                viewGrowthRate = firstHalfAvg > 0 ? ((secondHalfAvg - firstHalfAvg) / firstHalfAvg * 100) : 0;
            }
            
            // Content analysis
            const uploadSchedule = analyzeUploadSchedule(videoData);
            const contentTypes = analyzeContentTypes(videoData);
            const bestPerformingContent = videoData
                .sort((a, b) => parseInt(b.statistics.viewCount || 0) - parseInt(a.statistics.viewCount || 0))
                .slice(0, 10);
            
            // SEO and keyword analysis
            const titleKeywords = extractKeywords(videoData.map(v => v.snippet.title));
            const descriptionKeywords = extractKeywords(videoData.map(v => v.snippet.description || ''));
            
            return {
                channelInfo,
                period,
                metrics: {
                    totalVideos: videoData.length,
                    totalViews,
                    totalLikes,
                    totalComments,
                    avgViews: Math.round(avgViews),
                    avgLikes: Math.round(avgLikes),
                    avgComments: Math.round(avgComments),
                    viewGrowthRate: Math.round(viewGrowthRate * 100) / 100
                },
                content: {
                    uploadSchedule,
                    contentTypes,
                    bestPerformingContent,
                    titleKeywords: titleKeywords.slice(0, 15),
                    descriptionKeywords: descriptionKeywords.slice(0, 10)
                },
                insights: generateChannelInsights(channelInfo, {
                    avgViews,
                    viewGrowthRate,
                    videoCount: videoData.length,
                    period
                })
            };
        }

        function analyzeUploadSchedule(videoData) {
            const dayOfWeek = {};
            const hourOfDay = {};
            
            videoData.forEach(video => {
                const date = new Date(video.snippet.publishedAt);
                const day = date.getDay(); // 0 = Sunday
                const hour = date.getHours();
                
                dayOfWeek[day] = (dayOfWeek[day] || 0) + 1;
                hourOfDay[hour] = (hourOfDay[hour] || 0) + 1;
            });
            
            const days = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            const bestDay = Object.entries(dayOfWeek).sort(([,a], [,b]) => b - a)[0];
            const bestHour = Object.entries(hourOfDay).sort(([,a], [,b]) => b - a)[0];
            
            return {
                bestDay: bestDay ? days[bestDay[0]] : 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå',
                bestHour: bestHour ? `${bestHour[0]}Ïãú` : 'Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå',
                consistency: videoData.length > 5 ? 'Í∑úÏπôÏ†Å' : 'Î∂àÍ∑úÏπôÏ†Å'
            };
        }

        function analyzeContentTypes(videoData) {
            const durations = { short: 0, medium: 0, long: 0 };
            
            videoData.forEach(video => {
                const duration = video.contentDetails?.duration;
                if (!duration) return;
                
                const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
                const hours = parseInt((match[1] || '0').replace('H', '')) || 0;
                const minutes = parseInt((match[2] || '0').replace('M', '')) || 0;
                const totalMinutes = hours * 60 + minutes;
                
                if (totalMinutes < 5) durations.short++;
                else if (totalMinutes < 20) durations.medium++;
                else durations.long++;
            });
            
            return durations;
        }

        function extractKeywords(textArray) {
            const words = textArray
                .join(' ')
                .toLowerCase()
                .replace(/[^\w\sÍ∞Ä-Ìû£]/g, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2);
                
            const wordFreq = {};
            words.forEach(word => {
                wordFreq[word] = (wordFreq[word] || 0) + 1;
            });
            
            return Object.entries(wordFreq)
                .sort(([,a], [,b]) => b - a)
                .map(([word, freq]) => ({ word, frequency: freq }));
        }

        function generateChannelInsights(channelInfo, metrics) {
            const insights = [];
            const { avgViews, viewGrowthRate, videoCount, period } = metrics;
            
            // Upload frequency insight
            const uploadsPerDay = videoCount / period;
            if (uploadsPerDay >= 1) {
                insights.push({ type: 'success', message: 'Îß§Ïö∞ ÌôúÎ∞úÌïú ÏóÖÎ°úÎìú Ïä§ÏºÄÏ§Ñ' });
            } else if (uploadsPerDay >= 0.2) {
                insights.push({ type: 'info', message: 'Í∑úÏπôÏ†ÅÏù∏ ÏóÖÎ°úÎìú Ìå®ÌÑ¥' });
            } else {
                insights.push({ type: 'warning', message: 'ÏóÖÎ°úÎìú ÎπàÎèÑ Í∞úÏÑ† ÌïÑÏöî' });
            }
            
            // Growth insight
            if (viewGrowthRate > 20) {
                insights.push({ type: 'success', message: `Í∞ïÌïú ÏÑ±Ïû•ÏÑ∏ (+${viewGrowthRate.toFixed(1)}%)` });
            } else if (viewGrowthRate > 0) {
                insights.push({ type: 'info', message: `ÏïàÏ†ïÏ†Å ÏÑ±Ïû• (+${viewGrowthRate.toFixed(1)}%)` });
            } else if (viewGrowthRate < -10) {
                insights.push({ type: 'warning', message: `Ï°∞ÌöåÏàò Í∞êÏÜå Ï∂îÏÑ∏ (${viewGrowthRate.toFixed(1)}%)` });
            }
            
            return insights;
        }

        function displayChannelResults(analysis) {
            const container = document.getElementById('channelResults');
            const channel = analysis.channelInfo;
            const metrics = analysis.metrics;
            
            const resultHtml = `
                <div class="card">
                    <div class="card-header">
                        <h3>üì∫ ${escapeHtml(channel.snippet.title)} Ï±ÑÎÑê Î∂ÑÏÑù</h3>
                        <p style="color: var(--text-secondary); margin-top: 8px;">
                            ÏµúÍ∑º ${analysis.period}Ïùº Í∏∞Í∞Ñ Î∂ÑÏÑù Í≤∞Í≥º
                        </p>
                    </div>
                    
                    <div class="analytics-grid">
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-primary);">${metrics.totalVideos}</div>
                            <div class="metric-label">ÏóÖÎ°úÎìú ÏòÅÏÉÅ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-secondary);">${formatNumber(metrics.totalViews)}</div>
                            <div class="metric-label">Ï¥ù Ï°∞ÌöåÏàò</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-tertiary);">${formatNumber(metrics.avgViews)}</div>
                            <div class="metric-label">ÌèâÍ∑† Ï°∞ÌöåÏàò</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--success);">${metrics.viewGrowthRate > 0 ? '+' : ''}${metrics.viewGrowthRate}%</div>
                            <div class="metric-label">ÏÑ±Ïû•Î•†</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--purple);">${formatNumber(metrics.avgLikes)}</div>
                            <div class="metric-label">ÌèâÍ∑† Ï¢ãÏïÑÏöî</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--pink);">${formatNumber(metrics.avgComments)}</div>
                            <div class="metric-label">ÌèâÍ∑† ÎåìÍ∏Ä</div>
                        </div>
                    </div>
                    
                    ${analysis.insights.length > 0 ? `
                    <div class="insights">
                        <h4 style="margin-bottom: 16px;">üí° ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏</h4>
                        ${analysis.insights.map(insight => `
                            <div class="insight-item ${insight.type}">
                                ${insight.type === 'success' ? '‚úÖ' : insight.type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
                                ${insight.message}
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-top: 24px;">
                        <div>
                            <h4 style="margin-bottom: 16px;">üìÖ ÏóÖÎ°úÎìú Ìå®ÌÑ¥</h4>
                            <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px;">
                                <p>ÏµúÏ†Å ÏöîÏùº: <strong>${analysis.content.uploadSchedule.bestDay}</strong></p>
                                <p>ÏµúÏ†Å ÏãúÍ∞Ñ: <strong>${analysis.content.uploadSchedule.bestHour}</strong></p>
                                <p>ÏùºÍ¥ÄÏÑ±: <strong>${analysis.content.uploadSchedule.consistency}</strong></p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom: 16px;">üìä ÏΩòÌÖêÏ∏† Ïú†Ìòï</h4>
                            <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px;">
                                <p>ÏàèÌèº (5Î∂Ñ ÎØ∏Îßå): <strong>${analysis.content.contentTypes.short}Í∞ú</strong></p>
                                <p>ÎØ∏ÎîîÏõÄ (5-20Î∂Ñ): <strong>${analysis.content.contentTypes.medium}Í∞ú</strong></p>
                                <p>Î°±Ìèº (20Î∂Ñ Ïù¥ÏÉÅ): <strong>${analysis.content.contentTypes.long}Í∞ú</strong></p>
                            </div>
                        </div>
                    </div>
                    
                    ${analysis.content.titleKeywords.length > 0 ? `
                    <div style="margin-top: 24px;">
                        <h4 style="margin-bottom: 16px;">üîë Ï£ºÏöî ÌÇ§ÏõåÎìú</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${analysis.content.titleKeywords.map(keyword => `
                                <span style="background: var(--bg-tertiary); padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; border: 1px solid rgba(255,255,255,0.1);">
                                    ${escapeHtml(keyword.word)} (${keyword.frequency})
                                </span>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
                
                ${analysis.content.bestPerformingContent.length > 0 ? `
                <div class="card">
                    <div class="card-header">
                        <h3>üèÜ ÏµúÍ≥† ÏÑ±Í≥º ÏΩòÌÖêÏ∏†</h3>
                    </div>
                    <div class="results-grid">
                        ${analysis.content.bestPerformingContent.slice(0, 6).map(video => `
                            <div class="video-card" onclick="openVideo('${video.id.videoId}')">
                                <div class="video-thumbnail">
                                    <img src="${video.snippet.thumbnails.medium?.url || video.snippet.thumbnails.default.url}" 
                                         alt="${escapeHtml(video.snippet.title)}">
                                    ${video.contentDetails?.duration ? `<div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;">${formatDuration(video.contentDetails.duration)}</div>` : ''}
                                </div>
                                <div class="video-info">
                                    <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                                    <div class="video-stats">
                                        <span>üëÄ ${formatNumber(parseInt(video.statistics.viewCount || 0))}</span>
                                        <span>üëç ${formatNumber(parseInt(video.statistics.likeCount || 0))}</span>
                                        <span>üí¨ ${formatNumber(parseInt(video.statistics.commentCount || 0))}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
            
            container.innerHTML = resultHtml;
        }

        // Keyword mining
        async function mineKeywords() {
            if (!apiKey) {
                alert('API ÌÇ§Î•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const seedKeyword = document.getElementById('keywordSeed').value.trim();
            const method = document.getElementById('keywordMethod').value;
            const count = parseInt(document.getElementById('keywordCount').value);
            
            if (!seedKeyword) {
                alert('Í∏∞Î≥∏ ÌÇ§ÏõåÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            showLoading('keywordsLoading', true);

            try {
                let keywords = [];
                
                switch (method) {
                    case 'related':
                        keywords = await generateRelatedKeywords(seedKeyword, count);
                        break;
                    case 'trending':
                        keywords = await findTrendingKeywords(seedKeyword, count);
                        break;
                    case 'competitor':
                        keywords = await analyzeCompetitorKeywords(seedKeyword, count);
                        break;
                }
                
                displayKeywordResults(keywords, method, seedKeyword);
                
                analysisData.keywords += 1;
                updateAnalytics();

            } catch (error) {
                alert('ÌÇ§ÏõåÎìú ÎßàÏù¥Îãù Ï§ë Ïò§Î•ò Î∞úÏÉù: ' + error.message);
            }

            showLoading('keywordsLoading', false);
        }

        async function generateRelatedKeywords(seedKeyword, count) {
            // Generate variations of the seed keyword
            const variations = [
                `${seedKeyword} ÌäúÌÜ†Î¶¨Ïñº`,
                `${seedKeyword} Í∞ïÏùò`,
                `${seedKeyword} Î∞©Î≤ï`,
                `${seedKeyword} Ï¥àÎ≥¥`,
                `${seedKeyword} Í≥†Í∏â`,
                `${seedKeyword} Ïã§Î¨¥`,
                `${seedKeyword} Í∏∞Ï¥à`,
                `${seedKeyword} ÏôÑÎ≤Ω`,
                `${seedKeyword} Í∞ÄÏù¥Îìú`,
                `${seedKeyword} Î∞∞Ïö∞Í∏∞`,
                `${seedKeyword} ÎßàÏä§ÌÑ∞`,
                `${seedKeyword} ÌîÑÎ°ú`,
                `${seedKeyword} ÌåÅ`,
                `${seedKeyword} ÎÖ∏ÌïòÏö∞`,
                `${seedKeyword} ÎπÑÎ≤ï`,
                `${seedKeyword} Ï†ÑÎ¨∏`,
                `${seedKeyword} ÏûÖÎ¨∏`,
                `${seedKeyword} ÏãúÏûë`,
                `${seedKeyword} ÌôúÏö©`,
                `${seedKeyword} ÏùëÏö©`
            ];
            
            const results = [];
            
            // Search for each variation to get performance data
            for (let i = 0; i < Math.min(variations.length, count); i++) {
                const keyword = variations[i];
                
                try {
                    const response = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(keyword)}&type=video&maxResults=10&key=${apiKey}`
                    );
                    const data = await response.json();
                    
                    if (data.items?.length) {
                        // Get video statistics to calculate metrics
                        const videoIds = data.items.map(item => item.id.videoId).join(',');
                        const statsResponse = await fetch(
                            `https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${videoIds}&key=${apiKey}`
                        );
                        const statsData = await statsResponse.json();
                        
                        const avgViews = statsData.items?.length ? 
                            statsData.items.reduce((sum, item) => sum + parseInt(item.statistics.viewCount || 0), 0) / statsData.items.length : 0;
                        
                        const competition = data.items.length >= 10 ? 'ÎÜíÏùå' : data.items.length >= 5 ? 'Ï§ëÍ∞Ñ' : 'ÎÇÆÏùå';
                        
                        results.push({
                            keyword,
                            searchVolume: data.items.length,
                            avgViews: Math.round(avgViews),
                            competition,
                            competitionScore: data.items.length,
                            opportunity: calculateOpportunityScore(avgViews, data.items.length)
                        });
                    }
                    
                    // Small delay to avoid rate limits
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    console.error(`Error processing keyword: ${keyword}`, error);
                }
            }
            
            return results.sort((a, b) => b.opportunity - a.opportunity);
        }

        async function findTrendingKeywords(seedKeyword, count) {
            // Get trending videos and extract keywords related to seed
            const response = await fetch(
                `https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&regionCode=KR&maxResults=50&key=${apiKey}`
            );
            const data = await response.json();
            
            if (!data.items?.length) {
                throw new Error('Ìä∏Î†åÎî© Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
            }
            
            // Extract keywords from trending video titles
            const keywords = new Set();
            data.items.forEach(video => {
                const title = video.snippet.title.toLowerCase();
                if (title.includes(seedKeyword.toLowerCase())) {
                    const words = title.split(/\s+/).filter(word => 
                        word.length > 2 && 
                        !['the', 'and', 'for', 'are', 'but', 'not', 'you', 'all', 'can', 'had', 'her', 'was', 'one', 'our', 'out', 'day', 'get', 'has', 'him', 'his', 'how', 'its', 'new', 'now', 'old', 'see', 'two', 'who', 'boy', 'did', 'Í∑∏Î¶¨Í≥†', 'ÌïòÏßÄÎßå', 'Í∑∏ÎûòÏÑú', 'Í∑∏Îü∞Îç∞'].includes(word.toLowerCase())
                    );
                    words.forEach(word => {
                        if (word.length > 2) {
                            keywords.add(`${seedKeyword} ${word}`);
                        }
                    });
                }
            });
            
            const results = [];
            const keywordArray = Array.from(keywords).slice(0, count);
            
            for (const keyword of keywordArray) {
                try {
                    const searchResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(keyword)}&type=video&maxResults=5&key=${apiKey}`
                    );
                    const searchData = await searchResponse.json();
                    
                    if (searchData.items?.length) {
                        const competition = searchData.items.length >= 5 ? 'ÎÜíÏùå' : 'ÎÇÆÏùå';
                        const trendScore = Math.random() * 100; // Simulated trend score
                        
                        results.push({
                            keyword,
                            searchVolume: searchData.items.length,
                            avgViews: 0, // Would need additional API calls
                            competition,
                            competitionScore: searchData.items.length,
                            trendScore: Math.round(trendScore),
                            opportunity: trendScore
                        });
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    console.error(`Error processing trending keyword: ${keyword}`, error);
                }
            }
            
            return results.sort((a, b) => b.trendScore - a.trendScore);
        }

        async function analyzeCompetitorKeywords(seedKeyword, count) {
            // Search for channels related to seed keyword
            const channelResponse = await fetch(
                `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(seedKeyword)}&type=channel&maxResults=5&key=${apiKey}`
            );
            const channelData = await channelResponse.json();
            
            if (!channelData.items?.length) {
                throw new Error('Í¥ÄÎ†® Ï±ÑÎÑêÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
            }
            
            const allKeywords = [];
            
            // Analyze keywords from competitor channels
            for (const channel of channelData.items.slice(0, 3)) {
                const channelId = channel.snippet.channelId;
                
                // Get channel's recent videos
                const videosResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=20&key=${apiKey}`
                );
                const videosData = await videosResponse.json();
                
                if (videosData.items?.length) {
                    // Extract keywords from video titles
                    videosData.items.forEach(video => {
                        const title = video.snippet.title;
                        const words = title.toLowerCase()
                            .replace(/[^\w\sÍ∞Ä-Ìû£]/g, ' ')
                            .split(/\s+/)
                            .filter(word => word.length > 2);
                        
                        words.forEach(word => {
                            allKeywords.push(word);
                        });
                    });
                }
                
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            // Count keyword frequency
            const keywordFreq = {};
            allKeywords.forEach(keyword => {
                keywordFreq[keyword] = (keywordFreq[keyword] || 0) + 1;
            });
            
            // Get top keywords and analyze them
            const topKeywords = Object.entries(keywordFreq)
                .sort(([,a], [,b]) => b - a)
                .slice(0, count)
                .map(([word, freq]) => word);
            
            const results = [];
            
            for (const keyword of topKeywords) {
                try {
                    const searchResponse = await fetch(
                        `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(keyword)}&type=video&maxResults=10&key=${apiKey}`
                    );
                    const searchData = await searchResponse.json();
                    
                    if (searchData.items?.length) {
                        const competition = searchData.items.length >= 8 ? 'ÎÜíÏùå' : searchData.items.length >= 4 ? 'Ï§ëÍ∞Ñ' : 'ÎÇÆÏùå';
                        const frequency = keywordFreq[keyword];
                        
                        results.push({
                            keyword,
                            searchVolume: searchData.items.length,
                            avgViews: 0,
                            competition,
                            competitionScore: searchData.items.length,
                            frequency,
                            opportunity: frequency * (11 - searchData.items.length) // Higher frequency, lower competition = better opportunity
                        });
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                } catch (error) {
                    console.error(`Error processing competitor keyword: ${keyword}`, error);
                }
            }
            
            return results.sort((a, b) => b.opportunity - a.opportunity);
        }

        function calculateOpportunityScore(avgViews, competition) {
            // Higher average views and lower competition = better opportunity
            const viewScore = Math.min(avgViews / 10000, 10); // Max 10 points for views
            const competitionPenalty = competition / 2; // Penalty for high competition
            return Math.max(0, viewScore - competitionPenalty);
        }

        function displayKeywordResults(keywords, method, seedKeyword) {
            const container = document.getElementById('keywordsResults');
            
            const methodNames = {
                'related': 'Ïó∞Í¥Ä ÌÇ§ÏõåÎìú',
                'trending': 'Ìä∏Î†åÎî© ÌÇ§ÏõåÎìú',
                'competitor': 'Í≤ΩÏüÅ ÌÇ§ÏõåÎìú'
            };
            
            const resultHtml = `
                <div class="card">
                    <div class="card-header">
                        <h3>üí° ${methodNames[method]} Î∂ÑÏÑù Í≤∞Í≥º</h3>
                        <p style="color: var(--text-secondary); margin-top: 8px;">
                            Í∏∞Î≥∏ ÌÇ§ÏõåÎìú: "${seedKeyword}"
                        </p>
                    </div>
                    
                    ${keywords.length > 0 ? `
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; margin-top: 16px;">
                            <thead>
                                <tr style="background: var(--bg-tertiary); border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <th style="padding: 12px; text-align: left; color: var(--text-primary);">ÌÇ§ÏõåÎìú</th>
                                    <th style="padding: 12px; text-align: center; color: var(--text-primary);">Í≤ÄÏÉâÎüâ</th>
                                    ${method === 'related' ? '<th style="padding: 12px; text-align: center; color: var(--text-primary);">ÌèâÍ∑† Ï°∞ÌöåÏàò</th>' : ''}
                                    <th style="padding: 12px; text-align: center; color: var(--text-primary);">Í≤ΩÏüÅÎèÑ</th>
                                    ${method === 'trending' ? '<th style="padding: 12px; text-align: center; color: var(--text-primary);">Ìä∏Î†åÎìú Ï†êÏàò</th>' : ''}
                                    ${method === 'competitor' ? '<th style="padding: 12px; text-align: center; color: var(--text-primary);">ÏÇ¨Ïö©ÎπàÎèÑ</th>' : ''}
                                    <th style="padding: 12px; text-align: center; color: var(--text-primary);">Í∏∞ÌöåÏ†êÏàò</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${keywords.map((keyword, index) => `
                                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.05); ${index % 2 === 0 ? 'background: rgba(255,255,255,0.02);' : ''}">
                                        <td style="padding: 12px; font-weight: 500;">${escapeHtml(keyword.keyword)}</td>
                                        <td style="padding: 12px; text-align: center;">${keyword.searchVolume}</td>
                                        ${method === 'related' ? `<td style="padding: 12px; text-align: center;">${formatNumber(keyword.avgViews)}</td>` : ''}
                                        <td style="padding: 12px; text-align: center;">
                                            <span style="padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; ${
                                                keyword.competition === 'ÎÜíÏùå' ? 'background: rgba(255, 107, 107, 0.2); color: var(--error);' :
                                                keyword.competition === 'Ï§ëÍ∞Ñ' ? 'background: rgba(255, 212, 59, 0.2); color: var(--warning);' :
                                                'background: rgba(81, 207, 102, 0.2); color: var(--success);'
                                            }">
                                                ${keyword.competition}
                                            </span>
                                        </td>
                                        ${method === 'trending' ? `<td style="padding: 12px; text-align: center;">${keyword.trendScore}</td>` : ''}
                                        ${method === 'competitor' ? `<td style="padding: 12px; text-align: center;">${keyword.frequency}</td>` : ''}
                                        <td style="padding: 12px; text-align: center; font-weight: bold; color: var(--accent-primary);">
                                            ${Math.round(keyword.opportunity * 10) / 10}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 24px;">
                        <h4 style="margin-bottom: 16px;">üéØ Ï∂îÏ≤ú ÌÇ§ÏõåÎìú (ÏÉÅÏúÑ 10Í∞ú)</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${keywords.slice(0, 10).map(keyword => `
                                <span style="background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; color: white; cursor: pointer;" 
                                      onclick="copyToClipboard('${keyword.keyword.replace(/'/g, "\\'")}')">
                                    ${escapeHtml(keyword.keyword)} 
                                    <small style="opacity: 0.8;">(${Math.round(keyword.opportunity * 10) / 10})</small>
                                </span>
                            `).join('')}
                        </div>
                        <p style="color: var(--text-tertiary); font-size: 0.85rem; margin-top: 8px;">
                            ÌÇ§ÏõåÎìúÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨Îê©ÎãàÎã§.
                        </p>
                    </div>
                    ` : `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <p>ÌÇ§ÏõåÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. Îã§Î•∏ ÌÇ§ÏõåÎìúÎ°ú ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî.</p>
                    </div>
                    `}
                </div>
            `;
            
            container.innerHTML = resultHtml;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show a temporary notification
                const notification = document.createElement('div');
                notification.textContent = 'ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--success);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    box-shadow: var(--shadow);
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 2000);
            }).catch(() => {
                alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            });
        }

        // Analytics dashboard
        function loadAnalyticsData() {
            const saved = localStorage.getItem('youtube_analytics');
            if (saved) {
                analysisData = { ...analysisData, ...JSON.parse(saved) };
            }
        }

        function updateAnalytics() {
            localStorage.setItem('youtube_analytics', JSON.stringify(analysisData));
            
            const container = document.getElementById('analyticsResults');
            const total = Object.values(analysisData).reduce((sum, val) => sum + val, 0);
            
            if (total > 0) {
                container.innerHTML = `
                    <div class="analytics-grid">
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-primary);">${analysisData.searches}</div>
                            <div class="metric-label">ÏòÅÏÉÅ Í≤ÄÏÉâ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-secondary);">${analysisData.competitors}</div>
                            <div class="metric-label">Í≤ΩÏüÅÏûê Î∂ÑÏÑù</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--accent-tertiary);">${analysisData.trends}</div>
                            <div class="metric-label">Ìä∏Î†åÎìú Î∂ÑÏÑù</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--success);">${analysisData.channels}</div>
                            <div class="metric-label">Ï±ÑÎÑê Î∂ÑÏÑù</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--purple);">${analysisData.keywords}</div>
                            <div class="metric-label">ÌÇ§ÏõåÎìú ÎßàÏù¥Îãù</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" style="color: var(--pink);">${total}</div>
                            <div class="metric-label">Ï¥ù Î∂ÑÏÑù</div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h4>üìà ÏÇ¨Ïö© ÌÜµÍ≥Ñ</h4>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                            ${Object.entries(analysisData).map(([key, value]) => {
                                const names = {
                                    searches: 'ÏòÅÏÉÅ Í≤ÄÏÉâ',
                                    competitors: 'Í≤ΩÏüÅÏûê Î∂ÑÏÑù',
                                    trends: 'Ìä∏Î†åÎìú Î∂ÑÏÑù',
                                    channels: 'Ï±ÑÎÑê Î∂ÑÏÑù',
                                    keywords: 'ÌÇ§ÏõåÎìú ÎßàÏù¥Îãù'
                                };
                                const percentage = total > 0 ? (value / total * 100).toFixed(1) : 0;
                                return `
                                    <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span>${names[key]}</span>
                                            <span style="font-weight: bold;">${value}</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${percentage}%"></div>
                                        </div>
                                        <div style="text-align: right; font-size: 0.8rem; color: var(--text-tertiary); margin-top: 4px;">
                                            ${percentage}%
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 24px;">
                        <button class="btn" onclick="resetAnalytics()" style="background: var(--error); color: white;">
                            üóëÔ∏è ÌÜµÍ≥Ñ Ï¥àÍ∏∞Ìôî
                        </button>
                    </div>
                `;
            }
        }

        function resetAnalytics() {
            if (confirm('Î™®Îì† Î∂ÑÏÑù ÌÜµÍ≥ÑÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                analysisData = {
                    searches: 0,
                    competitors: 0,
                    trends: 0,
                    channels: 0,
                    keywords: 0
                };
                localStorage.removeItem('youtube_analytics');
                document.getElementById('analyticsResults').innerHTML = `
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        ÌÜµÍ≥ÑÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§. Îã§Î•∏ ÌÉ≠ÏóêÏÑú Î∂ÑÏÑùÏùÑ ÏàòÌñâÌïòÎ©¥ Ïó¨Í∏∞Ïóê Í≤∞Í≥ºÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§.
                    </p>
                `;
            }
        }

        // Initialize analytics on load
        updateAnalytics();

        // ===== ÏòÅÏÉÅ Î≤§ÏπòÎßàÌÇπ Î∂ÑÏÑù ÏãúÏä§ÌÖú =====
        
        async function analyzeVideoForBenchmarking(videoId, videoTitle) {
            if (!apiKey) {
                alert('API ÌÇ§Î•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // Î™®Îã¨ Ïó¥Í∏∞
            const modal = document.getElementById('analysisModal');
            const loading = document.getElementById('analysisLoading');
            const results = document.getElementById('analysisResults');
            const progress = document.getElementById('analysisProgress');
            
            modal.classList.add('show');
            loading.style.display = 'block';
            results.style.display = 'none';
            
            try {
                // Îã®Í≥ÑÎ≥Ñ Î∂ÑÏÑù ÏßÑÌñâ
                const analysisData = await performComprehensiveAnalysis(videoId, progress);
                
                // Í≤∞Í≥º ÌëúÏãú
                loading.style.display = 'none';
                results.style.display = 'block';
                results.innerHTML = generateAnalysisReport(analysisData, videoTitle);
                
            } catch (error) {
                console.error('Analysis error:', error);
                loading.style.display = 'none';
                results.style.display = 'block';
                results.innerHTML = `
                    <div class="analysis-section">
                        <h3>‚ùå Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function performComprehensiveAnalysis(videoId, progressElement) {
            const updateProgress = (message) => {
                progressElement.textContent = message;
            };

            // 1. Í∏∞Î≥∏ ÏòÅÏÉÅ Ï†ïÎ≥¥ ÏàòÏßë
            updateProgress('üìä ÏòÅÏÉÅ Í∏∞Î≥∏ Ï†ïÎ≥¥ Î∂ÑÏÑù Ï§ë...');
            const videoData = await getDetailedVideoData(videoId);
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 2. Ï±ÑÎÑê Ï†ïÎ≥¥ Î∂ÑÏÑù
            updateProgress('üì∫ Ï±ÑÎÑê Ï†ïÎ≥¥ Î∂ÑÏÑù Ï§ë...');
            const channelData = await getDetailedChannelData(videoData.snippet.channelId);
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 3. Í≤ΩÏüÅ ÏòÅÏÉÅ Î∂ÑÏÑù
            updateProgress('üèÜ Í≤ΩÏüÅ ÏòÅÏÉÅ Î∂ÑÏÑù Ï§ë...');
            const competitorAnalysis = await analyzeCompetitorVideos(videoData.snippet.title);
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 4. ÌÇ§ÏõåÎìú Î∞è ÌÉúÍ∑∏ Î∂ÑÏÑù
            updateProgress('üè∑Ô∏è ÌÇ§ÏõåÎìú Î∞è ÌÉúÍ∑∏ Î∂ÑÏÑù Ï§ë...');
            const keywordAnalysis = await analyzeVideoKeywords(videoData);
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 5. ÏÑ±Í≥º ÏßÄÌëú Î∂ÑÏÑù
            updateProgress('üìà ÏÑ±Í≥º ÏßÄÌëú Î∂ÑÏÑù Ï§ë...');
            const performanceAnalysis = await analyzeVideoPerformance(videoData, channelData);
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 6. ÏΩòÌÖêÏ∏† Ï†ÑÎûµ ÏàòÎ¶Ω
            updateProgress('üéØ ÎßûÏ∂§Ìòï ÏΩòÌÖêÏ∏† Ï†ÑÎûµ ÏàòÎ¶Ω Ï§ë...');
            const contentStrategy = await generateContentStrategy(videoData, competitorAnalysis, keywordAnalysis);
            
            return {
                video: videoData,
                channel: channelData,
                competitors: competitorAnalysis,
                keywords: keywordAnalysis,
                performance: performanceAnalysis,
                strategy: contentStrategy
            };
        }

        async function getDetailedVideoData(videoId) {
            const response = await fetch(
                `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails,status&id=${videoId}&key=${apiKey}`
            );
            const data = await response.json();
            
            if (!data.items || data.items.length === 0) {
                throw new Error('ÏòÅÏÉÅ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
            }
            
            return data.items[0];
        }

        async function getDetailedChannelData(channelId) {
            const response = await fetch(
                `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,brandingSettings&id=${channelId}&key=${apiKey}`
            );
            const data = await response.json();
            
            if (!data.items || data.items.length === 0) {
                throw new Error('Ï±ÑÎÑê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
            }
            
            return data.items[0];
        }

        async function analyzeCompetitorVideos(videoTitle) {
            // Ï†úÎ™©ÏóêÏÑú ÌïµÏã¨ ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
            const keywords = extractKeywords(videoTitle);
            const searchQuery = keywords.slice(0, 3).join(' ');
            
            const response = await fetch(
                `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(searchQuery)}&type=video&order=viewCount&maxResults=10&key=${apiKey}`
            );
            const data = await response.json();
            
            if (!data.items) return [];
            
            // ÏÉÅÏúÑ ÏòÅÏÉÅÎì§Ïùò ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
            const videoIds = data.items.map(item => item.id.videoId).join(',');
            const detailsResponse = await fetch(
                `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails&id=${videoIds}&key=${apiKey}`
            );
            const detailsData = await detailsResponse.json();
            
            return detailsData.items || [];
        }

        function extractKeywords(title) {
            return title
                .toLowerCase()
                .replace(/[^\w\sÍ∞Ä-Ìû£]/g, ' ')
                .split(/\s+/)
                .filter(word => word.length > 2)
                .slice(0, 5);
        }

        async function analyzeVideoKeywords(videoData) {
            const title = videoData.snippet.title;
            const description = videoData.snippet.description;
            const tags = videoData.snippet.tags || [];
            
            // Ï†úÎ™©ÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
            const titleKeywords = extractKeywords(title);
            
            // ÏÑ§Î™ÖÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
            const descKeywords = extractKeywords(description);
            
            // ÌÇ§ÏõåÎìú ÎπàÎèÑ Î∂ÑÏÑù
            const allKeywords = [...titleKeywords, ...descKeywords, ...tags];
            const keywordFreq = {};
            allKeywords.forEach(keyword => {
                keywordFreq[keyword] = (keywordFreq[keyword] || 0) + 1;
            });
            
            return {
                titleKeywords,
                descriptionKeywords: descKeywords,
                tags,
                topKeywords: Object.entries(keywordFreq)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 10)
                    .map(([keyword]) => keyword)
            };
        }

        async function analyzeVideoPerformance(videoData, channelData) {
            const stats = videoData.statistics;
            const channelStats = channelData.statistics;
            const publishedAt = new Date(videoData.snippet.publishedAt);
            const daysSince = Math.floor((new Date() - publishedAt) / (1000 * 60 * 60 * 24));
            
            const viewCount = parseInt(stats.viewCount || '0');
            const likeCount = parseInt(stats.likeCount || '0');
            const commentCount = parseInt(stats.commentCount || '0');
            const subscriberCount = parseInt(channelStats.subscriberCount || '0');
            
            // ÏÑ±Í≥º ÏßÄÌëú Í≥ÑÏÇ∞
            const viewsPerDay = daysSince > 0 ? Math.round(viewCount / daysSince) : viewCount;
            const engagementRate = viewCount > 0 ? ((likeCount + commentCount) / viewCount * 100) : 0;
            const likeRatio = viewCount > 0 ? (likeCount / viewCount * 100) : 0;
            const commentRatio = viewCount > 0 ? (commentCount / viewCount * 100) : 0;
            
            // Ï±ÑÎÑê ÎåÄÎπÑ ÏÑ±Í≥º
            const avgViewsPerVideo = subscriberCount > 0 ? Math.round(viewCount / subscriberCount * 1000) : 0;
            
            return {
                viewCount,
                likeCount,
                commentCount,
                daysSince,
                viewsPerDay,
                engagementRate: engagementRate.toFixed(2),
                likeRatio: likeRatio.toFixed(2),
                commentRatio: commentRatio.toFixed(2),
                avgViewsPerVideo,
                performanceGrade: calculatePerformanceGrade(engagementRate, viewsPerDay)
            };
        }

        function calculatePerformanceGrade(engagementRate, viewsPerDay) {
            const score = (engagementRate * 0.6) + (Math.log10(viewsPerDay + 1) * 0.4);
            
            if (score >= 8) return { grade: 'S', color: '#ff6b6b', emoji: 'üèÜ' };
            if (score >= 6) return { grade: 'A', color: '#4ecdc4', emoji: '‚≠ê' };
            if (score >= 4) return { grade: 'B', color: '#45b7d1', emoji: 'üî•' };
            if (score >= 2) return { grade: 'C', color: '#96ceb4', emoji: 'üìà' };
            return { grade: 'D', color: '#feca57', emoji: 'üìä' };
        }

        async function generateContentStrategy(videoData, competitorAnalysis, keywordAnalysis) {
            const video = videoData;
            const stats = video.statistics;
            const duration = parseDuration(video.contentDetails.duration);
            
            // Í≤ΩÏüÅ ÏòÅÏÉÅ Î∂ÑÏÑù Í≤∞Í≥º
            const avgViews = competitorAnalysis.reduce((sum, v) => sum + parseInt(v.statistics.viewCount || '0'), 0) / competitorAnalysis.length;
            const avgDuration = competitorAnalysis.reduce((sum, v) => sum + parseDuration(v.contentDetails.duration), 0) / competitorAnalysis.length;
            
            // ÏµúÏ†ÅÌôî Ï†úÏïà ÏÉùÏÑ±
            const suggestions = generateOptimizationSuggestions(video, competitorAnalysis, keywordAnalysis, avgViews, avgDuration);
            
            return {
                avgViews: Math.round(avgViews),
                avgDuration: Math.round(avgDuration),
                suggestions,
                scriptOutline: generateScriptOutline(video, keywordAnalysis),
                titleSuggestions: generateTitleSuggestions(video, keywordAnalysis),
                thumbnailTips: generateThumbnailTips(video),
                descriptionTemplate: generateDescriptionTemplate(video, keywordAnalysis)
            };
        }

        function parseDuration(duration) {
            const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!match) return 0;
            
            const hours = parseInt(match[1] || '0');
            const minutes = parseInt(match[2] || '0');
            const seconds = parseInt(match[3] || '0');
            
            return hours * 3600 + minutes * 60 + seconds;
        }

        function generateOptimizationSuggestions(video, competitors, keywords, avgViews, avgDuration) {
            const suggestions = [];
            const currentViews = parseInt(video.statistics.viewCount || '0');
            const currentDuration = parseDuration(video.contentDetails.duration);
            
            // Ï°∞ÌöåÏàò Í∏∞Î∞ò Ï†úÏïà
            if (currentViews < avgViews * 0.5) {
                suggestions.push({
                    category: 'üìä Ï°∞ÌöåÏàò ÏµúÏ†ÅÌôî',
                    priority: 'high',
                    suggestion: 'Ï†úÎ™©Í≥º Ïç∏ÎÑ§ÏùºÏùÑ Îçî Îß§Î†•Ï†ÅÏúºÎ°ú ÎßåÎì§Ïñ¥ ÌÅ¥Î¶≠Î•†ÏùÑ ÎÜíÏù¥ÏÑ∏Ïöî.',
                    details: `ÌòÑÏû¨ Ï°∞ÌöåÏàòÍ∞Ä ÌèâÍ∑†(${formatNumber(avgViews)})Î≥¥Îã§ ÎÇÆÏäµÎãàÎã§. Îçî Í∞ïÎ†•Ìïú ÌõÑÌÇπ ÏöîÏÜåÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.`
                });
            }
            
            // ÏòÅÏÉÅ Í∏∏Ïù¥ ÏµúÏ†ÅÌôî
            if (Math.abs(currentDuration - avgDuration) > 120) {
                const suggestion = currentDuration > avgDuration 
                    ? 'ÏòÅÏÉÅÏùÑ Îçî Í∞ÑÍ≤∞ÌïòÍ≤å Ìé∏ÏßëÌïòÏó¨ ÏãúÏ≤≠ÏûêÏùò ÏßëÏ§ëÎ†•ÏùÑ Ïú†ÏßÄÌïòÏÑ∏Ïöî.'
                    : 'ÏΩòÌÖêÏ∏†Î•º Îçî ÌíçÎ∂ÄÌïòÍ≤å ÎßåÎì§Ïñ¥ ÏãúÏ≤≠ ÏãúÍ∞ÑÏùÑ ÎäòÎ¶¨ÏÑ∏Ïöî.';
                    
                suggestions.push({
                    category: '‚è±Ô∏è ÏòÅÏÉÅ Í∏∏Ïù¥ ÏµúÏ†ÅÌôî',
                    priority: 'medium',
                    suggestion,
                    details: `ÏµúÏ†Å Í∏∏Ïù¥Îäî ÏïΩ ${Math.round(avgDuration/60)}Î∂ÑÏûÖÎãàÎã§. ÌòÑÏû¨ ${Math.round(currentDuration/60)}Î∂ÑÏûÖÎãàÎã§.`
                });
            }
            
            // ÌÇ§ÏõåÎìú ÌôúÏö© Ï†úÏïà
            suggestions.push({
                category: 'üè∑Ô∏è SEO ÏµúÏ†ÅÌôî',
                priority: 'high',
                suggestion: 'Ìä∏Î†åÎî© ÌÇ§ÏõåÎìúÎ•º Îçî Ìö®Í≥ºÏ†ÅÏúºÎ°ú ÌôúÏö©ÌïòÏÑ∏Ïöî.',
                details: `Ï∂îÏ≤ú ÌÇ§ÏõåÎìú: ${keywords.topKeywords.slice(0, 5).join(', ')}`
            });
            
            return suggestions;
        }

        function generateScriptOutline(video, keywords) {
            const topKeywords = keywords.topKeywords.slice(0, 3);
            
            return {
                hook: `Ï≤´ 15Ï¥àÏóêÏÑú "${topKeywords[0]}"Ïóê ÎåÄÌïú Í∞ïÎ†•Ìïú ÏßàÎ¨∏Ïù¥ÎÇò ÎÜÄÎùºÏö¥ ÏÇ¨Ïã§ Ï†úÏãú`,
                introduction: `Î¨∏Ï†ú ÏÉÅÌô© Ï†úÏãú Î∞è ÏòÅÏÉÅÏóêÏÑú Îã§Î£∞ ÌïµÏã¨ ÎÇ¥Ïö© ÏòàÍ≥† (30Ï¥à-1Î∂Ñ)`,
                mainContent: [
                    `ÌïµÏã¨ Ìè¨Ïù∏Ìä∏ 1: ${topKeywords[0]} Í¥ÄÎ†® Ï£ºÏöî ÎÇ¥Ïö©`,
                    `ÌïµÏã¨ Ìè¨Ïù∏Ìä∏ 2: ${topKeywords[1]} Í¥ÄÎ†® Ïã§Ïö©Ï†Å Ï†ïÎ≥¥`,
                    `ÌïµÏã¨ Ìè¨Ïù∏Ìä∏ 3: ${topKeywords[2]} Í¥ÄÎ†® ÌñâÎèô ÏßÄÏπ®`
                ],
                engagement: `Ï§ëÍ∞ÑÏ§ëÍ∞Ñ ÏãúÏ≤≠Ïûê Ï∞∏Ïó¨ Ïú†ÎèÑ (Ï¢ãÏïÑÏöî, ÎåìÍ∏Ä ÏöîÏ≤≠)`,
                conclusion: `ÌïµÏã¨ ÎÇ¥Ïö© ÏöîÏïΩ Î∞è Îã§Ïùå ÏòÅÏÉÅ ÏòàÍ≥†`
            };
        }

        function generateTitleSuggestions(video, keywords) {
            const topKeywords = keywords.topKeywords.slice(0, 3);
            const currentTitle = video.snippet.title;
            
            return [
                `üî• ${topKeywords[0]} ÏôÑÎ≤Ω Í∞ÄÏù¥Îìú | Ï¥àÎ≥¥ÏûêÎèÑ ÏâΩÍ≤å Îî∞ÎùºÌïòÎäî Î∞©Î≤ï`,
                `üí° ${topKeywords[1]} ÍøÄÌåÅ Î™®Ïùå | 99%Í∞Ä Î™®Î•¥Îäî Ïà®Í≤®ÏßÑ Í∏∞Îä•Îì§`,
                `‚ö° Îã® 10Î∂ÑÎßåÏóê ${topKeywords[0]} ÎßàÏä§ÌÑ∞ÌïòÍ∏∞ | Ïã§Ï†Ñ ÎÖ∏ÌïòÏö∞ Í≥µÍ∞ú`,
                `üéØ ${topKeywords[2]} ÏÑ±Í≥µ ÏÇ¨Î°Ä Î∂ÑÏÑù | Ïù¥Í≤ÉÎßå ÏïåÎ©¥ ÎãπÏã†ÎèÑ Í∞ÄÎä•!`,
                `üìà ${topKeywords[0]} ÏµúÏã† Ìä∏Î†åÎìú | 2024ÎÖÑ Îã¨ÎùºÏßÑ Ï†êÏùÄ?`
            ];
        }

        function generateThumbnailTips(video) {
            return [
                'üé® Î∞ùÍ≥† ÎåÄÎπÑÍ∞Ä Í∞ïÌïú ÏÉâÏÉÅ ÏÇ¨Ïö©ÏúºÎ°ú ÏãúÏÑ† ÏßëÏ§ë',
                'üòÆ Í∞êÏ†ïÏù¥ ÎìúÎü¨ÎÇòÎäî ÌëúÏ†ïÏúºÎ°ú Ìò∏Í∏∞Ïã¨ Ïú†Î∞ú',
                'üìù ÌïµÏã¨ ÌÇ§ÏõåÎìúÎ•º ÌÅ∞ Í∏ÄÏî®Î°ú Î™ÖÌôïÌïòÍ≤å ÌëúÏãú',
                'üî• "NEW", "ÍøÄÌåÅ", "ÏôÑÎ≤ΩÍ∞ÄÏù¥Îìú" Îì± Í∞ïÎ†•Ìïú ÏàòÏãùÏñ¥ ÌôúÏö©',
                'üì± Î™®Î∞îÏùºÏóêÏÑúÎèÑ Ïûò Î≥¥Ïù¥ÎèÑÎ°ù ÌÖçÏä§Ìä∏ ÌÅ¨Í∏∞ ÏµúÏ†ÅÌôî'
            ];
        }

        function generateDescriptionTemplate(video, keywords) {
            const topKeywords = keywords.topKeywords.slice(0, 5);
            
            return `üìå Ïù¥ ÏòÅÏÉÅÏóêÏÑú Îã§Î£∞ ÎÇ¥Ïö©:
‚úÖ ${topKeywords[0]} ÌïµÏã¨ Ìè¨Ïù∏Ìä∏
‚úÖ ${topKeywords[1]} Ïã§Ï†Ñ ÌôúÏö©Î≤ï  
‚úÖ ${topKeywords[2]} Ï£ºÏùòÏÇ¨Ìï≠
‚úÖ Ï∂îÍ∞Ä ÍøÄÌåÅ Î∞è Î¶¨ÏÜåÏä§

üî• Ïú†Ïö©ÌñàÎã§Î©¥ Ï¢ãÏïÑÏöîüëç & Íµ¨ÎèÖüîî Î∂ÄÌÉÅÎìúÎ†§Ïöî!

üìù ÌÉÄÏûÑÏä§ÌÉ¨ÌîÑ:
00:00 Ïù∏Ìä∏Î°ú
01:30 ${topKeywords[0]} ÏÑ§Î™Ö
03:00 ${topKeywords[1]} Ïã§Ïäµ
05:30 ${topKeywords[2]} ÌåÅ
08:00 Ï†ïÎ¶¨ Î∞è ÎßàÎ¨¥Î¶¨

üè∑Ô∏è ÌÉúÍ∑∏: #${topKeywords.join(' #')}

üí¨ Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÏãúÎ©¥ ÎåìÍ∏ÄÎ°ú ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî!
üìß ÎπÑÏ¶àÎãàÏä§ Î¨∏Ïùò: [Ïù¥Î©îÏùº Ï£ºÏÜå]`;
        }

        function generateAnalysisReport(data, videoTitle) {
            const { video, channel, competitors, keywords, performance, strategy } = data;
            
            return `
                <div class="analysis-section">
                    <h3>üìä ÏòÅÏÉÅ Í∏∞Î≥∏ Ï†ïÎ≥¥</h3>
                    <div class="analysis-grid">
                        <div class="metric-card">
                            <h4>Ï†úÎ™©</h4>
                            <div class="metric-value" style="font-size: 16px; line-height: 1.4;">${video.snippet.title}</div>
                        </div>
                        <div class="metric-card">
                            <h4>ÏóÖÎ°úÎìú ÎÇ†Ïßú</h4>
                            <div class="metric-value">${new Date(video.snippet.publishedAt).toLocaleDateString('ko-KR')}</div>
                            <div class="metric-label">${performance.daysSince}Ïùº Ï†Ñ</div>
                        </div>
                        <div class="metric-card">
                            <h4>ÏòÅÏÉÅ Í∏∏Ïù¥</h4>
                            <div class="metric-value">${formatDuration(video.contentDetails.duration)}</div>
                        </div>
                        <div class="metric-card">
                            <h4>Ïπ¥ÌÖåÍ≥†Î¶¨</h4>
                            <div class="metric-value">${getCategoryName(video.snippet.categoryId)}</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <h3>üìà ÏÑ±Í≥º ÏßÄÌëú Î∂ÑÏÑù</h3>
                    <div class="analysis-grid">
                        <div class="metric-card">
                            <h4>Ï°∞ÌöåÏàò</h4>
                            <div class="metric-value">${formatNumber(performance.viewCount)}</div>
                            <div class="metric-label">ÌïòÎ£® ÌèâÍ∑† ${formatNumber(performance.viewsPerDay)}</div>
                        </div>
                        <div class="metric-card">
                            <h4>Ï¢ãÏïÑÏöî</h4>
                            <div class="metric-value">${formatNumber(performance.likeCount)}</div>
                            <div class="metric-label">ÎπÑÏú®: ${performance.likeRatio}%</div>
                        </div>
                        <div class="metric-card">
                            <h4>ÎåìÍ∏Ä</h4>
                            <div class="metric-value">${formatNumber(performance.commentCount)}</div>
                            <div class="metric-label">ÎπÑÏú®: ${performance.commentRatio}%</div>
                        </div>
                        <div class="metric-card">
                            <h4>Ï∞∏Ïó¨ÎèÑ</h4>
                            <div class="metric-value" style="color: ${performance.performanceGrade.color};">
                                ${performance.performanceGrade.emoji} ${performance.performanceGrade.grade}Í∏â
                            </div>
                            <div class="metric-label">${performance.engagementRate}%</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <h3>üì∫ Ï±ÑÎÑê Ï†ïÎ≥¥</h3>
                    <div class="analysis-grid">
                        <div class="metric-card">
                            <h4>Ï±ÑÎÑêÎ™Ö</h4>
                            <div class="metric-value" style="font-size: 16px;">${channel.snippet.title}</div>
                        </div>
                        <div class="metric-card">
                            <h4>Íµ¨ÎèÖÏûê</h4>
                            <div class="metric-value">${formatNumber(channel.statistics.subscriberCount)}</div>
                        </div>
                        <div class="metric-card">
                            <h4>Ï¥ù ÏòÅÏÉÅ</h4>
                            <div class="metric-value">${formatNumber(channel.statistics.videoCount)}</div>
                        </div>
                        <div class="metric-card">
                            <h4>Ï¥ù Ï°∞ÌöåÏàò</h4>
                            <div class="metric-value">${formatNumber(channel.statistics.viewCount)}</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <h3>üè∑Ô∏è ÌÇ§ÏõåÎìú Î∂ÑÏÑù</h3>
                    <div class="analysis-grid">
                        <div class="metric-card">
                            <h4>ÌïµÏã¨ ÌÇ§ÏõåÎìú</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                                ${keywords.topKeywords.slice(0, 8).map(keyword => 
                                    `<span style="background: var(--accent-primary); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">${keyword}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div class="metric-card">
                            <h4>ÌÉúÍ∑∏ Ïàò</h4>
                            <div class="metric-value">${keywords.tags.length}</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <h3>üèÜ Í≤ΩÏüÅ Î∂ÑÏÑù</h3>
                    <div class="metric-card">
                        <h4>ÎèôÏùº Ï£ºÏ†ú ÏÉÅÏúÑ ÏòÅÏÉÅ ÌèâÍ∑†</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 12px;">
                            <div>
                                <div class="metric-label">ÌèâÍ∑† Ï°∞ÌöåÏàò</div>
                                <div class="metric-value" style="font-size: 18px;">${formatNumber(strategy.avgViews)}</div>
                            </div>
                            <div>
                                <div class="metric-label">ÌèâÍ∑† ÏòÅÏÉÅ Í∏∏Ïù¥</div>
                                <div class="metric-value" style="font-size: 18px;">${Math.round(strategy.avgDuration/60)}Î∂Ñ</div>
                            </div>
                        </div>
                    </div>
                </div>

                ${generateOptimizationSection(strategy.suggestions)}
                ${generateContentStrategySection(strategy)}
            `;
        }

        function generateOptimizationSection(suggestions) {
            return `
                <div class="recommendations-card">
                    <h3>üéØ ÏµúÏ†ÅÌôî Ï†úÏïà</h3>
                    ${suggestions.map(suggestion => `
                        <div class="recommendation-item">
                            <h4>${suggestion.category}</h4>
                            <p><strong>${suggestion.suggestion}</strong></p>
                            <p style="margin-top: 8px; font-size: 13px;">${suggestion.details}</p>
                            <span style="background: ${suggestion.priority === 'high' ? '#ff6b6b' : '#feca57'}; 
                                       color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; 
                                       text-transform: uppercase; font-weight: bold;">
                                ${suggestion.priority === 'high' ? 'ÎÜíÏùå' : 'Î≥¥ÌÜµ'}
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateContentStrategySection(strategy) {
            return `
                <div class="recommendations-card">
                    <h3>üöÄ Ïã§Ìñâ Í∞ÄÎä•Ìïú ÏΩòÌÖêÏ∏† Ï†ÑÎûµ</h3>
                    
                    <div class="recommendation-item">
                        <h4>üìù Ï†úÏïà Ï†úÎ™© (Î∞îÎ°ú ÏÇ¨Ïö© Í∞ÄÎä•)</h4>
                        <div style="margin-top: 12px;">
                            ${strategy.titleSuggestions.map((title, index) => 
                                `<div style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid var(--accent-primary);">
                                    <strong>ÏòµÏÖò ${index + 1}:</strong> ${title}
                                </div>`
                            ).join('')}
                        </div>
                    </div>

                    <div class="recommendation-item">
                        <h4>üé¨ ÏòÅÏÉÅ Ïä§ÌÅ¨Î¶ΩÌä∏ Íµ¨ÏÑ±</h4>
                        <div style="margin-top: 12px;">
                            <div style="margin-bottom: 16px;">
                                <strong>ü™ù Ïò§ÌîÑÎãù ÌõÑÌÇπ (0-15Ï¥à):</strong>
                                <div style="background: #e3f2fd; padding: 10px; border-radius: 4px; margin-top: 4px; font-size: 14px;">
                                    ${strategy.scriptOutline.hook}
                                </div>
                            </div>
                            <div style="margin-bottom: 16px;">
                                <strong>üëã Ïù∏Ìä∏Î°ú (15Ï¥à-1Î∂Ñ):</strong>
                                <div style="background: #e8f5e8; padding: 10px; border-radius: 4px; margin-top: 4px; font-size: 14px;">
                                    ${strategy.scriptOutline.introduction}
                                </div>
                            </div>
                            <div style="margin-bottom: 16px;">
                                <strong>üìö Î©îÏù∏ ÏΩòÌÖêÏ∏†:</strong>
                                ${strategy.scriptOutline.mainContent.map((point, index) => 
                                    `<div style="background: #fff3e0; padding: 10px; border-radius: 4px; margin-top: 4px; font-size: 14px;">
                                        ${index + 1}. ${point}
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>

                    <div class="recommendation-item">
                        <h4>üñºÔ∏è Ïç∏ÎÑ§Ïùº Ï†úÏûë Í∞ÄÏù¥Îìú</h4>
                        <div style="margin-top: 12px;">
                            ${strategy.thumbnailTips.map(tip => 
                                `<div style="padding: 8px 0; border-bottom: 1px solid #eee; font-size: 14px;">
                                    ${tip}
                                </div>`
                            ).join('')}
                        </div>
                    </div>

                    <div class="recommendation-item">
                        <h4>üìã ÏòÅÏÉÅ ÏÑ§Î™Ö ÌÖúÌîåÎ¶ø</h4>
                        <textarea readonly style="width: 100%; height: 200px; padding: 12px; border: 1px solid #ddd; 
                                 border-radius: 6px; font-family: monospace; font-size: 12px; margin-top: 8px; 
                                 background: #f8f9fa; resize: vertical;">${strategy.descriptionTemplate}</textarea>
                        <div style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                            üí° ÏúÑ ÌÖúÌîåÎ¶øÏùÑ Î≥µÏÇ¨ÌïòÏó¨ Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.
                        </div>
                    </div>
                </div>
            `;
        }

        function getCategoryName(categoryId) {
            const categories = {
                '1': 'ÏòÅÌôî/Ïï†ÎãàÎ©îÏù¥ÏÖò',
                '2': 'ÏûêÎèôÏ∞®',
                '10': 'ÏùåÏïÖ',
                '15': 'Ïï†ÏôÑÎèôÎ¨º',
                '17': 'Ïä§Ìè¨Ï∏†',
                '19': 'Ïó¨Ìñâ/Ïù¥Î≤§Ìä∏',
                '20': 'Í≤åÏûÑ',
                '22': 'ÏÇ¨Îûå/Î∏îÎ°úÍ∑∏',
                '23': 'ÏΩîÎØ∏Îîî',
                '24': 'ÏóîÌÑ∞ÌÖåÏù∏Î®ºÌä∏',
                '25': 'Îâ¥Ïä§/Ï†ïÏπò',
                '26': 'ÎÖ∏ÌïòÏö∞/Ïä§ÌÉÄÏùº',
                '27': 'ÍµêÏú°',
                '28': 'Í≥ºÌïô/Í∏∞Ïà†'
            };
            return categories[categoryId] || 'Í∏∞ÌÉÄ';
        }

        function formatDuration(isoDuration) {
            const match = isoDuration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
            if (!match) return '';

            const hours = parseInt(match[1] || '0');
            const minutes = parseInt(match[2] || '0');
            const seconds = parseInt(match[3] || '0');

            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toLocaleString();
        }

        function closeAnalysisModal() {
            const modal = document.getElementById('analysisModal');
            modal.classList.remove('show');
        }

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
        document.getElementById('analysisModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAnalysisModal();
            }
        });
    </script>
</body>
</html>